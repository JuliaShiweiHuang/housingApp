/*! permutive-javascript-sdk v13.0.0-RC.33 (web) (built 2020-11-03 19:27:12 GMT+0000) */!function(t){function e(e){for(var n,i,s=e[0],a=e[1],o=0,c=[];o<s.length;o++)i=s[o],Object.prototype.hasOwnProperty.call(r,i)&&r[i]&&c.push(r[i][0]),r[i]=0;for(n in a)Object.prototype.hasOwnProperty.call(a,n)&&(t[n]=a[n]);for(u&&u(e);c.length;)c.shift()()}var n={},r={0:0};function i(e){if(n[e])return n[e].exports;var r=n[e]={i:e,l:!1,exports:{}};return t[e].call(r.exports,r,r.exports,i),r.l=!0,r.exports}i.e=function(){return Promise.resolve()},i.m=t,i.c=n,i.d=function(t,e,n){i.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:n})},i.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},i.t=function(t,e){if(1&e&&(t=i(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var n=Object.create(null);if(i.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var r in t)i.d(n,r,function(e){return t[e]}.bind(null,r));return n},i.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return i.d(e,"a",e),e},i.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},i.p="",i.oe=function(t){throw console.error(t),t};var s=window.permutiveWebpack=window.permutiveWebpack||[],a=s.push.bind(s);s.push=e,s=s.slice();for(var o=0;o<s.length;o++)e(s[o]);var u=a;i(i.s=33)}([function(t,e,n){"use strict";n.d(e,"l",(function(){return r})),n.d(e,"k",(function(){return i})),n.d(e,"n",(function(){return s})),n.d(e,"o",(function(){return a})),n.d(e,"d",(function(){return o})),n.d(e,"e",(function(){return u})),n.d(e,"g",(function(){return c})),n.d(e,"j",(function(){return l})),n.d(e,"c",(function(){return d})),n.d(e,"b",(function(){return f})),n.d(e,"h",(function(){return _})),n.d(e,"m",(function(){return m})),n.d(e,"a",(function(){return g})),n.d(e,"f",(function(){return v})),n.d(e,"i",(function(){return b}));n(4);var r=function(t){return"Some"===t._tag},i=function(t){return"None"===t._tag},s={_tag:"None"},a=function(t){return{_tag:"Some",value:t}};function o(t){return null==t?s:a(t)}function u(t){return function(e){return t(e)?a(e):s}}function c(t){return"Right"===t._tag?s:a(t.left)}function l(t){return"Left"===t._tag?s:a(t.right)}var d=function(t){return"Left"===t._tag?s:a(t.right)};function f(t,e){return function(n){return i(n)?t():e(n.value)}}var _=function(t){return function(e){return i(e)?t():e.value}};var h=function(t,e){return i(t)?s:a(e(t.value))},p=function(t,e){return i(t)?s:e(t.value)},m=function(t){return function(e){return h(e,t)}},g=function(t){return function(e){return p(e,t)}};function v(t){return{equals:function(e,n){return e===n||(i(e)?i(n):!i(n)&&t.equals(e.value,n.value))}}}function b(t){return{equals:v(t).equals,compare:function(e,n){return e===n?0:r(e)?r(n)?t.compare(e.value,n.value):1:-1}}}},function(t,e,n){"use strict";n.d(e,"bb",(function(){return a})),n.d(e,"Vb",(function(){return o})),n.d(e,"fb",(function(){return u})),n.d(e,"db",(function(){return l})),n.d(e,"cb",(function(){return d})),n.d(e,"eb",(function(){return f})),n.d(e,"qb",(function(){return _})),n.d(e,"zb",(function(){return h})),n.d(e,"Eb",(function(){return p})),n.d(e,"W",(function(){return m})),n.d(e,"X",(function(){return g})),n.d(e,"ab",(function(){return v})),n.d(e,"Ib",(function(){return b})),n.d(e,"Jb",(function(){return y})),n.d(e,"kb",(function(){return O})),n.d(e,"lb",(function(){return w})),n.d(e,"mb",(function(){return k})),n.d(e,"pb",(function(){return j})),n.d(e,"C",(function(){return E})),n.d(e,"Mb",(function(){return M})),n.d(e,"gb",(function(){return S})),n.d(e,"nb",(function(){return P})),n.d(e,"Rb",(function(){return I})),n.d(e,"hb",(function(){return T})),n.d(e,"Sb",(function(){return C})),n.d(e,"Ub",(function(){return D})),n.d(e,"Tb",(function(){return A})),n.d(e,"Pb",(function(){return q})),n.d(e,"F",(function(){return R})),n.d(e,"H",(function(){return L})),n.d(e,"G",(function(){return N})),n.d(e,"S",(function(){return U})),n.d(e,"Q",(function(){return B})),n.d(e,"R",(function(){return K})),n.d(e,"T",(function(){return W})),n.d(e,"V",(function(){return z})),n.d(e,"U",(function(){return $})),n.d(e,"ib",(function(){return F})),n.d(e,"fc",(function(){return G})),n.d(e,"D",(function(){return J})),n.d(e,"tb",(function(){return H})),n.d(e,"Fb",(function(){return V})),n.d(e,"Gb",(function(){return Q})),n.d(e,"ob",(function(){return Y})),n.d(e,"Nb",(function(){return X})),n.d(e,"jc",(function(){return Z})),n.d(e,"ic",(function(){return tt})),n.d(e,"ec",(function(){return et})),n.d(e,"Hb",(function(){return nt})),n.d(e,"J",(function(){return rt})),n.d(e,"ac",(function(){return it})),n.d(e,"Ob",(function(){return st})),n.d(e,"y",(function(){return at})),n.d(e,"Qb",(function(){return ot})),n.d(e,"z",(function(){return ut})),n.d(e,"B",(function(){return ct})),n.d(e,"Zb",(function(){return lt})),n.d(e,"jb",(function(){return dt})),n.d(e,"E",(function(){return ft})),n.d(e,"ub",(function(){return _t})),n.d(e,"o",(function(){return Bt})),n.d(e,"p",(function(){return Kt})),n.d(e,"q",(function(){return Wt})),n.d(e,"s",(function(){return zt})),n.d(e,"v",(function(){return $t})),n.d(e,"x",(function(){return Ft})),n.d(e,"w",(function(){return Gt})),n.d(e,"I",(function(){return Jt})),n.d(e,"rb",(function(){return Ht})),n.d(e,"sb",(function(){return Vt})),n.d(e,"A",(function(){return Qt})),n.d(e,"Kb",(function(){return Yt})),n.d(e,"M",(function(){return Xt})),n.d(e,"N",(function(){return Zt})),n.d(e,"vb",(function(){return te})),n.d(e,"yb",(function(){return ee})),n.d(e,"wb",(function(){return ne})),n.d(e,"xb",(function(){return re})),n.d(e,"O",(function(){return ie})),n.d(e,"P",(function(){return se})),n.d(e,"L",(function(){return ae})),n.d(e,"Y",(function(){return oe})),n.d(e,"Z",(function(){return ue})),n.d(e,"Ab",(function(){return ce})),n.d(e,"Db",(function(){return le})),n.d(e,"Bb",(function(){return de})),n.d(e,"Cb",(function(){return fe})),n.d(e,"Wb",(function(){return _e})),n.d(e,"Lb",(function(){return he})),n.d(e,"Xb",(function(){return pe})),n.d(e,"hc",(function(){return me})),n.d(e,"gc",(function(){return ge})),n.d(e,"Yb",(function(){return ve})),n.d(e,"i",(function(){return ye})),n.d(e,"j",(function(){return Oe})),n.d(e,"c",(function(){return we})),n.d(e,"k",(function(){return ke})),n.d(e,"a",(function(){return je})),n.d(e,"b",(function(){return Ee})),n.d(e,"d",(function(){return Me})),n.d(e,"e",(function(){return Se})),n.d(e,"f",(function(){return Pe})),n.d(e,"g",(function(){return Ie})),n.d(e,"h",(function(){return Te})),n.d(e,"l",(function(){return Ce})),n.d(e,"m",(function(){return De})),n.d(e,"n",(function(){return Ae})),n.d(e,"cc",(function(){return xe})),n.d(e,"dc",(function(){return qe})),n.d(e,"bc",(function(){return Re})),n.d(e,"K",(function(){return Le})),n.d(e,"u",(function(){return Ne})),n.d(e,"t",(function(){return Ue})),n.d(e,"r",(function(){return Be}));var r=n(4),i=n(0),s=n(8);function a(t){var e=t.length;if(0===e)return Le;for(var n=Array(e),r=0;r<e;r++)n[r]=t[r];return n}function o(t){for(var e=t.length,n=Array(e),r=0;r<e;r++)n[r]=t[r];return n}function u(t){return{show:function(e){return"["+e.map(t.show).join(", ")+"]"}}}var c=function(t,e){var n=t.length;if(0===n)return e;var r=e.length;if(0===r)return t;for(var i=Array(n+r),s=0;s<n;s++)i[s]=t[s];for(s=0;s<r;s++)i[s+n]=e[s];return i};function l(){return{concat:c,empty:Le}}function d(t){return{equals:function(e,n){return e===n||e.length===n.length&&e.every((function(e,r){return t.equals(e,n[r])}))}}}function f(t){return Object(s.b)((function(e,n){for(var r=e.length,i=n.length,a=Math.min(r,i),o=0;o<a;o++){var u=t.compare(e[o],n[o]);if(0!==u)return u}return s.i.compare(r,i)}))}function _(t,e){for(var n=[],r=0;r<t;r++)n.push(e(r));return n}function h(t,e){return _(e-t+1,(function(e){return t+e}))}function p(t,e){return _(t,(function(){return e}))}function m(t){for(var e=0,n=t.length,r=0;r<n;r++)e+=t[r].length;var i=Array(e),s=0;for(r=0;r<n;r++){for(var a=t[r],o=a.length,u=0;u<o;u++)i[u+s]=a[u];s+=o}return i}function g(t,e){return function(n){return O(n)?t():e(n[0],n.slice(1))}}function v(t,e){return function(n){return O(n)?t():e(n.slice(0,n.length-1),n[n.length-1])}}function b(t,e){return function(n){var r=n.length,i=new Array(r+1);i[0]=t;for(var s=0;s<r;s++)i[s+1]=e(i[s],n[s]);return i}}function y(t,e){return function(n){var r=n.length,i=new Array(r+1);i[r]=t;for(var s=r-1;s>=0;s--)i[s]=e(n[s],i[s+1]);return i}}function O(t){return 0===t.length}function w(t){return t.length>0}function k(t,e){return t<0||t>=e.length}function j(t,e){return void 0===e?function(e){return j(t,e)}:k(t,e)?i.n:Object(i.o)(e[t])}function E(t,e){if(void 0===e)return function(e){return E(t,e)};for(var n=e.length,r=Array(n+1),i=0;i<n;i++)r[i+1]=e[i];return r[0]=t,r}function M(t,e){for(var n=t.length,r=Array(n+1),i=0;i<n;i++)r[i]=t[i];return r[n]=e,r}function S(t){return O(t)?i.n:Object(i.o)(t[0])}function P(t){return j(t.length-1,t)}function I(t){return O(t)?i.n:Object(i.o)(t.slice(1))}function T(t){var e=t.length;return 0===e?i.n:Object(i.o)(t.slice(0,e-1))}function C(t){return function(e){return e.slice(0,t)}}function D(t){return function(e){return 0===t?Le:e.slice(-t)}}function A(t){return function(e){for(var n=x(e,t),r=Array(n),i=0;i<n;i++)r[i]=e[i];return r}}var x=function(t,e){for(var n=t.length,r=0;r<n&&e(t[r]);r++);return r};function q(t){return function(e){for(var n=x(e,t),r=Array(n),i=0;i<n;i++)r[i]=e[i];var s=e.length,a=Array(s-n);for(i=n;i<s;i++)a[i-n]=e[i];return{init:r,rest:a}}}function R(t){return function(e){return e.slice(t,e.length)}}function L(t){return function(e){return e.slice(0,e.length-t)}}function N(t){return function(e){for(var n=x(e,t),r=e.length,i=Array(r-n),s=n;s<r;s++)i[s-n]=e[s];return i}}function U(t){return function(e){for(var n=e.length,r=0;r<n;r++)if(t(e[r]))return Object(i.o)(r);return i.n}}function B(t){return function(e){for(var n=e.length,r=0;r<n;r++)if(t(e[r]))return Object(i.o)(e[r]);return i.n}}function K(t){return function(e){for(var n=e.length,r=0;r<n;r++){var s=t(e[r]);if(Object(i.l)(s))return s}return i.n}}function W(t){return function(e){for(var n=e.length-1;n>=0;n--)if(t(e[n]))return Object(i.o)(e[n]);return i.n}}function z(t){return function(e){for(var n=e.length-1;n>=0;n--){var r=t(e[n]);if(Object(i.l)(r))return r}return i.n}}function $(t){return function(e){for(var n=e.length-1;n>=0;n--)if(t(e[n]))return Object(i.o)(n);return i.n}}function F(t,e){return function(n){return t<0||t>n.length?i.n:Object(i.o)(xe(t,e,n))}}function G(t,e){return function(n){return k(t,n)?i.n:Object(i.o)(qe(t,e,n))}}function J(t){return function(e){return k(t,e)?i.n:Object(i.o)(Re(t,e))}}function H(t,e){return function(n){return k(t,n)?i.n:Object(i.o)(qe(t,e(n[t]),n))}}function V(t){return O(t)?t:t.slice().reverse()}function Q(t){for(var e=[],n=t.length,r=0;r<n;r++){var i=t[r];"Right"===i._tag&&e.push(i.right)}return e}function Y(t){for(var e=[],n=t.length,r=0;r<n;r++){var i=t[r];"Left"===i._tag&&e.push(i.left)}return e}var X=function(t){return function(e){return O(e)?e:e.slice().sort(t.compare)}};function Z(t,e,n){for(var r=[],i=Math.min(t.length,e.length),s=0;s<i;s++)r[s]=n(t[s],e[s]);return r}function tt(t,e){return void 0===e?function(e){return tt(e,t)}:Z(t,e,(function(t,e){return[t,e]}))}function et(t){for(var e=[],n=[],r=0;r<t.length;r++)e[r]=t[r][0],n[r]=t[r][1];return[e,n]}function nt(t){return function(e){var n=e.length;return 0===t||n<=1||n===Math.abs(t)?e:t<0?nt(n+t)(e):e.slice(-t).concat(e.slice(0,n-t))}}function rt(t){return function(e,n){if(void 0===n){var r=rt(t);return function(t){return r(e,t)}}for(var i,s=0,a=n.length;s<a;s++)if(i=n[s],t.equals(i,e))return!0;return!1}}function it(t){var e=rt(t);return function(t){for(var n=[],r=t.length,i=0;i<r;i++){var s=t[i];e(s,n)||n.push(s)}return r===n.length?t:n}}function st(t){var e=Object(s.d)();return X(t.reduce(e.concat,e.empty))}var at=function(t){return function(e){for(var n=[],r=e;w(r);){var i=t(r),s=i[0],a=i[1];n.push(s),r=a}return n}};function ot(t){return function(e){return[e.slice(0,t),e.slice(t)]}}function ut(t){var e=at(ot(t));return function(n){return 0===n.length?Le:k(t-1,n)?[n]:e(n)}}function ct(t,e,n){void 0===n&&(n=function(){return!0});var r=function(t,i){return 0===i.length?n.apply(void 0,t)?[e.apply(void 0,t)]:Le:bt(i[0],(function(e){return r(M(t,e),i.slice(1))}))};return r(Le,t)}function lt(t){var e=rt(t);return function(n,r){if(void 0===r){var i=lt(t);return function(t){return i(t,n)}}return c(n,r.filter((function(t){return!e(t,n)})))}}function dt(t){var e=rt(t);return function(n,r){if(void 0===r){var i=dt(t);return function(t){return i(t,n)}}return n.filter((function(t){return e(t,r)}))}}function ft(t){var e=rt(t);return function(n,r){if(void 0===r){var i=ft(t);return function(t){return i(t,n)}}return n.filter((function(t){return!e(t,r)}))}}var _t=function(t){return[t]},ht=function(){return Le},pt=function(t,e){return t.map((function(t){return e(t)}))},mt=function(t,e){return t.map((function(t,n){return e(n,t)}))},gt=function(t,e){return m(pt(t,(function(t){return pt(e,t)})))},vt=function(t,e){for(var n=0,r=t.length,i=new Array(r),s=0;s<r;s++){n+=(u=e(s,t[s])).length,i[s]=u}var a=Array(n),o=0;for(s=0;s<r;s++){for(var u,c=(u=i[s]).length,l=0;l<c;l++)a[l+o]=u[l];o+=c}return a},bt=function(t,e){return vt(t,(function(t,n){return e(n)}))},yt=function(t,e){return At(t,(function(t,n){return e(n)}))},Ot=function(t,e){return t.filter(e)},wt=function(t,e){for(var n=[],r=[],i=0;i<t.length;i++){var s=t[i];e(i,s)?r.push(s):n.push(s)}return{left:n,right:r}},kt=function(t,e){return wt(t,(function(t,n){return e(n)}))},jt=function(t,e){return Et(t,(function(t,n){return e(n)}))},Et=function(t,e){for(var n=[],r=[],i=0;i<t.length;i++){var s=e(i,t[i]);"Left"===s._tag?n.push(s.left):r.push(s.right)}return{left:n,right:r}},Mt=function(t,e){return c(t,e())},St=function(t,e,n){return Tt(t,e,(function(t,e,r){return n(e,r)}))},Pt=function(t){var e=Ct(t);return function(t,n){return e(t,(function(t,e){return n(e)}))}},It=function(t,e,n){return Dt(t,e,(function(t,e,r){return n(e,r)}))},Tt=function(t,e,n){for(var r=t.length,i=e,s=0;s<r;s++)i=n(s,i,t[s]);return i},Ct=function(t){return function(e,n){return e.reduce((function(e,r,i){return t.concat(e,n(i,r))}),t.empty)}},Dt=function(t,e,n){return t.reduceRight((function(t,e,r){return n(r,e,t)}),e)},At=function(t,e){for(var n=[],r=0;r<t.length;r++){var s=e(r,t[r]);Object(i.l)(s)&&n.push(s.value)}return n},xt=function(t,e){return t.filter((function(t,n){return e(n,t)}))},qt=function(t,e){return t.map((function(t,n,r){return e(r.slice(n))}))},Rt=function(t){var e=Lt(t);return function(t,n){return e(t,(function(t,e){return n(e)}))}},Lt=function(t){return function(e,n){return Tt(e,t.of(ht()),(function(e,r,i){return t.ap(t.map(r,(function(t){return function(e){return M(t,e)}})),n(e,i))}))}},Nt=function(t){var e=Rt(t);return function(n,r){return t.map(e(n,r),Qt)}},Ut=function(t){var e=Rt(t);return function(n,r){return t.map(e(n,r),Yt)}},Bt=function(t){return function(e){return Mt(e,t)}},Kt=function(t){return function(e){return gt(e,t)}},Wt=function(t){return function(e){return gt(pt(e,(function(t){return function(){return t}})),t)}},zt=function(t){return function(e){return gt(pt(e,(function(){return function(t){return t}})),t)}},$t=function(t){return function(e){return bt(e,t)}},Ft=function(t){return function(e){return vt(e,t)}},Gt=function(t){return function(e){return bt(e,(function(e){return pt(t(e),(function(){return e}))}))}},Jt=function(t){return qt(t,r.e)},Ht=function(t){return function(e){return pt(e,t)}},Vt=function(t){return function(e){return mt(e,t)}},Qt=function(t){return yt(t,r.e)},Yt=function(t){for(var e=[],n=[],r=0,i=t;r<i.length;r++){var s=i[r];"Left"===s._tag?e.push(s.left):n.push(s.right)}return{left:e,right:n}},Xt=function(t){return function(e){return Ot(e,t)}},Zt=function(t){return function(e){return yt(e,t)}},te=function(t){return function(e){return kt(e,t)}},ee=function(t){return function(e){return wt(e,t)}},ne=function(t){return function(e){return jt(e,t)}},re=function(t){return function(e){return Et(e,t)}},ie=function(t){return function(e){return At(e,t)}},se=function(t){return function(e){return xt(e,t)}},ae=function(t){return function(e){return qt(e,t)}},oe=function(t){var e=Pt(t);return function(t){return function(n){return e(n,t)}}},ue=function(t){var e=Ct(t);return function(t){return function(n){return e(n,t)}}},ce=function(t,e){return function(n){return St(n,t,e)}},le=function(t,e){return function(n){return Tt(n,t,e)}},de=function(t,e){return function(n){return It(n,t,e)}},fe=function(t,e){return function(n){return Dt(n,t,e)}},_e=function(t){var e=Rt(t);return function(t){return function(n){return e(n,t)}}},he=function(t){return function(e){return St(e,t.of(ht()),(function(e,n){return t.ap(t.map(e,(function(t){return function(e){return M(t,e)}})),n)}))}},pe=function(t){var e=Lt(t);return function(t){return function(n){return e(n,t)}}},me=function(t){var e=Nt(t);return function(t){return function(n){return e(n,t)}}},ge=function(t){var e=Ut(t);return function(t){return function(n){return e(n,t)}}},ve=function(t,e){for(var n=[],r=t;;){var s=e(r);if(!Object(i.l)(s))break;var a=s.value,o=a[0],u=a[1];n.push(o),r=u}return n},be="ReadonlyArray",ye={URI:be,map:pt},Oe={URI:be,map:pt,mapWithIndex:mt},we={URI:be,map:pt,ap:gt,of:_t},ke={URI:be,map:pt,ap:gt,of:_t,chain:bt},je={URI:be,map:pt,alt:Mt},Ee={URI:be,map:pt,ap:gt,of:_t,alt:Mt,zero:ht},Me={URI:be,map:pt,extend:qt},Se={URI:be,map:pt,compact:Qt,separate:Yt,filter:Ot,filterMap:yt,partition:kt,partitionMap:jt},Pe={URI:be,map:pt,mapWithIndex:mt,compact:Qt,separate:Yt,filter:Ot,filterMap:yt,partition:kt,partitionMap:jt,partitionMapWithIndex:Et,partitionWithIndex:wt,filterMapWithIndex:At,filterWithIndex:xt},Ie={URI:be,reduce:St,foldMap:Pt,reduceRight:It},Te={URI:be,reduce:St,foldMap:Pt,reduceRight:It,reduceWithIndex:Tt,foldMapWithIndex:Ct,reduceRightWithIndex:Dt},Ce={URI:be,map:pt,reduce:St,foldMap:Pt,reduceRight:It,traverse:Rt,sequence:he},De={URI:be,map:pt,mapWithIndex:mt,reduce:St,foldMap:Pt,reduceRight:It,reduceWithIndex:Tt,foldMapWithIndex:Ct,reduceRightWithIndex:Dt,traverse:Rt,sequence:he,traverseWithIndex:Lt},Ae={URI:be,map:pt,compact:Qt,separate:Yt,filter:Ot,filterMap:yt,partition:kt,partitionMap:jt,reduce:St,foldMap:Pt,reduceRight:It,traverse:Rt,sequence:he,wither:Nt,wilt:Ut};function xe(t,e,n){var r=n.slice();return r.splice(t,0,e),r}function qe(t,e,n){if(n[t]===e)return n;var r=n.slice();return r[t]=e,r}function Re(t,e){var n=e.slice();return n.splice(t,1),n}var Le=[],Ne=function(t){return Ht(Object(r.a)(t))},Ue=function(t,e){return $t((function(n){return Object(r.f)(e(n),Ht((function(e){return Object(r.b)(n,t,e)})))}))},Be=function(t,e){return Object(r.d)(Ht((function(e){return function(n){return Object(r.b)(e,t,n)}})),Kt(e))}},function(t,e,n){"use strict";n.d(e,"j",(function(){return r})),n.d(e,"m",(function(){return i})),n.d(e,"k",(function(){return s})),n.d(e,"i",(function(){return a})),n.d(e,"l",(function(){return o})),n.d(e,"h",(function(){return u})),n.d(e,"a",(function(){return c})),n.d(e,"e",(function(){return l})),n.d(e,"o",(function(){return d})),n.d(e,"q",(function(){return f})),n.d(e,"s",(function(){return _})),n.d(e,"c",(function(){return h})),n.d(e,"r",(function(){return p})),n.d(e,"g",(function(){return m})),n.d(e,"n",(function(){return g})),n.d(e,"p",(function(){return v})),n.d(e,"d",(function(){return b})),n.d(e,"f",(function(){return y})),n.d(e,"b",(function(){return O}));const r=()=>({kind:"null",value:null}),i=t=>({kind:"string",value:t}),s=t=>({kind:"number",value:t}),a=t=>({kind:"array",value:t}),o=t=>({kind:"object",value:t}),u=t=>t,c=()=>({kind:"bottom"}),l=t=>({kind:"inner",a:t}),d=t=>({kind:"top",error:t}),f=t=>({kind:"unbounded",group:t}),_=(t,e)=>({kind:"windowed",key:e,group:t}),h=(t,e,n)=>({kind:"countLimit",n:n,limit:e,group:t}),p=(t,e,n)=>({kind:"uniqueLimit",n:n,limit:e,group:t}),m=t=>({kind:"numberGroup",group:t}),g=t=>({kind:"stringGroup",group:t}),v=t=>({kind:"tuple",tuple:t}),b=t=>({state:t}),y=(t,e)=>({commands:t,payload:e}),O=t=>t},function(t,e,n){"use strict";n.d(e,"m",(function(){return r})),n.d(e,"n",(function(){return i})),n.d(e,"o",(function(){return s})),n.d(e,"r",(function(){return a})),n.d(e,"g",(function(){return o})),n.d(e,"t",(function(){return u})),n.d(e,"f",(function(){return c})),n.d(e,"j",(function(){return l})),n.d(e,"s",(function(){return d})),n.d(e,"p",(function(){return j})),n.d(e,"c",(function(){return E})),n.d(e,"q",(function(){return M})),n.d(e,"b",(function(){return S})),n.d(e,"a",(function(){return P})),n.d(e,"d",(function(){return C})),n.d(e,"k",(function(){return x})),n.d(e,"i",(function(){return q})),n.d(e,"l",(function(){return R})),n.d(e,"h",(function(){return L})),n.d(e,"e",(function(){return N}));n(4);var r=function(t){return"Left"===t._tag},i=function(t){return"Right"===t._tag},s=function(t){return{_tag:"Left",left:t}},a=function(t){return{_tag:"Right",right:t}};function o(t){return function(e){return null==e?s(t):a(e)}}function u(t,e){try{return a(t())}catch(t){return s(e(t))}}function c(t,e){return function(n){return r(n)?t(n.left):e(n.right)}}var l=function(t){return function(e){return r(e)?t(e.left):e.right}};function d(t){return r(t)?a(t.left):s(t.right)}var f=function(t,e){return r(t)?t:a(e(t.right))},_=function(t,e){return r(t)?t:r(e)?e:a(t.right(e.right))},h=function(t,e){return r(t)?t:e(t.right)},p=function(t,e,n){return r(t)?e:n(e,t.right)},m=function(t){return function(e,n){return r(e)?t.empty:n(e.right)}},g=function(t,e,n){return r(t)?e:n(t.right,e)},v=function(t){return function(e,n){return r(e)?t.of(s(e.left)):t.map(n(e.right),a)}},b=function(t,e,n){return r(t)?s(e(t.left)):a(n(t.right))},y=function(t,e){return r(t)?s(e(t.left)):t},O=function(t,e){return r(t)?e():t},w=function(t,e){return r(t)?t:a(e(t))},k=function(t,e){return function(t,e){for(var n=e(t);"Left"===n._tag;)n=e(n.left);return n.right}(e(t),(function(t){return r(t)?a(s(t.left)):r(t.right)?s(e(t.right.left)):a(a(t.right.right))}))},j=function(t){return function(e){return f(e,t)}},E=function(t,e){return function(n){return b(n,t,e)}},M=function(t){return function(e){return y(e,t)}},S=function(t){return function(e){return _(e,t)}},P=S,I=a,T=function(t){return function(e){return h(e,t)}},C=T,D=function(t){return function(e){return r(e)?t.of(s(e.left)):t.map(e.right,a)}},A="Either";function x(t){return{concat:function(e,n){return r(n)?e:r(e)?n:a(t.concat(e.right,n.right))}}}function q(t){return{concat:function(e,n){return r(e)?e:r(n)?n:a(t.concat(e.right,n.right))}}}function R(t){var e=function(t){var e=s(t.empty);return{URI:A,_E:void 0,map:f,compact:function(t){return r(t)?t:"None"===t.right._tag?e:a(t.right.value)},separate:function(t){return r(t)?{left:t,right:t}:r(t.right)?{left:a(t.right.left),right:e}:{left:e,right:a(t.right.right)}},filter:function(t,n){return r(t)||n(t.right)?t:e},filterMap:function(t,n){if(r(t))return t;var i=n(t.right);return"None"===i._tag?e:a(i.value)},partition:function(t,n){return r(t)?{left:t,right:t}:n(t.right)?{left:e,right:a(t.right)}:{left:a(t.right),right:e}},partitionMap:function(t,n){if(r(t))return{left:t,right:t};var i=n(t.right);return r(i)?{left:a(i.left),right:e}:{left:e,right:a(i.right)}}}}(t);return{URI:A,_E:void 0,map:f,compact:e.compact,separate:e.separate,filter:e.filter,filterMap:e.filterMap,partition:e.partition,partitionMap:e.partitionMap,traverse:v,sequence:D,reduce:p,foldMap:m,reduceRight:g,wither:function(t){var n=v(t);return function(r,i){return t.map(n(r,i),e.compact)}},wilt:function(t){var n=v(t);return function(r,i){return t.map(n(r,i),e.separate)}}}}function L(t){return{URI:A,_E:void 0,map:f,ap:function(e,n){return r(e)?r(n)?s(t.concat(e.left,n.left)):e:r(n)?n:a(e.right(n.right))},of:I}}var N={URI:A,map:f,of:a,ap:_,chain:h,reduce:p,foldMap:m,reduceRight:g,traverse:v,sequence:D,bimap:b,mapLeft:y,alt:O,extend:w,chainRec:k,throwError:s}},function(t,e,n){"use strict";function r(t){return t}n.d(e,"e",(function(){return r})),n.d(e,"c",(function(){return i})),n.d(e,"d",(function(){return s})),n.d(e,"g",(function(){return a})),n.d(e,"f",(function(){return o})),n.d(e,"b",(function(){return u})),n.d(e,"a",(function(){return c}));var i=function(){};function s(t,e,n,r,i,s,a,o,u){switch(arguments.length){case 1:return t;case 2:return function(){return e(t.apply(this,arguments))};case 3:return function(){return n(e(t.apply(this,arguments)))};case 4:return function(){return r(n(e(t.apply(this,arguments))))};case 5:return function(){return i(r(n(e(t.apply(this,arguments)))))};case 6:return function(){return s(i(r(n(e(t.apply(this,arguments))))))};case 7:return function(){return a(s(i(r(n(e(t.apply(this,arguments)))))))};case 8:return function(){return o(a(s(i(r(n(e(t.apply(this,arguments))))))))};case 9:return function(){return u(o(a(s(i(r(n(e(t.apply(this,arguments)))))))))}}}function a(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return t}function o(t,e,n,r,i,s,a,o,u,c){switch(arguments.length){case 1:return t;case 2:return e(t);case 3:return n(e(t));case 4:return r(n(e(t)));case 5:return i(r(n(e(t))));case 6:return s(i(r(n(e(t)))));case 7:return a(s(i(r(n(e(t))))));case 8:return o(a(s(i(r(n(e(t)))))));case 9:return u(o(a(s(i(r(n(e(t))))))));case 10:return c(u(o(a(s(i(r(n(e(t)))))))))}}var u=function(t,e,n){var r;return Object.assign({},t,((r={})[e]=n,r))},c=function(t){return function(e){var n;return(n={})[t]=e,n}}},function(t,e,n){"use strict";n.d(e,"k",(function(){return o})),n.d(e,"i",(function(){return u})),n.d(e,"f",(function(){return c})),n.d(e,"b",(function(){return l})),n.d(e,"a",(function(){return d})),n.d(e,"e",(function(){return f})),n.d(e,"c",(function(){return _})),n.d(e,"l",(function(){return h})),n.d(e,"n",(function(){return p})),n.d(e,"o",(function(){return m})),n.d(e,"h",(function(){return g})),n.d(e,"j",(function(){return v})),n.d(e,"m",(function(){return b})),n.d(e,"d",(function(){return y})),n.d(e,"g",(function(){return O}));var r=n(6),i=n(0),s=n(11),a=n(7);function o(...t){return t.reduce((t,e)=>Object.assign(Object.assign({},t),e),{})}function u(t,...e){return e.reduce((t,e)=>t?t[e]:void 0,t)}function c(t){let e=0;for(let n=0;n<t.length;n++)e=(e<<5)-e+t.charCodeAt(n),e&=e;return e}function l(){let t,e;return{promise:new Promise((n,r)=>{t=n,e=r}),reject:e,resolve:t}}function d(t,e,n=!1,s=20){let a=0;const o=u=>new Promise(c=>Promise.resolve(e()).then(e=>e?Promise.resolve(t()).then(t=>c(Object(i.o)(t))):Object(r.a)(a++,t=>t<s?setTimeout(()=>c(o(u*(n?2:1))),u):c(i.n))));return o(50)}function f(...t){return e=>t.reduce((t,e)=>Promise.resolve(t).then(e),e)}function _(t){const e={equals:(e,n)=>e[0]===n[0]&&t.equals(e[1],n[1])},n=Object(a.i)(e);return Object(s.a)(t=>Object.entries(t))(n)}function h(t){if("string"==typeof t){const e=+t;if(!isNaN(e))return e}return t}function p(t,e){const n=e=>{if(!r&&e)return r=!0,t()};let r=!1;["blur","visibilitychange"].forEach(t=>{window.addEventListener(t,()=>n(document.hidden&&function(t){return/Mobi|Android/i.test(t)}(e)))}),["beforeunload","pagehide"].forEach(t=>{window.addEventListener(t,()=>n(!0))})}function m(){return([1e7]+-1e3+-4e3+-8e3+-1e11).replace(/[018]/g,t=>(t^(window.crypto||window.msCrypto).getRandomValues(new Uint8Array(1))[0]&15>>t/4).toString(16))}function g(t){return 36===t.length&&/^[0-9A-F]{8}-[0-9A-F]{4}-4[0-9A-F]{3}-[89AB][0-9A-F]{3}-[0-9A-F]{12}$/i.test(t)}function v(t,e){const n=Object.keys(t),r=n.length,s={};for(let a=0;a<r;a++){const r=n[a],o=e(r,t[r]);Object(i.l)(o)&&(s[r]=o.value)}return s}function b(...t){const e={},n=t.length;for(let r=0;r<n;r++){const[n,i]=t[r];e[n]=i}return e}function y(t,e){return v(t,(t,n)=>e(t)?Object(i.o)(n):i.n)}function O(t){return/^((?!chrome|android).)*safari/i.test(t)}},function(t,e,n){"use strict";n.d(e,"a",(function(){return i}));var r=n(4),i=r.f},function(t,e,n){"use strict";n.d(e,"i",(function(){return i})),n.d(e,"j",(function(){return s})),n.d(e,"h",(function(){return a})),n.d(e,"o",(function(){return o})),n.d(e,"n",(function(){return u})),n.d(e,"d",(function(){return c})),n.d(e,"e",(function(){return l})),n.d(e,"g",(function(){return d})),n.d(e,"l",(function(){return f})),n.d(e,"m",(function(){return _})),n.d(e,"q",(function(){return h})),n.d(e,"f",(function(){return p})),n.d(e,"k",(function(){return m})),n.d(e,"c",(function(){return g})),n.d(e,"a",(function(){return v})),n.d(e,"b",(function(){return b})),n.d(e,"p",(function(){return y}));var r=n(1),i=(r.fb,r.db,r.cb),s=r.eb,a=(r.qb,r.zb,r.Eb,r.W),o=(r.X,r.ab,r.Ib,r.Jb,r.kb,r.lb,r.mb,r.pb,r.C,r.Mb,r.gb,r.nb,r.Rb,r.hb,r.Sb);r.Ub;function u(t){return r.Pb(t)}var c=r.F,l=(r.H,r.G);r.S;function d(t){return r.Q(t)}r.R;r.V,r.U,r.Vb,r.ib,r.fc,r.D,r.tb;var f=r.Fb,_=(r.Gb,r.ob,r.Nb),h=r.jc,p=(r.ic,r.ec,r.Hb,r.J);r.ac,r.Ob,r.y,r.Qb,r.z;r.Zb;var m=r.jb,g=r.E,v=(r.ub,r.k.map,r.k.ap,r.k.chain,r.j.mapWithIndex,r.e.filter,r.e.filterMap,r.e.partition,r.e.partitionMap,r.f.filterWithIndex,r.f.filterMapWithIndex,r.f.partitionWithIndex,r.f.partitionMapWithIndex,r.g.reduce,r.g.foldMap,r.g.reduceRight,r.l.traverse,r.b.alt,r.h.reduceWithIndex,r.h.foldMapWithIndex,r.h.reduceRightWithIndex,r.m.traverseWithIndex,r.d.extend,r.n.wither,r.n.wilt,r.rb,r.p,r.q,r.s,r.v),b=(r.x,r.w,r.sb,r.A),y=(r.Kb,r.M,r.N,r.vb,r.yb,r.wb,r.xb,r.o,r.O,r.P,r.L,r.I,r.Y,r.Z,r.Ab,r.Db,r.Bb,r.Cb,r.Wb);r.Lb,r.Xb,r.hc,r.gc,r.Yb,r.b.zero,r.cc,r.dc,r.bc,r.u,r.t,r.r},function(t,e,n){"use strict";n.d(e,"j",(function(){return a})),n.d(e,"i",(function(){return o})),n.d(e,"f",(function(){return u})),n.d(e,"e",(function(){return c})),n.d(e,"c",(function(){return l})),n.d(e,"h",(function(){return d})),n.d(e,"g",(function(){return f})),n.d(e,"b",(function(){return _})),n.d(e,"d",(function(){return h})),n.d(e,"a",(function(){return m}));var r=n(18);function i(t,e){return t<e?-1:t>e?1:0}function s(t,e){return t===e}var a={equals:s,compare:i},o={equals:s,compare:i};function u(t){return function(e,n){return-1===t.compare(e,n)}}function c(t){return function(e,n){return 1===t.compare(e,n)}}function l(t){return function(e,n){return-1!==t.compare(e,n)}}function d(t){return function(e,n){return 1===t.compare(e,n)?n:e}}function f(t){return function(e,n){return-1===t.compare(e,n)?n:e}}function _(t){var e=function(e,n){return e===n?0:t(e,n)};return{equals:function(t,n){return 0===e(t,n)},compare:e}}function h(){return{concat:{concat:function(t,e){return _((function(n,i){return r.b.concat(t.compare(n,i),e.compare(n,i))}))}}.concat,empty:_((function(){return 0}))}}var p=function(t,e){return _((function(n,r){return t.compare(e(n),e(r))}))},m=function(t){return function(e){return p(e,t)}}},function(t,e,n){"use strict";n.d(e,"e",(function(){return a})),n.d(e,"g",(function(){return o})),n.d(e,"b",(function(){return u})),n.d(e,"c",(function(){return c})),n.d(e,"h",(function(){return l})),n.d(e,"d",(function(){return d})),n.d(e,"f",(function(){return f})),n.d(e,"a",(function(){return h}));var r=n(3);n(0);var i=n(4),s=n(10),a=Object(i.d)(r.o,s.h),o=Object(i.d)(r.r,s.h),u=(r.r,r.o,s.e,function(t){return r.m(t)?a(t.left):o(t.right)}),c=function(t){return function(e){return"None"===e._tag?a(t()):o(e.value)}};function l(t,e){return function(){return t().then(r.r,(function(t){return r.o(e(t))}))}}r.f,s.d;var d=function(t){return function(e){return Object(i.f)(e,s.d(r.f(t,s.h)))}};r.s;var f=function(t){return s.g(r.p(t))},_=(r.c,s.g,function(t){return function(e){return Object(i.f)(e,s.d(r.f(a,t)))}}),h=_;i.e},function(t,e,n){"use strict";n.d(e,"e",(function(){return i})),n.d(e,"g",(function(){return u})),n.d(e,"c",(function(){return c})),n.d(e,"h",(function(){return l})),n.d(e,"d",(function(){return d})),n.d(e,"f",(function(){return _})),n.d(e,"a",(function(){return h})),n.d(e,"b",(function(){return p}));var r=n(4),i=function(t){return function(){return Promise.resolve(t())}};var s=function(t,e){return function(){return t().then(e)}},a=function(t,e){return function(){return Promise.all([t(),e()]).then((function(t){return(0,t[0])(t[1])}))}},o=function(t,e){return function(){return t().then((function(t){return e(t)()}))}},u=function(t){return function(e){return s(e,t)}},c=function(t){return function(e){return a(e,t)}},l=function(t){return function(){return Promise.resolve(t)}},d=function(t){return function(e){return o(e,t)}},f=(r.e,"Task");function _(t){return{concat:function(e,n){return function(){return e().then((function(e){return n().then((function(n){return t.concat(e,n)}))}))}}}}var h={URI:f,map:s,ap:a,of:l},p={URI:f,map:s,of:l,ap:a,chain:o}},function(t,e,n){"use strict";function r(t){return{equals:function(e,n){return e===n||t(e,n)}}}n.d(e,"a",(function(){return i})),n.d(e,"d",(function(){return o})),n.d(e,"c",(function(){return u})),n.d(e,"b",(function(){return c})),n.d(e,"e",(function(){return l}));var i=function(t){return function(e){return s(e,t)}},s=function(t,e){return r((function(n,r){return t.equals(e(n),e(r))}))},a={equals:function(t,e){return t===e}};var o=a,u=a,c=a;function l(t){return r((function(e,n){for(var r in t)if(!t[r].equals(e[r],n[r]))return!1;return!0}))}},function(t,e,n){"use strict";n.d(e,"a",(function(){return r})),n.d(e,"e",(function(){return i})),n.d(e,"b",(function(){return s})),n.d(e,"c",(function(){return a})),n.d(e,"d",(function(){return o}));const r=t=>Object.assign({id:t.id,name:t.name,time:new Date(t.time),properties:t.properties||{}},u(t)),i=t=>Object.assign({id:t.id||null,name:t.name,time:(c(t.time)?t.time:new Date).toISOString(),properties:t.properties||{}},u(t)),s=(t,e)=>Object.assign({id:t.id,time:new Date(t.time),name:e.name,properties:e.properties},u(e)),a=t=>void 0!==t.request_id,o=t=>void 0!==t.properties,u=t=>Object.assign(Object.assign({},t.session_id?{session_id:t.session_id}:{}),t.view_id?{view_id:t.view_id}:{}),c=t=>isFinite(t)&&t instanceof Date},function(t,e,n){"use strict";n.d(e,"c",(function(){return s})),n.d(e,"d",(function(){return a})),n.d(e,"e",(function(){return o})),n.d(e,"f",(function(){return u})),n.d(e,"b",(function(){return c})),n.d(e,"a",(function(){return l}));var r=n(5),i=n(0);const s=(t,e)=>t in e,a=t=>Object.entries(t).filter(([t,e])=>{var n;return!0===(null===(n=e.result)||void 0===n?void 0:n.result)}).map(([t,e])=>parseInt(t,10)),o=t=>t.reduce((t,e)=>Object.assign(Object.assign({},t),{[e]:!0}),{}),u=t=>Object(r.j)(t,(t,e)=>e.state?Object(i.o)({[e.checksum]:e.state}):i.n),c=(t,e,n)=>t.filter(t=>{var r,i,s,a;return(null===(i=null===(r=null==t?void 0:t.properties)||void 0===r?void 0:r.client)||void 0===i?void 0:i.type)===e&&(null===(a=null===(s=null==t?void 0:t.properties)||void 0===s?void 0:s.client)||void 0===a?void 0:a.domain)===n}),l=(t,e=100)=>{const n={SegmentEntry:1,SegmentExit:1,ThirdPartySegments:1,PageviewEngagement:1,SlotClicked:1,SlotRendered:1,SlotViewable:1,Reaction:1,PrebidBid:1,PrebidBids:1,rtaBid:1};return t.filter(t=>!n[t.name]).slice(-1*e)}},function(t,e,n){"use strict";n.d(e,"b",(function(){return O})),n.d(e,"a",(function(){return w}));var r,i=n(3),s=(r=function(t,e){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(t,e)},function(t,e){function n(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}),a=function(){function t(t,e,n,r){this.name=t,this.is=e,this.validate=n,this.encode=r,this.decode=this.decode.bind(this)}return t.prototype.pipe=function(e,n){var r=this;return void 0===n&&(n="pipe("+this.name+", "+e.name+")"),new t(n,e.is,(function(t,n){var s=r.validate(t,n);return Object(i.m)(s)?s:e.validate(s.right,n)}),this.encode===o&&e.encode===o?o:function(t){return r.encode(e.encode(t))})},t.prototype.asDecoder=function(){return this},t.prototype.asEncoder=function(){return this},t.prototype.decode=function(t){return this.validate(t,[{key:"",type:this,actual:t}])},t}(),o=function(t){return t},u=i.o,c=function(t,e,n){return u([{value:t,context:e,message:n}])},l=i.r,d=(new(function(t){function e(){var e=t.call(this,"null",(function(t){return null===t}),(function(t,n){return e.is(t)?l(t):c(t,n)}),o)||this;return e._tag="NullType",e}return s(e,t),e}(a)),new(function(t){function e(){var e=t.call(this,"undefined",(function(t){return void 0===t}),(function(t,n){return e.is(t)?l(t):c(t,n)}),o)||this;return e._tag="UndefinedType",e}return s(e,t),e}(a))),f=(new(function(t){function e(){var e=t.call(this,"void",d.is,d.validate,o)||this;return e._tag="VoidType",e}return s(e,t),e}(a)),new(function(t){function e(){var e=t.call(this,"unknown",(function(t){return!0}),l,o)||this;return e._tag="UnknownType",e}return s(e,t),e}(a)),new(function(t){function e(){var e=t.call(this,"string",(function(t){return"string"==typeof t}),(function(t,n){return e.is(t)?l(t):c(t,n)}),o)||this;return e._tag="StringType",e}return s(e,t),e}(a)),new(function(t){function e(){var e=t.call(this,"number",(function(t){return"number"==typeof t}),(function(t,n){return e.is(t)?l(t):c(t,n)}),o)||this;return e._tag="NumberType",e}return s(e,t),e}(a))),_=(new(function(t){function e(){var e=t.call(this,"bigint",(function(t){return"bigint"==typeof t}),(function(t,n){return e.is(t)?l(t):c(t,n)}),o)||this;return e._tag="BigIntType",e}return s(e,t),e}(a)),new(function(t){function e(){var e=t.call(this,"boolean",(function(t){return"boolean"==typeof t}),(function(t,n){return e.is(t)?l(t):c(t,n)}),o)||this;return e._tag="BooleanType",e}return s(e,t),e}(a)),new(function(t){function e(){var e=t.call(this,"UnknownArray",Array.isArray,(function(t,n){return e.is(t)?l(t):c(t,n)}),o)||this;return e._tag="AnyArrayType",e}return s(e,t),e}(a)),new(function(t){function e(){var e=t.call(this,"UnknownRecord",(function(t){var e=Object.prototype.toString.call(t);return"[object Object]"===e||"[object Window]"===e}),(function(t,n){return e.is(t)?l(t):c(t,n)}),o)||this;return e._tag="AnyDictionaryType",e}return s(e,t),e}(a)),new(function(t){function e(){var e=t.call(this,"Function",(function(t){return"function"==typeof t}),(function(t,n){return e.is(t)?l(t):c(t,n)}),o)||this;return e._tag="FunctionType",e}return s(e,t),e}(a)),function(t){function e(e,n,r,i,s,a){var o=t.call(this,e,n,r,i)||this;return o.type=s,o.predicate=a,o._tag="RefinementType",o}return s(e,t),e}(a)),h=(m(f,(function(t){return Number.isInteger(t)}),"Int"),function(t){function e(e,n,r,i,s){var a=t.call(this,e,n,r,i)||this;return a.value=s,a._tag="LiteralType",a}s(e,t)}(a),function(t){function e(e,n,r,i,s){var a=t.call(this,e,n,r,i)||this;return a.keys=s,a._tag="KeyofType",a}s(e,t)}(a),Object.prototype.hasOwnProperty,function(t){function e(e,n,r,i,s){var a=t.call(this,e,n,r,i)||this;return a.runDefinition=s,a._tag="RecursiveType",a}return s(e,t),e}(a));Object.defineProperty(h.prototype,"type",{get:function(){return this.runDefinition()},enumerable:!0,configurable:!0});(function(t){function e(e,n,r,i,s){var a=t.call(this,e,n,r,i)||this;return a.type=s,a._tag="ArrayType",a}s(e,t)})(a),function(t){function e(e,n,r,i,s){var a=t.call(this,e,n,r,i)||this;return a.props=s,a._tag="InterfaceType",a}s(e,t)}(a),function(t){function e(e,n,r,i,s){var a=t.call(this,e,n,r,i)||this;return a.props=s,a._tag="PartialType",a}s(e,t)}(a),function(t){function e(e,n,r,i,s,a){var o=t.call(this,e,n,r,i)||this;return o.domain=s,o.codomain=a,o._tag="DictionaryType",o}s(e,t)}(a);var p=function(t){function e(e,n,r,i,s){var a=t.call(this,e,n,r,i)||this;return a.types=s,a._tag="UnionType",a}return s(e,t),e}(a);!function(t){function e(e,n,r,i,s){var a=t.call(this,e,n,r,i)||this;return a.types=s,a._tag="IntersectionType",a}s(e,t)}(a);!function(t){function e(e,n,r,i,s){var a=t.call(this,e,n,r,i)||this;return a.types=s,a._tag="TupleType",a}s(e,t)}(a);(function(t){function e(e,n,r,i,s){var a=t.call(this,e,n,r,i)||this;return a.type=s,a._tag="ReadonlyType",a}s(e,t)})(a),function(t){function e(e,n,r,i,s){var a=t.call(this,e,n,r,i)||this;return a.type=s,a._tag="ReadonlyArrayType",a}s(e,t)}(a),function(t){function e(e,n,r,i,s,a){var o=t.call(this,e,n,r,i,s)||this;return o.tag=a,o}s(e,t)}(p),function(t){function e(e,n,r,i,s){var a=t.call(this,e,n,r,i)||this;return a.type=s,a._tag="ExactType",a}s(e,t)}(a),new(function(t){function e(){var e=t.call(this,"never",(function(t){return!1}),(function(t,e){return c(t,e)}),(function(){throw new Error("cannot encode never")}))||this;return e._tag="NeverType",e}return s(e,t),e}(a)),new(function(t){function e(){var e=t.call(this,"any",(function(t){return!0}),l,o)||this;return e._tag="AnyType",e}return s(e,t),e}(a)),new(function(t){function e(){var e=t.call(this,"object",(function(t){return null!==t&&"object"==typeof t}),(function(t,n){return e.is(t)?l(t):c(t,n)}),o)||this;return e._tag="ObjectType",e}return s(e,t),e}(a));function m(t,e,n){var r;return void 0===n&&(n="("+t.name+" | "+(((r=e).displayName||r.name||"<function"+r.length+">")+")")),new _(n,(function(n){return t.is(n)&&e(n)}),(function(n,r){var s=t.validate(n,r);if(Object(i.m)(s))return s;var a=s.right;return e(a)?l(a):c(a,r)}),t.encode,t,e)}m(f,Number.isInteger,"Integer"),function(t){function e(e,n,r,i,s){var a=t.call(this,e,n,r,i)||this;return a.props=s,a._tag="StrictType",a}s(e,t)}(a);var g=n(2),v=n(7),b=n(6),y=n(4);function O(t){switch(t.kind){case"null":return k.encode(t);case"string":return j.encode(t);case"number":return E.encode(t);case"array":return M.encode(t);case"object":return S.encode(t)}}function w(t){return null===t?k.decode(t):"number"==typeof t?E.decode(t):"string"==typeof t?j.decode(t):Array.isArray(t)?M.decode(t):S.decode(t)}const k=new a("simpleNullCodec",t=>{const e=t;return"null"===e.kind&&null===e.value},(t,e)=>null===t?l(Object(g.j)()):c(t,e),t=>t.value),j=new a("simpleStringCodec",t=>{const e=t;return"string"===e.kind&&"string"==typeof e.value},(t,e)=>"string"==typeof t?l(Object(g.m)(t)):c(t,e),t=>t.value),E=new a("simpleNumberCodec",t=>{const e=t;return"number"===e.kind&&"number"==typeof e.value},(t,e)=>"number"==typeof t?l(Object(g.k)(t)):c(t,e),t=>t.value),M=new a("simpleArrayCodec",t=>{const e=t;return"array"===e.kind&&Array.isArray(e.value)},(t,e)=>{if(Array.isArray(t)){const e=Object(v.p)(i.e)(w)(t);return Object(i.p)(g.i)(e)}return c(t,e)},t=>t.value.map(O)),S=new a("simpleObjectCodec",t=>"object"===t.kind,(t,e)=>{if(t&&t.constructor===Object){const e=Object(v.p)(i.e)(([t,e])=>Object(b.a)(w(e),Object(i.p)(e=>Object(y.g)(t,e))))(Object.entries(t));return Object(i.p)(t=>Object(g.l)(new Map([...t])))(e)}return c(t,e)},t=>{const e=[...t.value.entries()];return Object.assign({},...Array.from(e,([t,e])=>({[t]:O(e)})))});new a("simpleJsonCodec",t=>k.is(t)||E.is(t)||j.is(t)||M.is(t)||S.is(t),w,O)},function(t,e,n){"use strict";n.d(e,"a",(function(){return u})),n.d(e,"b",(function(){return c}));var r=n(0),i=n(7),s=n(6),a=n(4),o=n(11);class u{constructor(t,e,n){this._internals=t,this.permutive=e,this.network=n,this.providers={},this.identities=this._internals.state.getPermutiveData("identities")||{},this.aliases=this._internals.state.getPermutiveData("aliases")||{}}prepareThirdPartyIdentities(){const t=this._internals.metrics.startTimer("sdk_get_third_party_identities_task_duration_seconds",{}),e=[Promise.resolve().then(n.bind(null,39))];return Promise.all(e).then(t=>Promise.all(t.map(t=>t.make(this._internals,this.network,this.permutive)))).then(t=>Object(s.a)(Object(i.b)(t),t=>Promise.all(t.map(t=>this.shouldAskForNewIdentity(t)?this.retrieveIdentity(t):Promise.resolve(Object(a.g)(t,this.getCachedIdentity(t.tag))))))).then(t=>t.map(([t,e])=>(this.providers[t.tag]=t,this.setIdentityAndAliasIfPresent(t.tag,e,t.ttlInSeconds)))).then(()=>this._internals.metrics.stopTimer("sdk_get_third_party_identities_task_duration_seconds",t))}getIdentities(t=!1){const e=e=>this.identities[e].value&&(!t||this.providers[e].usedForThirdPartyData);return Object.keys(this.identities).reduce((t,n)=>Object.assign(Object.assign({},t),e(n)?{[n]:this.identities[n].value}:{}),{})}getAliasesFromIdentifyArg(t){if("string"!=typeof t&&"object"!=typeof t||null===t||""===t)throw new Error("Identify must be passed a non-empty string or list of aliases, value passed was '"+t+"'");return"string"==typeof t?[{id:t,tag:"default"}]:t}aliasMapToPrioritizedList(t){const e={default:0,appnexus:1},n=t=>Object(r.k)(this._internals.identities.getCachedIdentity(t))?0:t in e?e[t]+1:1;return Object.keys(t).map(e=>({id:t[e],tag:e,priority:n(e)}))}shouldAskForNewIdentity(t){const e=Object(r.d)(this.identities[t.tag]);return Object(r.b)(()=>!0,e=>this.isIdentityExpired(t.tag))(e)}getCachedIdentity(t){return this.identities[t]?Object(r.d)(this.identities[t].value):r.n}setIdentityAndAliasIfPresent(t,e,n=86400){return Object(r.b)(()=>{this.identities[t]={expiry:Date.now()+Math.floor(1e3*n)},this._internals.state.setPermutiveData("identities",this.identities)},e=>{this.identities[t]={value:e,expiry:Date.now()+Math.floor(1e3*n)},this.setAlias(e,t),this._internals.state.setPermutiveData("identities",this.identities)})(e)}setAlias(t,e){this.aliases[e]=t,this._internals.state.setPermutiveData("aliases",this.aliases)}retrieveIdentity(t){return t.getId().then(e=>"skipped"===e.type?Object(a.g)(t,r.n):Object(s.a)(e.result,e=>this._internals.metrics.track({name:Object(r.l)(e)?"sdk_third_party_identity_present_count":"sdk_third_party_identity_missing_count",value:1,labels:{identity_tag:t.tag}}),n=>Object(a.g)(t,e.result)))}isIdentityExpired(t){return Date.now()>=this.identities[t].expiry}}const c=(t,e,n,r)=>{const s={"e43c8a90-d17b-4790-bfda-81b069b3b8c2":(t,e,n)=>["thestudentroom.co.uk"].some(t=>n.indexOf(t)>-1)&&Object(i.k)(o.d)(e,["tsr-"]).length>0,"5d79bce7-5d2b-427e-a6c4-b89b6c7bf048":(t,e)=>{const n=["(null)"];return n.indexOf(t)>-1||!!l[t]||Object(i.k)(o.d)(e,n).length>0}}[t];return!!s&&s(r,e,n)},l={}},function(t,e,n){"use strict";n.d(e,"b",(function(){return H})),n.d(e,"a",(function(){return V}));var r=n(2),i=n(8);const s=(t,e)=>{switch(t.kind){case"bottom":return Object(r.a)();case"inner":return Object(r.e)(e(t.a));case"top":return Object(r.o)(t.error)}},a=t=>Object(i.b)((e,n)=>{if("bottom"===e.kind&&"bottom"===n.kind)return 0;if("bottom"===e.kind)return-1;if("bottom"===n.kind)return 1;if("top"===e.kind&&"top"===n.kind)return i.j.compare(e.error,n.error);if("top"===e.kind)return 1;if("top"===n.kind)return-1;if("inner"===e.kind&&"inner"===n.kind)return t.compare(e.a,n.a);throw new Error("Non exhaustive match in extendedAlgebraOrd")});var o=n(0),u=(n(4),n(1));var c=u.C;u.Mb;function l(t){return u.lb(t)?Object(o.o)(t):o.n}u.fb;u.Fb;var d=u.cb;u.ub;u.jc,u.ic,u.ec,u.i.map,u.j.mapWithIndex,u.c.ap,u.k.chain,u.d.extend,u.g.reduce,u.g.foldMap,u.g.reduceRight,u.l.traverse,u.a.alt,u.h.reduceWithIndex,u.h.foldMapWithIndex,u.h.reduceRightWithIndex,u.m.traverseWithIndex,u.o,u.p,u.q,u.s,u.v,u.w,u.I,u.L,u.W,u.rb,u.sb,u.Ab,u.Db,u.Bb,u.Cb,u.Wb,u.Lb,u.Xb;var f=c,_=function(t){return l(u.bb(t))},h=d;var p=n(7),m=n(3),g=n(18);function v(t,e){return Object(p.b)(t.map(e))}function b(t,e,n,r){const s=(t,e)=>{if(0===t.length)return Object(p.b)(e.map(t=>Object(o.o)({1:t[1],2:n(o.n,Object(o.o)(t[2]))})));if(0===e.length)return Object(p.b)(t.map(t=>Object(o.o)({1:t[1],2:n(Object(o.o)(t[2]),o.n)})));if(t.length>0&&e.length>0&&Object(i.f)(r)(t[0][1],e[0][1])){const[r,...i]=t,a=r[1],u=r[2];return f({1:a,2:n(Object(o.o)(u),o.n)},s(i,e))}if(t.length>0&&e.length>0&&Object(i.e)(r)(t[0][1],e[0][1])){const[r,...i]=e,a=r[1],u=r[2];return f({1:a,2:n(o.n,Object(o.o)(u))},s(t,i))}if(t.length>0&&e.length>0){const[r,...i]=t,[a,...u]=e,c=r[1],l=r[2],d=a[2];return f({1:c,2:n(Object(o.o)(l),Object(o.o)(d))},s(i,u))}throw new Error("Non exhaustive match in mapOption2")},a=Object(i.a)(t=>t[1])(r),u=(t=>{const e=v(t,t=>Object(o.l)(t[2])?Object(o.o)({1:t[1],2:t[2].value}):o.n);return 0===e.length?o.n:Object(o.o)(e)})(s(Object(p.m)(a)([...t].map(t=>({1:t[0],2:t[1]}))),Object(p.m)(a)([...e].map(t=>({1:t[0],2:t[1]})))));return Object(o.m)(t=>new Map(t.map(t=>[t[1],t[2]])))(u)}function y(t,e,n,r){const s=Object(i.a)(t=>t[0])(r),a=Object(p.m)(s)([...e]).reduceRight((t,e)=>{if(Object(m.m)(t)){const r=n(e[1],t.left);return Object(o.l)(r)?Object(m.o)(r.value):Object(m.r)(e[0])}return t},Object(m.o)(t));return Object(o.c)(a)}function O(t,e){return new Map([...t].map(e))}function w(t,e){return new Map([...t].filter(e))}var k=n(11),j=n(6);function E(t){return Object(o.m)(C)(function(t){switch(t.state.kind){case"top":return Object(o.o)(Object(r.m)(t.state.error));case"bottom":return o.n;case"inner":return function(t){return function(t){switch(t.kind){case"numberGroup":case"stringGroup":return M(t.group);case"tuple":return t.tuple.length>0}}(t.payload)?Object(o.o)(Object(r.i)(function(t,e){const n=Object(o.m)(t=>f(t,e))(t);return Object(o.h)(()=>e)(n)}(Object(o.m)(t=>Object(r.m)(function(t){const e=t=>{switch(t){case"add":return"p";case"mul":return"m";case"max":return"v";case"min":return"n"}};return t.map(t=>1===t[2]?e(t[1]):e(t[1])+JSON.stringify(t[2])).join("")}(t)))(t.commands),function(t){const e=t=>{switch(t.kind){case"bottom":return Object(r.j)();case"top":return Object(r.m)(t.error);case"inner":return Object(r.k)(t.a)}};switch(t.kind){case"tuple":return t.tuple.map(e);case"stringGroup":return n=t.group,v([S,P,t=>Object(j.a)(t,T,r.l,o.o)],t=>t(n));case"numberGroup":return(t=>v([S,I,t=>Object(j.a)(t,T,t=>O(t,([t,e])=>[JSON.stringify(t),e]),r.l,o.o)],e=>e(t)))(t.group)}var n}(t.payload)))):o.n}(t.state.a)}}(t))}function M(t){switch(t.kind){case"unbounded":return t.group.size>0;case"windowed":return t.group.size>0||Object(o.l)(t.key);case"countLimit":case"uniqueLimit":return t.group.size>0||Object(o.l)(t.limit)}}function S(t){switch(t.kind){case"unbounded":return o.n;case"windowed":return Object(o.o)(Object(r.m)("w"));case"countLimit":return Object(o.o)(Object(r.m)(1===t.n?"x":"x"+t.n));case"uniqueLimit":return Object(o.o)(Object(r.m)(1===t.n?"u":"u"+t.n))}}function P(t){switch(t.kind){case"unbounded":return o.n;case"windowed":return Object(o.o)(Object(r.m)(Object(o.l)(t.key)?t.key.value:""));case"countLimit":case"uniqueLimit":return Object(o.o)(Object(r.m)(Object(o.l)(t.limit)?t.limit.value:""))}}function I(t){switch(t.kind){case"unbounded":return o.n;case"windowed":return Object(o.l)(t.key)?Object(o.o)(Object(r.k)(t.key.value)):Object(o.o)(Object(r.j)());case"countLimit":case"uniqueLimit":return Object(o.l)(t.limit)?Object(o.o)(Object(r.k)(t.limit.value)):Object(o.o)(Object(r.j)())}}function T(t){switch(t.kind){case"unbounded":case"windowed":case"countLimit":case"uniqueLimit":return t.group}}function C(t){switch(t.kind){case"array":return 0===t.value.length?Object(r.j)():1===t.value.length?C(t.value[0]):Object(r.i)(t.value.map(C));case"object":return Object(j.a)(w(t.value,([t,e])=>"null"!==e.kind),t=>O(t,t=>[t[0],C(t[1])]),r.l);default:return t}}function D(t){const e=t=>{if(0===t.length)return Object(r.a)();const e=(t=>{if(4!==t.length)return o.n;const[e,n,r,i]=t;if("string"===e.kind&&"string"===n.kind&&"object"===i.kind){const t=Object(o.e)(t=>A(t[1].value)&&x(t[2].value))({1:e,2:n});return Object(o.m)(t=>({prim:t[1].value,grp:t[2].value,cutoff:r,m:i.value}))(t)}return o.n})(t);if(Object(o.l)(e)){const{prim:t,grp:n,cutoff:i,m:s}=e.value,a=q(i,s,R(n));return"string"==typeof a?Object(r.o)(a):Object(r.e)(Object(r.f)(L(t),a))}const n=(t=>{if(3!==t.length)return o.n;const[e,n,r]=t;if("string"===e.kind&&"object"===r.kind){const t=Object(o.e)(t=>x(t.value))(e);return Object(o.m)(t=>({grp:t.value,cutoff:n,m:r.value}))(t)}return o.n})(t);if(Object(o.l)(n)){const{grp:t,cutoff:e,m:i}=n.value,s=q(e,i,R(t));return"string"==typeof s?Object(r.o)(s):Object(r.e)(Object(r.f)(o.n,s))}const i=(t=>{if(2!==t.length)return o.n;const[e,n]=t;if("string"===e.kind&&"object"===n.kind){const t=Object(o.e)(t=>A(t.value))(e);return Object(o.m)(t=>({prim:t.value,m:n.value}))(t)}return o.n})(t);if(Object(o.l)(i)){const{prim:t,m:e}=i.value;return Object(r.e)(Object(r.f)(L(t),Object(r.n)(Object(r.q)(e))))}const s=(t=>{if(1!==t.length)return o.n;const[e]=t;return"object"===e.kind?Object(o.o)({m:e.value}):o.n})(t);if(Object(o.l)(s)){const{m:t}=s.value;return Object(r.e)(Object(r.f)(o.n,Object(r.n)(Object(r.q)(t))))}const a=(t=>{if(t.length<1)return o.n;const[e,...n]=t;if("string"===e.kind){const t=Object(o.e)(t=>A(t.value))(e);return Object(o.m)(t=>({prim:t.value,rest:n}))(t)}return o.n})(t);if(Object(o.l)(a)){const{prim:t,rest:e}=a.value;return Object(r.e)(Object(r.f)(L(t),N(e)))}return Object(r.e)(Object(r.f)(o.n,N(t)))},n=t=>{switch(t.kind){case"array":return Object(p.a)(n)(t.value);default:return[t]}};switch(t.kind){case"null":return Object(r.d)(Object(r.a)());default:return Object(r.d)(e(n(t)))}}function A(t){const e=t.split("");switch(!0){case 0===e.length:return!1;default:{const[t,...n]=e;return-1!=="pmvn".indexOf(t)&&n.every(t=>-1!=="pmvn0123456789".indexOf(t))}}}function x(t){const e=t.split("");switch(!0){case 0===e.length:return!1;case"w"===e[0]&&void 0===e[1]:return!0;default:{const[t,...n]=e;return-1!=="ux".indexOf(t)&&-1===n.map(t=>!isNaN(parseInt(t))).indexOf(!1)}}}function q(t,e,n){switch(t.kind){case"string":return Object(r.n)(n({1:Object(o.o)(t.value),2:e}));case"number":case"null":return Object(r.g)(n({1:"null"===t.kind?o.n:Object(o.o)(t.value),2:w(O(e,([t,e])=>[Number(t),e]),t=>!isNaN(t[0]))}));default:return"{bad cutoff}"}}function R(t){const e=t=>e=>Object(r.r)(e[2],e[1],t),n=t=>e=>Object(r.c)(e[2],e[1],t),i=t.split("");switch(!0){case"w"===i[0]&&void 0===i[1]:return t=>Object(r.s)(t[2],t[1]);case"u"===i[0]&&void 0===i[1]:return e(1);case"u"===i[0]&&void 0!==i[1]:return e(parseInt(i.slice(1).join("")));case"x"===i[0]&&void 0===i[1]:return n(1);case"x"===i[0]&&void 0!==i[1]:return n(parseInt(i.slice(1).join("")));default:throw new Error("This should never happen if you use isGroupCommand")}}function L(t){return Object(o.m)(r.h)(_(function t(e,n){const r=n(e);return Object(o.h)(()=>[])(Object(o.m)(e=>[e[1]].concat(t(e[2],n)))(r))}(t,t=>{const e=t.split("");if(0===e.length)return o.n;const[n,...r]=e,i=(t=>{switch(t){case"p":return Object(o.o)("add");case"m":return Object(o.o)("mul");case"v":return Object(o.o)("max");case"n":return Object(o.o)("min");default:return o.n}})(n);return Object(o.m)(t=>{const{init:e,rest:n}=Object(p.n)(t=>{return"number"==typeof(e=parseInt(t))&&isFinite(e)&&Math.floor(e)===e;var e})(r);return{1:{1:t,2:0===e.length?1:parseInt(e.join(""))},2:n.join("")}})(i)})))}function N(t){return Object(r.p)(t.map(U))}function U(t){switch(t.kind){case"number":return Object(r.e)(t.value);case"string":return Object(r.o)(t.value);case"null":return Object(r.a)();case"object":return Object(r.o)("{object}");case"array":return Object(r.o)("{array}")}}const B=Object(r.b)({strategy:(t,e,n)=>r=>{if(Object(o.k)(n))return e;if("delta"===t&&Object(o.k)(e))return o.n;if(Object(o.k)(e))return n;if(Object(o.l)(e)&&Object(o.l)(n))return r(e.value,n.value);throw new Error("Non exhaustive match in combineCommand.strategy")},operation:(t,e,n,s,o,u)=>{const c=Object(p.j)(a(u));if("append"===t&&"add"===e)return Object(p.q)(n,s,J(o.plus));if("append"===t&&"mul"===e)return Object(p.q)(n,s,J(o.times));if("append"===t&&"max"===e)return Object(i.g)(c)(n,s);if("join"===t&&"add"===e)return Object(p.q)(n,s,J(Object(i.g)(u)));if("join"===t&&"mul"===e)return Object(p.q)(n,s,J(Object(i.g)(u)));if("join"===t&&"max"===e)return Object(i.g)(c)(n,s);if("min"===e)return B.operation(t,"max",n,s,o,function(t){return Object(i.b)((e,n)=>Object(g.a)(t.compare(e,n)))}(u));if("delta"===t&&"max"===e)return Object(i.e)(c)(n,s)?n:s.map(r.a);if("delta"===t)return Object(p.q)(n,s,(t,e)=>Object(i.e)(a(u))(t,e)?t:Object(r.a)());throw new Error("Non exhaustive match in combineCommand.operation")}}),K={plus:(t,e)=>t+e,times:(t,e)=>t*e};function W(t,e,n,s){if("unbounded"===t.kind&&"unbounded"===e.kind){const i=t.group,a=e.group;return Object(o.h)(r.a)(Object(o.m)(t=>Object(r.e)(Object(r.q)(t)))(b(i,a,n,s)))}if("windowed"===t.kind&&"windowed"===e.kind){const a=t.key,u=t.group,c=e.key,l=e.group,d=Object(i.g)(Object(o.i)(s))(a,c);return Object(o.h)(r.a)(Object(o.m)(t=>Object(r.e)(Object(r.s)(t,d)))(b(u,l,n,s)))}if("countLimit"===t.kind&&"countLimit"===e.kind){const a=t.n,u=e.n;if(a===u){const u=t.limit,c=t.group,l=e.limit,d=e.group,f=Object(i.g)(Object(o.i)(s))(u,l);return Object(o.h)(r.a)(Object(o.m)(t=>Object(r.e)(Object(r.c)(t,f,a)))(b(c,d,n,s)))}return Object(r.o)("Non matching counts")}if("uniqueLimit"===t.kind&&"uniqueLimit"===e.kind){const a=t.n,u=e.n;if(a===u){const u=t.limit,c=t.group,l=e.limit,d=e.group,f=Object(i.g)(Object(o.i)(s))(u,l);return Object(o.h)(r.a)(Object(o.m)(t=>Object(r.e)(Object(r.r)(t,f,a)))(b(c,d,n,s)))}return Object(r.o)("Non matching counts")}return Object(r.o)("Non matching group types")}function z(t,e,n){return Object(o.h)(r.j)(function t(e,n){const a=n=>(r,i)=>B.strategy(e,r,i)(t(e,n)),u=(t,n,u)=>{if("stringGroup"===n.kind&&"stringGroup"===u.kind){const e=W(n.group,u.group,a(t),i.j);return s(e,t=>Object(r.n)(F(t,i.j)))}if("numberGroup"===n.kind&&"numberGroup"===u.kind){const e=W(n.group,u.group,a(t),i.i);return s(e,t=>Object(r.g)(F(t,i.i)))}if("tuple"===n.kind&&"tuple"===u.kind){const s=Object(o.l)(t)?t.value:[];return Object(r.e)(Object(r.p)(function(t,e,n,i,s,a){const o=(t,e)=>({1:Object(p.o)(t)(e).concat([...Array(Math.max(0,t-e.length))].map(r.a)),2:Object(p.d)(t)(e)}),u=(e,n,r)=>{if(0===e.length)return B.operation(t,"max",n,r,s,a);if(0===n.length)return r;if(0===r.length)return n;if(e.length>0){const[i,...c]=e,l=o(i[2],n),d=l[1],f=l[2],_=o(i[2],r),h=_[1],p=_[2];return B.operation(t,i[1],d,h,s,a).concat(u(c,f,p))}throw new Error("Non exhaustive match in recurse")};return Object(p.l)(Object(p.e)(t=>"bottom"===t.kind)(Object(p.l)(u(e,n,i))))}(e,s,n.tuple,u.tuple,K,i.i)))}throw new Error(`Non matching payload. Got ${n.kind} and ${u.kind}`)},c=(t,e)=>{if(Object(o.f)(h(Object(k.e)({1:k.d,2:k.c}))).equals(t.commands,e.commands)){const i=Object(o.k)(t.commands)?n:t.commands,a=u(i,t.payload,e.payload);return s(a,e=>Object(r.f)(t.commands,e))}throw new Error(`Non matching primitive strings. Got ${JSON.stringify(t)} and ${JSON.stringify(e)}`)};return(t,e)=>E(Object(r.d)(G(c,D(t).state,D(e).state)))}(t,o.n)(e,n))}function $(t,e,n){const r=Object(o.m)(e=>w(t,([t,r])=>Object(i.c)(n)(t,e)))(e);return Object(o.h)(()=>t)(r)}function F(t,e){switch(t.kind){case"unbounded":return t;case"windowed":return Object(o.k)(t.key)?t:Object(r.s)($(t.group,t.key,e),t.key);case"countLimit":{const n=t.limit,s=t.n,a=t.group,u=y(s,a,(t,e)=>e<=1?o.n:Object(o.o)(e-1),e),c=Object(i.g)(Object(o.i)(e))(n,u);return Object(r.c)($(a,c,e),c,s)}case"uniqueLimit":{const n=t.limit,s=t.n,a=t.group,u=(t,e)=>{switch(t.kind){case"object":{const n=[...t.value.keys(),...e.keys()],r=new Set(n);return r.size>=s?o.n:Object(o.o)(r)}default:return o.n}},c=y(new Set,a,u,e),l=Object(i.g)(Object(o.i)(e))(n,c);return Object(r.r)($(a,l,e),l,s)}}}function G(t,e,n){if("inner"===e.kind&&"inner"===n.kind)return t(e.a,n.a);if("bottom"===e.kind)return n;if("bottom"===n.kind)return e;if("top"===e.kind&&"top"===n.kind)return Object(r.o)(Object(i.g)(i.j)(e.error,n.error));if("top"===e.kind)return e;if("top"===n.kind)return n;throw new Error("Non exhaustive match in extend")}function J(t){return(e,n)=>G((e,n)=>Object(r.e)(t(e,n)),e,n)}function H(t,e){return z("join",t,e)}function V(t,e){return z("delta",t,e)}},function(t,e,n){"use strict";n.d(e,"b",(function(){return i})),n.d(e,"a",(function(){return s}));var r=n(5);class i{track(t){}trackTimeSinceInit(t,e){}startTimer(t,e){return""}stopTimer(t,e){}}class s{constructor(t,e,n){this.sdkInitTimestamp=t,this._internals=e,this.permutive=n,this.sendFrequencyInSeconds=5,this.pendingMetrics=[],this.pendingTimers={},this.permutive.ready(()=>{window.setInterval(this.processPending.bind(this),1e3*this.sendFrequencyInSeconds),Object(r.n)(()=>{this.processPending.bind(this)},navigator.userAgent)},"initialised"),this.track({name:"sdk_initialisation_start_time_seconds",value:t/1e3,labels:{}})}track(t){this.pendingMetrics.push(t)}trackTimeSinceInit(t,e){const n=performance.now();this.track({name:t,value:(n-this.sdkInitTimestamp)/1e3,labels:e})}startTimer(t,e){const n=performance.now(),r=this.generateRandomKey(t);return this.pendingTimers[r]={startTime:n,labels:e},r}stopTimer(t,e){const n=this.pendingTimers[e];if(n){const r=performance.now();this.track({name:t,value:(r-n.startTime)/1e3,labels:n.labels}),delete this.pendingTimers[e]}}processPending(){this.pendingMetrics.length>0&&(this._internals.api.metrics({context:{environment:"web",events_count:this._internals.state.eventsCache.all().length,segments_count:this._internals.queryManager.userSegments.length},items:this.pendingMetrics}),this.pendingMetrics=[])}generateRandomKey(t){return`${t}-${[...Array(24)].map(()=>Math.random().toString(36)[2]).join("")}`}}},function(t,e,n){"use strict";n.d(e,"b",(function(){return r})),n.d(e,"a",(function(){return i}));var r={concat:function(t,e){return 0!==t?t:e},empty:0};function i(t){switch(t){case-1:return 1;case 1:return-1;default:return 0}}},function(t,e,n){"use strict";n.d(e,"b",(function(){return r})),n.d(e,"a",(function(){return i}));class r{}class i{constructor(){this.replacementMap={}}register(t){this.replacementMap=Object.assign(Object.assign({},this.replacementMap),t.replacementMap)}enrich(t){const e=[{},!0];for(let n=0;n<Object.keys(t[0]).length;n++){const r=Object.keys(t[0])[n],i=t[0][r];switch(!0){case"string"==typeof i&&"$"===i[0]:const[t,n]=this.isPropertyReplaceable(i);e[0][r]=t?n:i,e[1]=!!t&&e[1];break;case null!==i&&"object"==typeof i&&i.constructor===Object:const s=this.enrich([i,e[1]]);e[0][r]=s[0],e[1]=e[1]&&s[1];break;default:e[0][r]=i}}return e}isPropertyReplaceable(t){const e=this.replacementMap[t];return[this.replacementMap.hasOwnProperty(t)&&e!==t,e]}}},function(t,e,n){"use strict";n.d(e,"a",(function(){return r}));class r{constructor(t){this.config=t,this.clientErrorsSent=0}getEndpointUrl(t,e){return`${this.config.apiProtocol}://${this.config.apiHost}/${e||this.config.apiVersion}${t}`}req(t,e){const n=-1===t.url.indexOf("?")?"?":"&",r=`${t.url}${n}k=${this.config.apiKey}`,i=t.method||"GET",s=t.data?JSON.stringify(t.data):"",a=t.contentType?t.contentType:"application/json";if(e&&navigator.sendBeacon){if(navigator.sendBeacon(r,s))return t.success&&t.success(s),Promise.resolve();{const e="Failed to queue beacon";return t.error&&t.error(e),Promise.reject(e)}}return this.ajax({type:i,url:r,contentType:a,dataType:t.dataType?t.dataType:"json",data:s,timeout:this.config.requestTimeout,xhrFields:t.xhrFields}).then(e=>(t.success&&t.success(e),e),e=>{throw t.error&&t.error(e),new Error(e)})}ajax(t){return new Promise((e,n)=>{const r={},i=t.dataType?t.dataType:"json",s=new XMLHttpRequest;var a,o;if(t.contentType&&(a="Content-Type",o=t.contentType,r[a.toLowerCase()]=[a,o]),"binary"===t.dataType&&(s.responseType="arraybuffer"),s.onload=function(){const t=s.getResponseHeader("content-type");if(this.status>=400){const t="text"===this.responseType||""===this.responseType?this.responseText:"Couldn't access response text";n(`Failed ajax request. Status code was ${this.status}. ${t}`)}else if("application/octet-stream"===t){const t=this.responseText?JSON.parse(window.atob(this.responseText)):null;e(t)}else if("json"===i){const t=this.responseText?JSON.parse(this.responseText):null;e(t)}else e("text"===i?this.responseText:this.response)},s.onerror=()=>{this.error("Failed AJAX request"),n(new TypeError("Network request failed"))},s.ontimeout=()=>{this.error("AJAX request timed out"),n(new TypeError("Network request timed out"))},s.open(t.type?t.type:"GET",t.url,!0),t.timeout&&(s.timeout=t.timeout),t.xhrFields)for(const e in t.xhrFields)s[e]=t.xhrFields[e];Object.keys(r).forEach(t=>{const e=r[t];s.setRequestHeader(e[0],e[1])}),s.send(t.data?t.data:null)})}error(t,e){if(this.config.sendClientErrors){if(this.clientErrorsSent>3)return;this.clientErrorsSent+=1;const n={user_id:e||"",domain:window.location.hostname?window.location.hostname:"",url:window.location.href?window.location.href:"",referrer:document.referrer?document.referrer:"",user_agent:navigator.userAgent?navigator.userAgent:"",error_message:"",stack_trace:"",additional_details:""};t instanceof Error?(void 0!==t.message&&(n.error_message=t.message.toString()),void 0!==t.stack&&(n.stack_trace=t.stack.toString())):n.additional_details=t.toString(),this.req({url:this.getEndpointUrl("/internal/errors"),method:"POST",data:n,contentType:"text/plain",dataType:"text"},!1)}else window.console&&(window.console.error?window.console.error("[Permutive]",t):window.console.log&&window.console.log("[Permutive]",t))}}},function(t,e,n){"use strict";n.d(e,"a",(function(){return i}));var r=n(15);class i{constructor(t,e){this.userId=t,this.aliases=e,this.resource="userIdentify",this.query=()=>{const t=this.aliases.map(({id:t,tag:e,priority:n})=>`{id: "${t}", tag: "${e}", priority: ${n}}`).join(",");return Object(r.b)("6c3e19e3-d05e-45d1-8f79-fcd6cb2f3a21",this.aliases.map(t=>t.id),window.location.hostname,this.userId)?"":`\n      userIdentify: user(user_id: "${this.userId}") {\n        identity(aliases: [${t}]) {\n          identify {\n            id\n          }\n        }\n      }\n    `}}}},function(t,e,n){"use strict";n.d(e,"a",(function(){return s}));var r=n(5);const i={default:{environment:"default",apiHost:"api.permutive.com",apiKey:"",cdnBaseUrl:"cdn.permutive.com",apiVersion:"v2.0",apiProtocol:"https",loggingEnabled:!1,requestTimeout:5e3,cookieDomain:"."+function(t){const e=t.match(/\b(?:(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.){3}(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\b/),n=t.match(/[a-z0-9][a-z0-9-]+\.[a-z.]{2,24}$/i),r=t.match(/localhost/);if((null==n?void 0:n.length)>0){const e=t.split(".").reverse();return e.length>=3&&e[1].match(/^(com|edu|gov|net|mil|org|nom|co|ac|name|info|biz)$/i)?e[2]+"."+e[1]+"."+e[0]:e[1]+"."+e[0]}return(null==e?void 0:e.length)>0?e[0]:(null==r?void 0:r.length)>0?"localhost":""}(window.location.hostname),cookieName:"permutive-id",cookieExpiry:function(){const t=new Date;return t.setFullYear(t.getFullYear()+3),t.toUTCString()}(),permutiveDataKey:"permutive-data",stateNamespace:"",sendClientErrors:!0,metricsSamplingPercentage:20,eventsCacheLimitBytes:25e5,segmentSyncApiHost:"6c3e19e3-d05e-45d1-8f79-fcd6cb2f3a21.partner.permutive.app",consentRequired:!1},production:{},development:{apiProtocol:"http",loggingEnabled:!0,sendClientErrors:!1}};const s=t=>Object(r.k)(i.default,i[t.environment]||{},t)},function(t,e,n){"use strict";var r=window.URL||window.webkitURL;t.exports=function(t,e,n,i){try{try{var s;try{s=new window.Blob([t])}catch(e){(s=new(window.BlobBuilder||window.WebKitBlobBuilder||window.MozBlobBuilder||window.MSBlobBuilder)).append(t),s=s.getBlob()}var a=r.createObjectURL(s),o=new window[e](a,n);return r.revokeObjectURL(a),o}catch(r){return new window[e]("data:application/javascript,".concat(encodeURIComponent(t)),n)}}catch(t){if(!i)throw Error("Inline worker is not supported");return new window[e](i,n)}}},function(t,e,n){"use strict";var r=0;function i(t,e){var n=e.data;if(Array.isArray(n)&&!(n.length<2)){var r=n[0],i=n[1],s=n[2],a=t._callbacks[r];a&&(delete t._callbacks[r],a(i,s))}}function s(t){var e=this;e._worker=t,e._callbacks={},t.addEventListener("message",(function(t){i(e,t)}))}s.prototype.postMessage=function(t){var e=this,n=r++,s=[n,t];return new Promise((function(t,r){if(e._callbacks[n]=function(e,n){if(e)return r(new Error(e.message));t(n)},void 0!==e._worker.controller){var a=new MessageChannel;a.port1.onmessage=function(t){i(e,t)},e._worker.controller.postMessage(s,[a.port2])}else e._worker.postMessage(s)}))},t.exports=s},function(t,e,n){"use strict";n.d(e,"a",(function(){return d}));var r=n(3),i=n(6),s=n(16),a=n(14),o=n(2),u=n(5),c=n(13),l=n(4);class d{constructor(t){this._internals=t,this.fetchedUnseenState=!1,this.stateOffset=this._internals.state.getPermutiveData("state_offset")||0,this.lastSentStateMap=Object(c.f)(this._internals.state.getPermutiveData("internal_query_states")||{})}sync(t,e=this._internals.queryManager.stateMap.value,n=this.stateOffset,u=!this.fetchedUnseenState){const l=Object(i.a)(Object(c.f)(e),a.a,Object(r.j)(t=>Object(o.l)(new Map))),d=Object(i.a)(Object(a.a)(this.lastSentStateMap),Object(r.j)(t=>Object(o.l)(new Map))),f=Object(i.a)(Object(s.a)(l,d),t=>Object(a.b)(t))||{};return u||Object.keys(f).length>0?(()=>this._internals.api.state(f,n,t,u).then(t=>this.isStateResponse(t)?this.handleStateResponse(t):{},t=>(this._internals.network.error(t,this._internals.state.userId),{})).then(t=>(this.fetchedUnseenState=!0,this.lastSentStateMap=Object(c.f)(this._internals.queryManager.stateMap.value),t)))():Promise.resolve({})}resetSync(){return Promise.all([this.sync(!1,{},0,!0),this._internals.thirdParty.segments(),this._internals.models.getModels()]).then(([t,e,n])=>this._internals.queryManager.bootstrap([]).then(t=>this._internals.queryManager.updateEnvironment({segments:Object(u.k)({"1p":this._internals.queryManager.userSegmentsMap},e),lookalikeModels:n})))}reset(){this.lastSentStateMap={}}handleStateResponse(t){const e=Object(r.t)(()=>JSON.parse(t.state),t=>this._internals.network.error("Failed to parse State API response, got "+t,this._internals.state.userId)),n=t=>t?this._internals.queryManager.updateExternalState(t):Object(l.c)();return Object(r.n)(e)?Object(i.a)(t.state_offset,t=>this.stateOffset=t,t=>this._internals.state.setPermutiveData("state_offset",t),t=>n(e.right),t=>e.right):{}}isStateResponse(t){return!!t}}},function(t,e,n){"use strict";n.d(e,"a",(function(){return r}));class r{constructor(t){this.userId=t,this.resource="outOfSdkUserEvents",this.query=()=>`\n    outOfSdkUserEvents: user(user_id: "${this.userId}") {\n      out_of_sdk_events {\n          id\n          name\n          time\n          session_id\n          view_id\n          properties\n        }\n      }\n    `}}},function(t,e,n){"use strict";n.d(e,"a",(function(){return o}));var r=n(4);function i(t,e,n){return function(r){for(var s=Array(n.length+1),a=0;a<n.length;a++)s[a]=n[a];return s[n.length]=r,0===e?t.apply(null,s):i(t,e-1,s)}}var s={1:function(t){return[t]},2:function(t){return function(e){return[t,e]}},3:function(t){return function(e){return function(n){return[t,e,n]}}},4:function(t){return function(e){return function(n){return function(r){return[t,e,n,r]}}}},5:function(t){return function(e){return function(n){return function(r){return function(i){return[t,e,n,r,i]}}}}}};function a(t){return s.hasOwnProperty(t)||(s[t]=i(r.g,t-1,[])),s[t]}function o(t){return function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];for(var r=e.length,i=a(r),s=t.map(e[0],i),o=1;o<r;o++)s=t.ap(s,e[o]);return s}}},function(t,e,n){"use strict";n.d(e,"a",(function(){return L}));class r{constructor(t,e,n,r,i,s,a){this.permutive=t,this._internals=e,this.id=n,this.segmentCode=r,this.triggerType=i,this.config=s,this.workspaceLevelConfig=a}activateEveryTime(){return"EveryTime"===this.triggerType}activateOnEntry(){return"OnEntry"===this.triggerType}activateOnExit(){return"OnExit"===this.triggerType}trackImpression(t){const e={reaction_id:this.id,type:"impression"};this.permutive.track("Reaction",e,t),this._internals.log("impression: ",e)}trackConversion(t){const e={reaction_id:this.id,type:"conversion"};this.permutive.track("Reaction",e,t),this._internals.log("conversion: ",e)}}class i{constructor(t,e,n){this._internals=t,this.permutive=e,this.context=n,this.addons={overlays:{workspaces:[{activations:[]}],auto_init:!0,activationConfigs:[]},web:{workspaces:[{activations:[],add_alchemy_entities:!1,add_alchemy_taxonomy:!1}],auto_init:!1,add_alchemy_entities:!1,add_alchemy_taxonomy:!1,activationConfigs:[]},scriptrunner:{workspaces:[{activations:[]}],auto_init:!0,activationConfigs:[]},dfp:{workspaces:[{activations:[],networks:[{name:"Default",network_code:"4020"}],track_slot_clicked:!0,track_slot_rendered:!1,track_slot_viewable:!0,track_targeting_keys:!1}],auto_init:!0,networks:[{name:"Default",network_code:"4020"}],track_slot_clicked:!0,track_slot_rendered:!1,track_slot_viewable:!0,track_targeting_keys:!1,activationConfigs:[]}},this.optimisedActivationsConfig={dfp:{dfp:[47118,47661,47517,47518,54811,55532,55605,54663],dfp_legacy:{}},eyeota_pixel:[],dbm:{omitted:0},appnexus:{},appnexus_adserver:[],nativo:[]}}getSpecializedActivations(t){return this.optimisedActivationsConfig[t]}getActivations(t){return(this.addons[t]?this.addons[t].activationConfigs:[]).filter(t=>this.areContextCriteriaSatisfied(t)).map(t=>new r(this.permutive,this._internals,t.id,t.segment_code,t.trigger_type,t.config,t.workspaceLevelConfig))}areContextCriteriaSatisfied(t){const e=t.context_criteria,n=t=>{const e=this.context[t.key];switch(t.comparison){case"EQUALS":return e===t.value;case"NOT_EQUALS":return e!==t.value;case"CONTAINS":return"string"==typeof e&&e.indexOf(t.value)>=0;case"NOT_CONTAINS":return"string"==typeof e&&e.indexOf(t.value)<0}};return!e||("AND"===(r=e).operator?r.criteria.every(n):r.criteria.some(n));var r}}var s=n(12),a=n(3),o=n(0),u=n(9),c=n(6);class l{constructor(t){this._internals=t}put(t,e){return Object(c.a)(this._internals.getNamespacedStorageKey(String(e)),e=>window.localStorage.setItem(e,JSON.stringify(t)),t=>Promise.resolve(e))}get(t){return Object(c.a)(this._internals.getNamespacedStorageKey(String(t)),t=>JSON.parse(window.localStorage.getItem(t)),t=>Promise.resolve(t))}delete(t){return Object(c.a)(this._internals.getNamespacedStorageKey(String(t)),t=>Promise.resolve(window.localStorage.removeItem(t)))}deleteStore(){return Promise.resolve()}migrateIfRequired(){return Promise.resolve()}}let d,f;const _=new WeakMap,h=new WeakMap,p=new WeakMap,m=new WeakMap,g=new WeakMap;let v={get(t,e,n){if(t instanceof IDBTransaction){if("done"===e)return h.get(t);if("objectStoreNames"===e)return t.objectStoreNames||p.get(t);if("store"===e)return n.objectStoreNames[1]?void 0:n.objectStore(n.objectStoreNames[0])}return O(t[e])},set:(t,e,n)=>(t[e]=n,!0),has:(t,e)=>t instanceof IDBTransaction&&("done"===e||"store"===e)||e in t};function b(t){return t!==IDBDatabase.prototype.transaction||"objectStoreNames"in IDBTransaction.prototype?(f||(f=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])).includes(t)?function(...e){return t.apply(w(this),e),O(_.get(this))}:function(...e){return O(t.apply(w(this),e))}:function(e,...n){const r=t.call(w(this),e,...n);return p.set(r,e.sort?e.sort():[e]),O(r)}}function y(t){return"function"==typeof t?b(t):(t instanceof IDBTransaction&&function(t){if(h.has(t))return;const e=new Promise((e,n)=>{const r=()=>{t.removeEventListener("complete",i),t.removeEventListener("error",s),t.removeEventListener("abort",s)},i=()=>{e(),r()},s=()=>{n(t.error||new DOMException("AbortError","AbortError")),r()};t.addEventListener("complete",i),t.addEventListener("error",s),t.addEventListener("abort",s)});h.set(t,e)}(t),e=t,(d||(d=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])).some(t=>e instanceof t)?new Proxy(t,v):t);var e}function O(t){if(t instanceof IDBRequest)return function(t){const e=new Promise((e,n)=>{const r=()=>{t.removeEventListener("success",i),t.removeEventListener("error",s)},i=()=>{e(O(t.result)),r()},s=()=>{n(t.error),r()};t.addEventListener("success",i),t.addEventListener("error",s)});return e.then(e=>{e instanceof IDBCursor&&_.set(e,t)}).catch(()=>{}),g.set(e,t),e}(t);if(m.has(t))return m.get(t);const e=y(t);return e!==t&&(m.set(t,e),g.set(e,t)),e}const w=t=>g.get(t);function k(t,e,{blocked:n,upgrade:r,blocking:i,terminated:s}={}){const a=indexedDB.open(t,e),o=O(a);return r&&a.addEventListener("upgradeneeded",t=>{r(O(a.result),t.oldVersion,t.newVersion,O(a.transaction))}),n&&a.addEventListener("blocked",()=>n()),o.then(t=>{s&&t.addEventListener("close",()=>s()),i&&t.addEventListener("versionchange",()=>i())}).catch(()=>{}),o}const j=["get","getKey","getAll","getAllKeys","count"],E=["put","add","delete","clear"],M=new Map;function S(t,e){if(!(t instanceof IDBDatabase)||e in t||"string"!=typeof e)return;if(M.get(e))return M.get(e);const n=e.replace(/FromIndex$/,""),r=e!==n,i=E.includes(n);if(!(n in(r?IDBIndex:IDBObjectStore).prototype)||!i&&!j.includes(n))return;const s=async function(t,...e){const s=this.transaction(t,i?"readwrite":"readonly");let a=s.store;r&&(a=a.index(e.shift()));const o=await a[n](...e);return i&&await s.done,o};return M.set(e,s),s}v=(t=>({...t,get:(e,n,r)=>S(e,n)||t.get(e,n,r),has:(e,n)=>!!S(e,n)||t.has(e,n)}))(v);var P=n(7),I=n(5),T=n(4);class C{constructor(t,e,n,r,i,s){this._internals=t,this.cryptoAlg=e,this.idb=n,this.mainObjectStore=r,this.keyObjectStore=i,this.keyObjectKey=s,this.MAX_CONSECUTIVE_PUTS=30,this.puts=1,this.cryptoKey=this.getOrGenerateKey()}static initialise(t,e,n,r,i,s,o){const c=["development"===t.config.environment?window.isSecureContext:"https:"===window.location.protocol,!(Object(I.g)(navigator.userAgent)&&["f036e56c-2514-4246-bf83-1659326fe3f8"].indexOf("6c3e19e3-d05e-45d1-8f79-fcd6cb2f3a21")>-1)].every(t=>!0===t),l=(t,e,n)=>e.includes(n)?Object(T.c)():t.createObjectStore(n),d=c?Object(a.t)(()=>k(n,o,{upgrade:t=>{const e=[...t.objectStoreNames];l(t,e,r),l(t,e,i)}}),t=>String(t)):Object(a.o)("Connection not attempted. Default to localStorage");return Object(a.f)(t=>Object(u.e)(t),n=>Object(u.h)(()=>n.then(n=>new C(t,e,n,r,i,s)),t=>String(t)))(d)}put(t,e){return this.cryptoKey.then(n=>Object(c.a)(JSON.stringify(t),t=>new Promise((r,i)=>{this.cryptoAlg.encrypt(n,t).then(t=>Object(c.a)(this._internals.getNamespacedStorageKey(String(e)),n=>this.resetIfRequired(this.puts++).then(i=>this.idb.put(this.mainObjectStore,t,n).then(t=>r(e)))),t=>i(t))})))}get(t){return this.cryptoKey.then(e=>Object(c.a)(this._internals.getNamespacedStorageKey(String(t)),t=>this.idb.get(this.mainObjectStore,t).then(t=>t?this.cryptoAlg.decrypt(e,t):null).then(JSON.parse)))}delete(t){return Object(c.a)(this._internals.getNamespacedStorageKey(String(t)),t=>this.idb.delete(this.mainObjectStore,t))}migrateIfRequired(){const t=Object(c.a)(this._internals.getExternalData(x),t=>t?Object(u.g)(JSON.parse(t)):Object(u.e)(null)),e=Object(u.h)(()=>this.idb.get("events","permutive-events-cache"),t=>{});return Promise.all([t(),e()]).then(t=>t.filter(a.n).map(t=>t.right).filter(t=>t)).then(P.h).then(t=>Object(c.a)(t,t=>t.forEach(t=>this._internals.state.eventsCache.add(Object(s.a)(t),{persistOnDisk:!1})),t=>this._internals.removeExternalData(x))).then(t=>-1!==[...this.idb.objectStoreNames].indexOf("events")?this.idb.delete("events","permutive-events-cache"):Promise.resolve())}deleteStore(){return Promise.resolve(this.idb.close()).then(t=>function(t,{blocked:e}={}){const n=indexedDB.deleteDatabase(t);return e&&n.addEventListener("blocked",()=>e()),O(n).then(()=>{})}(this.idb.name))}getOrGenerateKey(){return Object(c.a)(this._internals.getNamespacedStorageKey(this.keyObjectKey),t=>this.idb.get(this.keyObjectStore,t).then(t=>t||this.storeGivenOrGeneratedKey()))}storeGivenOrGeneratedKey(t){return(t||this.cryptoAlg.generateKey(!1)).then(t=>Object(c.a)(this._internals.getNamespacedStorageKey(this.keyObjectKey),e=>this.idb.put(this.keyObjectStore,t,e),e=>t),t=>Promise.reject(t))}resetIfRequired(t){const e=this.idb.name,n=this.idb.version;return Object(I.g)(navigator.userAgent)&&t%this.MAX_CONSECUTIVE_PUTS==0?this.deleteStore().then(t=>k(e,n,{upgrade:t=>{t.createObjectStore(this.mainObjectStore),t.createObjectStore(this.keyObjectStore)}})).then(t=>{this.idb=t,this.storeGivenOrGeneratedKey(this.cryptoKey)}):Promise.resolve()}}class D{constructor(t,e,n,r,i,s){this._internals=t,this.cryptoAlg=e,this.dbName=n,this.mainObjectStore=r,this.keyObjectStore=i,this.keyObjectKey=s,this.version=3,this.db=C.initialise(this._internals,this.cryptoAlg,this.dbName,this.mainObjectStore,this.keyObjectStore,this.keyObjectKey,this.version)().then(Object(a.j)(t=>new l(this._internals)))}put(t,e){return Object(u.h)(()=>this.db.then(n=>n.put(t,e)),t=>String(t))}get(t){return Object(u.h)(()=>this.db.then(e=>e.get(t)).then(o.d),t=>String(t))}delete(t){return Object(u.h)(()=>this.db.then(e=>e.delete(t)),t=>String(t))}deleteStore(){return Object(u.h)(()=>this.db.then(t=>t.deleteStore()),t=>String(t))}migrateIfRequired(){return Object(u.h)(()=>this.db.then(t=>t.migrateIfRequired()),t=>String(t))}}class A{constructor(){this.crypto=window.crypto||window.msCrypto,this.ALG_NAME="AES-GCM"}generateKey(t=!1){return this.crypto.subtle.generateKey({name:this.ALG_NAME,length:256},t,["encrypt","decrypt"])}encrypt(t,e){const[n,r]=this._encrypt(t,this.str2bytes(e));return n.then(t=>{const e=new Uint8Array(16+t.byteLength);return e.set(r,0),e.set(new Uint8Array(Uint32Array.of(t.byteLength).buffer),12),e.set(new Uint8Array(t),16),e.buffer})}decrypt(t,e){const n=new Uint8Array(e,0,12),r=new Uint32Array(e,12,1)[0],i=e.slice(16,16+r);return this._decrypt(t,n,i).then(this.bytes2str)}_encrypt(t,e){const n=this.crypto.getRandomValues(new Uint8Array(12));return[this.crypto.subtle.encrypt({name:this.ALG_NAME,iv:n},t,e),n]}_decrypt(t,e,n){return this.crypto.subtle.decrypt({name:this.ALG_NAME,iv:e},t,n)}str2bytes(t){return(new TextEncoder).encode(t).buffer}bytes2str(t){return(new TextDecoder).decode(t)}}const x="permutive-events-cache";class q{constructor(t,e){this.state=t,this._internals=e,this.EVENTS_CACHE_OBJECT_STORE="events",this.CRYPTO_KEY_OBJECT_STORE="keys",this.CRYPTO_KEY_OBJECT_KEY="events",this.eventPutQueue=Promise.resolve(),this.eventsCache=[],this.eventCacheSizeInBytes=0,this.eventStore=new D(this._internals,new A,"6c3e19e3-d05e-45d1-8f79-fcd6cb2f3a21",`${this.EVENTS_CACHE_OBJECT_STORE}_${this.state.userId}`,`${this.CRYPTO_KEY_OBJECT_STORE}_${this.state.userId}`,this.CRYPTO_KEY_OBJECT_KEY)}all(){return this.eventsCache}add(t,e){const{persistOnDisk:n}=e;return Object(c.a)(this.eventsCache.push(t),t=>n?this.flush():Object(T.c)(),e=>t)}loadFromDisk(){const t=[];return this.eventStore.migrateIfRequired()().then(Object(a.f)(e=>(this._internals.network.error("Failed to migrate events cache. Got "+JSON.stringify(e)),this.reset().then(e=>t)),()=>{const e=this._internals.metrics.startTimer("sdk_load_events_cache_task_duration_seconds",{});return this.eventStore.get(x)().then(n=>{this._internals.metrics.stopTimer("sdk_load_events_cache_task_duration_seconds",e);const r=Object(o.b)(()=>Promise.resolve(t),t=>Object(c.a)(this.eventCacheSizeInBytes=2*JSON.stringify(t).length,e=>{this._internals.metrics.track({name:"sdk_events_cache_byte_total",value:this.eventCacheSizeInBytes,labels:{}}),this._internals.metrics.track({name:"sdk_events_cache_size_total",value:t.length,labels:{}})},e=>t.map(t=>this.deserializeAndAdd(t,{persistOnDisk:!1})),t=>Promise.resolve(t)));return Object(a.f)(e=>(this._internals.network.error("Error fetching data from store. Got "+e),this.reset().then(e=>t)),r)(n)})}))}processUnseenEvents(t){this._internals.log("Got out-of-SDK events from the API",t);const e=Object(c.a)(t,t=>t.map(t=>this.deserializeAndAdd(t,{persistOnDisk:!1}))),n=e.length>0?this.flush.bind(this):T.c;return Object(c.a)(n(),t=>e)}reset(){return this._internals.log("Resetting Events Cache"),this.eventsCache=[],this.eventCacheSizeInBytes=0,this.eventStore.deleteStore()().then(()=>(this.eventStore=new D(this._internals,new A,"6c3e19e3-d05e-45d1-8f79-fcd6cb2f3a21",`${this.EVENTS_CACHE_OBJECT_STORE}_${this.state.userId}`,`${this.CRYPTO_KEY_OBJECT_STORE}_${this.state.userId}`,this.CRYPTO_KEY_OBJECT_KEY),this.flush()))}flush(){let t=JSON.stringify(this.eventsCache),e=1;for(;t.length>this._internals.config.eventsCacheLimitBytes/2;)this.eventsCache.splice(0,e),e*=2,t=JSON.stringify(this.eventsCache);this._internals.log("Writing cache (#e)",this.eventsCache.length),this.eventCacheSizeInBytes=2*t.length,this.eventPutQueue=this.eventPutQueue.then(t=>this.eventStore.put(this.eventsCache.map(s.e),x)().then(T.c))}deserializeAndAdd(t,e){const{persistOnDisk:n}=e;return Object(c.a)(t,s.a,t=>this.add(t,{persistOnDisk:n}))}getStateSizeInBytes(){return this.eventCacheSizeInBytes}}class R{constructor(t){this._internals=t,this.queue=[],this.nextNotify=null,t.messages.on("permutive:taskQueue:update",()=>{this.execute()})}add(t){this.queue.push(t),this.notify()}notify(){const t=()=>{this._internals.messages.emit("permutive:taskQueue:update")},e=(new Date).getTime();null===this.nextNotify||this.nextNotify<e-50?(this.nextNotify=e,t()):this.nextNotify<=e&&(this.nextNotify=e+50,window.setTimeout(t,50))}execute(){if(0===this.queue.length)return;let t=!1,e=!1,n=0;for(let r=0;r<this.queue.length;r++){const i=this.queue[r];if(i.complete)n+=1;else if(i.started)e=!0,t=t||i.blocks();else{if(i.waits()&&e)break;t||(e=!0,t=t||i.blocks(),i.execute(()=>{this.notify()}))}}this.queue.splice(0,n)}size(){return this.queue.length}}class L{constructor(t,e,n){this._internals=t,this.permutive=e,this.context=n,this.taskQueue=new R(this._internals);const r=this._internals.getNamespacedStorageKey(t.config.permutiveDataKey),s=localStorage.getItem(r);this.permutiveDataByteSize=null===s?0:2*s.length,this.permutiveData=null===s?{}:JSON.parse(s);const a=Object(o.h)(()=>Object(o.h)(I.o)(this.getUserIdFromLocalStorage()))(this.getUserIdFromCookie());this.setUserId(a),this.viewId=Object(I.o)(),this.context.view_id=this.viewId,this.eventSourceId=this.getPermutiveData("event-source-id")||this.generateAndStoreEventSourceId(),this.eventsCache=new q(this,this._internals),this.activationManager=new i(this._internals,this.permutive,this.context)}setUserId(t){this._internals.setCookie(this._internals.config.cookieName,t,!0),this._internals.setExternalData(this._internals.config.cookieName,t),this.userId=t}getPermutiveData(t){return this.permutiveData[t]}setPermutiveData(t,e){this.permutiveData[t]=e;const n=this._internals.getNamespacedStorageKey(this._internals.config.permutiveDataKey),r=JSON.stringify(this.permutiveData);this.permutiveDataByteSize=2*r.length,this._internals.makeSafe(()=>{localStorage.setItem(n,r)})()}getClient(){let t="";return t=document.title?document.title:"",{type:"web",user_agent:navigator.userAgent||"",url:window.location.href||"",domain:window.location.hostname||"",title:t,referrer:document.referrer||""}}getStateSizeInBytes(){return this.permutiveDataByteSize+this.eventsCache.getStateSizeInBytes()}reset(){return this._internals.log("Resetting State"),Promise.resolve(Object(c.a)(this._internals.deleteCookie(this._internals.config.cookieName),t=>this._internals.removeExternalData(this._internals.config.cookieName),t=>this._internals.queryManager.reset(),t=>this.permutiveData={},t=>this.permutiveDataByteSize=0,t=>localStorage.removeItem(this._internals.config.permutiveDataKey)))}generateAndStoreEventSourceId(){const t=Object(I.o)();return this.setPermutiveData("event-source-id",t),t}getUserIdFromStorageIfValid(t){const e=Object(o.e)(I.h);return Object(c.a)("cookie"===t?this._internals.getCookie(this._internals.config.cookieName):this._internals.getExternalData(this._internals.config.cookieName),o.d,Object(o.a)(e))}getUserIdFromCookie(){return this.getUserIdFromStorageIfValid("cookie")}getUserIdFromLocalStorage(){return this.getUserIdFromStorageIfValid("localStorage")}}},function(t,e,n){"use strict";n.d(e,"a",(function(){return h}));var r=n(5);class i{constructor(t,e){this._internals=t,this.hasChanged=!1,(e=e||{}).timeout_seconds=e.timeout_seconds||1800,e.session_data_key=e.session_data_key||"permutive-session",this.options=e,this.session_id=null,this.initialize()}getSessionId(){return this.session_id}sessionHasChanged(){return this.hasChanged}newSession(t){return this.hasChanged=!0,{session_id:Object(r.o)(),last_updated:t}}initialize(){const t=new Date,e=this._internals.getCookie(this.options.session_data_key);let n=this.decodeSessionData(e);if(null===n)n=this.newSession(t);else{const e=this.options.timeout_seconds;t>new Date(n.last_updated.getTime()+1e3*e)?n=this.newSession(t):n.last_updated=t}this.persistSessionData(n),this.session_id=n.session_id}decodeSessionData(t){let e=null;try{e=JSON.parse(t)}catch(t){return null}return null!==e&&"object"==typeof e&&e.hasOwnProperty("session_id")&&e.hasOwnProperty("last_updated")&&(e.last_updated=new Date(e.last_updated),!isNaN(e.last_updated.getTime()))?e:null}persistSessionData(t){t.last_updated=t.last_updated.toISOString(),this._internals.setCookie(this.options.session_data_key,JSON.stringify(t))}}const s={success:t=>{},error:(t,e)=>{}};class a{constructor(t){this._internals=t}graphql(t,e=s){return this._internals.network.req({url:`${this._internals.config.apiProtocol}://${this._internals.config.apiHost}/graphql`,method:"POST",success:e.success,error:e.error,data:{query:t},contentType:"text/plain",xhrFields:{withCredentials:!0}},!1)}identify(t,e=s){const n=this._internals.identities.aliasMapToPrioritizedList(this._internals.identities.aliases);return this._internals.network.req({url:this._internals.network.getEndpointUrl("/identify"),method:"POST",data:{user_id:this._internals.state.userId,aliases:n.concat(t.map(t=>Object.assign(Object.assign({},t),{priority:0})))},success:e.success,error:e.error,contentType:"text/plain",xhrFields:{withCredentials:!0}},!1)}metrics(t,e=s){return this._internals.network.req({url:this._internals.network.getEndpointUrl("/internal/metrics"),method:"POST",data:t,contentType:"text/plain",dataType:"text",success:e.success,error:e.error},!1)}track(t,e,n){return this._internals.network.req({url:[""+this._internals.network.getEndpointUrl((Array.isArray(t)?"/batch":"")+"/events"),"?enrich="+!!e.includeResponseBody,"&sdkp="+!n].join(""),method:"POST",data:t,success:e.success,error:e.error,contentType:"text/plain"},n)}tpdUsage(t,e=s){return this._internals.network.req({url:this._internals.network.getEndpointUrl("/tpd/usage"),method:"POST",data:t,success:e.success,error:e.error,contentType:"text/plain"},!1)}reset(){return this._internals.network.req({url:this._internals.network.getEndpointUrl("/reset"),method:"POST",xhrFields:{withCredentials:!0},contentType:"text/plain"},!1)}segmentSync(t,e){return this._internals.network.ajax({url:`https://${this._internals.config.segmentSyncApiHost}/sync/${t}`,type:"POST",data:"value="+encodeURIComponent(e),contentType:"application/x-www-form-urlencoded",xhrFields:{withCredentials:!0}})}models(t){const e="binary"===t?"bin":"json";return this._internals.network.ajax({url:`https://${this._internals.config.cdnBaseUrl}/models/6c3e19e3-d05e-45d1-8f79-fcd6cb2f3a21-models.${e}`,dataType:t})}state(t,e,n,r,i=!1){return this._internals.network.req({url:`${this._internals.network.getEndpointUrl(""+(i?"/state/legacy":"/state"),"v1.0")}?fetch_unseen=${r}`,method:"POST",data:{group_id:this._internals.state.userId,event_source_id:this._internals.state.eventSourceId,state:JSON.stringify(t),last_seen_offset:e},contentType:"text/plain"},n)}migrateOutOfSDKEvents(t,e,n=s){return this._internals.network.req({url:`${this._internals.network.getEndpointUrl("/out-of-sdk-events/delete")}?user_id=${t}`,method:"POST",data:e,success:n.success,error:n.error,contentType:"text/plain"},!1)}inferDemographicSegments(t,e=s){return this._internals.network.req({url:""+this._internals.network.getEndpointUrl("/demographic/infer"),method:"POST",contentType:"text/plain",data:t,success:e.success,error:e.error},!1)}}class o{constructor(){this.promises={}}addPromise(t,e,n,r){t in this.promises||(this.promises[t]={}),this.promises[t][e]=r,window.setTimeout(()=>{this.resolvePromise(t,e)},n)}createPromise(t,e,n){this.addPromise(t,e,n,Object(r.b)())}getPromise(t,e){return Object(r.i)(this.promises,t,e)}resolvePromise(t,e){const n=this.getPromise(t,e);return void 0!==n?(n.resolve(),n):void 0}getPromisesByCategory(t){const e=Object(r.i)(this.promises,t)||{};return Object.keys(e).map(t=>e[t])}}var u=n(19);class c{constructor(t){this._internals=t,this.queries={},this.promises={}}register(t){const e=Object(r.b)();return this.queries[t.resource]=t.query(),this.promises[t.resource]=e,e.promise}run(){if(0===Object.keys(this.queries).length)return Promise.resolve();const t=Object(r.b)();return this._internals.api.graphql(this.toQueryString(this.queries),{success:e=>{Object.keys(this.promises).forEach(t=>{const n=e.data[t];n?this.promises[t].resolve(n):this.promises[t].reject("Could not find a graphql response for resource "+t)}),t.resolve()},error:e=>{console.error(e),Object.keys(this.promises).forEach(t=>this.promises[t].reject()),t.reject()}}),t.promise}toQueryString(t){return`{ ${Object.keys(t).map(e=>t[e]).join(" ")} }`}}class l{constructor(){this.events=[],this.listeners=[]}newEvent(t,e){this.events.push([t,e]),this.listeners.forEach(n=>{this.handle(t,e,n)})}addListener(t){this.listeners.push(t);const e={replay:()=>(this.replay(t),e),remove:()=>(this.remove(t),e)};return e}handle(t,e,n){const r="string"==typeof n.name&&t.name===n.name,i=n.name.test&&n.name.test(t.name),s=r||i;if(s)try{n.callback(t,e)}catch(t){window.console&&window.console.error&&window.console.error("callback error: ",t)}s&&n.once&&this.remove(n)}replay(t){let e=-1!==this.listeners.indexOf(t);for(let n=0;n<this.events.length&&e;n++)this.handle(this.events[n][0],this.events[n][1],t),e=-1!==this.listeners.indexOf(t)}remove(t){const e=this.listeners.indexOf(t);-1!==e&&this.listeners.splice(e,1)}}function d(t){var e={},n=[];(t=t||this).on=function(n,r,i){return(e[n]=e[n]||[]).push([r,i]),t},t.off=function(r,i){r||(e={});for(var s=e[r]||n,a=s.length=i?s.length:0;a--;)i==s[a][0]&&s.splice(a,1);return t},t.once=function(e,r){var i=n.slice.call(arguments,2),s=function(){r(i),t.off(e,s)};return t.on(e,s),t},t.emit=function(r){for(var i,s=e[r]||n,a=s.length>0?s.slice(0,s.length):s,o=0;i=a[o++];)i[0].apply(i[1],n.slice.call(arguments,1));return t}}var f=n(12);class _{constructor(t){this._internals=t,this.timeoutDuration=500,this.maxWaitTime=5e3,this.requests=[],setInterval(()=>{this.requests.length>0&&this.flush()},this.maxWaitTime),Object(r.n)(()=>{this.requests.length>0&&this.flush(!0)},navigator.userAgent)}add(t,e,n){this.resetTimeout(),this.requests.push([t,e,n])}flush(t=!1){const e=[...this.requests];t||this.trackMetrics(e),this._internals.stateSync.sync(t),this._internals.api.track(e.map(t=>t[0]),{},t).then(t=>this.isBatchResponse(t)?this.handleBatchResponse(t,e):null,t=>this._internals.network.error(t)).catch(t=>this._internals.network.error(t)),this.requests=[]}handleBatchResponse(t,e){t.map(t=>t.body).forEach((t,n)=>{const r=e.map(t=>t[0])[n],i=e[n][1],s=e[n][2];Object(f.c)(t)?this.handleTrackError(t,r,i.error):this.handleTrackResponse(t,r,i.success,s)})}handleTrackResponse(t,e,n,r){const i=Object(f.b)(t,e);n(i),"never"!==r&&(this._internals.state.eventsCache.add(i,{persistOnDisk:!0}),this._internals.eventHandler.newEvent(Object(f.e)(i),null))}handleTrackError(t,e,n){const r={name:e.name,session_id:e.session_id,view_id:e.view_id,properties:e.properties,id:null,time:(new Date).toISOString()};n(t.error.message),this._internals.eventHandler.newEvent(r,t),console.error(t)}setTimeout(t){return window.setTimeout(()=>this.flush(),t)}resetTimeout(){clearTimeout(this.timeout),this.timeout=this.setTimeout(this.timeoutDuration)}trackMetrics(t){this._internals.metrics.track({name:"sdk_events_batch_size_total",value:t.length,labels:{}}),this._internals.metrics.track({name:"sdk_events_batch_size_bytes",value:2*JSON.stringify(t.map(t=>t[0])).length,labels:{}})}isBatchResponse(t){return!!t}}class h{constructor(t,e,n=[],r={},s=new l,f=new o,h=new d,p=new u.a){this.config=t,this.network=e,this.blockers=n,this.addons=r,this.eventHandler=s,this.promises=f,this.messages=h,this.enrichers=p,this.isReady=!1,this.isRealtime=!1,this.listenForBlockers=!0,this.sessionManager=new i(this),this.eventsBatch=new _(this),this.api=new a(this),this.graphql=new c(this),this.models={getModels:()=>Promise.resolve({})}}makeSafe(t){return(...e)=>{try{return t(...e)}catch(t){this.network.error(t,this.state.userId)}}}utcNow(){const t=new Date;return new Date(t.toUTCString())}log(...t){this.config.loggingEnabled&&window.console&&window.console.log&&(t.splice(0,0,"[Permutive]"),console.log(...t))}setAsReady(){this.isReady=!0,this.metrics.trackTimeSinceInit("sdk_initialisation_task_duration_seconds",{sdk_version:"v13.0.0-RC.33"}),window.performance&&window.performance.memory&&(this.metrics.track({name:"sdk_heap_memory_bytes_used",value:window.performance.memory.usedJSHeapSize,labels:{}}),this.metrics.track({name:"sdk_heap_memory_limit_fraction_used",value:window.performance.memory.usedJSHeapSize/window.performance.memory.jsHeapSizeLimit,labels:{}})),this.messages.emit("permutive:ready")}setAsRealtime(){this.isRealtime=!0,this.metrics.trackTimeSinceInit("sdk_realtime_targeting_set_task_duration_seconds",{})}addBlocker(t){this.blockers.push(t),this.log("<blockers> added blocker "+t),this.messages.on(t,()=>{if(this.listenForBlockers){const e=this.blockers.indexOf(t);e>=0&&(this.blockers.splice(e,1),this.log("<blockers> removed blocker "+t)),0===this.blockers.length&&(this.listenForBlockers=!1,this.messages.emit("permutive:blockers:empty"),this.log("<blockers> complete"))}})}getNamespacedStorageKey(t){return`${this.config.stateNamespace}${t}`}setCookie(t,e,n=!1){if(!(e&&t&&this.config.cookieExpiry&&this.config.cookieDomain))return!1;const r=this.getNamespacedStorageKey(t);document.cookie=[encodeURIComponent(r),"=",encodeURIComponent(e),"; expires=",this.config.cookieExpiry,"; domain=",this.config.cookieDomain,"; path=/",n?"; samesite=none; secure":""].join("")}getCookie(t,e=!1){const n=e?t:this.getNamespacedStorageKey(t),r=new RegExp(encodeURIComponent(n)+"=([^;]+)").exec(document.cookie);return null!==r?decodeURIComponent(r[1]):null}deleteCookie(t){if(!t||!this.config.cookieDomain)return!1;const e=this.getNamespacedStorageKey(t);return document.cookie=encodeURIComponent(e)+"=; expires=Thu, 01 Jan 1970 00:00:00 UTC; domain="+this.config.cookieDomain+"; path=/",!0}getExternalData(t){const e=this.getNamespacedStorageKey(t);return localStorage.getItem(e)}setExternalData(t,e){const n=this.getNamespacedStorageKey(t);this.makeSafe(()=>{localStorage.setItem(n,e)})()}removeExternalData(t){const e=this.getNamespacedStorageKey(t);localStorage.removeItem(e)}arraysEqual(t,e){if(t===e)return!0;if(null==t||null==e)return!1;if(t.length!==e.length)return!1;for(let n=0;n<t.length;++n)if(t[n]!==e[n])return!1;return!0}}},function(t,e,n){"use strict";n.d(e,"a",(function(){return f}));var r=n(5),i=n(15);class s{constructor(t,e={}){this.wait_prev=e.wait_prev||!1,this.block_next=e.block_next||!1,this.description=e.description||"",this.started=!1,this.complete=!1,this.task=t}waits(){return this.wait_prev}blocks(){return this.block_next}execute(t){this.started=!0,this.task(()=>{this.complete=!0,t()})}}var a=n(12),o=n(6),u=n(0);const c=(t,e)=>new Promise(n=>{t(e,2,t=>{n(t)})}),l={tradedesk:21,ddp:755,appnexus:32,pubmatic:76,lotame:95};var d=n(4);class f{constructor(t,e,n){this._internals=t,this.network=e,this.context=n,this.initialisedAddons=[]}identify(t){this._internals.log("<call> identify",t);const e=this._internals.identities.getAliasesFromIdentifyArg(t),n=Object(r.b)(),a=e.map(t=>t.id).concat(Object.entries(this._internals.identities.aliases).map(t=>t[1]));if("string"==typeof t&&Object(i.b)("6c3e19e3-d05e-45d1-8f79-fcd6cb2f3a21",a,window.location.hostname,this._internals.state.userId))return n.resolve(),n.promise;return this._internals.state.taskQueue.add(new s(t=>{this._internals.log("<task> identify ",e);const r=this._internals.state.userId;this._internals.api.identify(e).then(i=>i.user_id===r?Object(o.a)(this._internals.log("<done> identify ",e),e=>t(),t=>n.resolve()):this._internals.state.reset().then(t=>Object(o.a)(this._internals.state.setUserId(i.user_id),t=>this._internals.state.eventsCache.reset(),t=>this._internals.stateSync.resetSync())).then(r=>{this._internals.log("<done> identify",e),t(),n.resolve()})).then(t=>e.forEach(t=>this._internals.identities.setAlias(t.id,t.tag)))},{wait_prev:!0,block_next:!0})),n.promise}on(t,e){return this._internals.eventHandler.addListener({name:t,callback:e,once:!1})}once(t,e){return this._internals.eventHandler.addListener({name:t,callback:e,once:!0})}track(...t){const[e,n,i]=[t[0],t[1]||{},t[2]||{}];this._internals.log("<call> track",e);const o=Object(r.b)();if(!this._internals.api)return this.network.error("The API hasn't been loaded."),o.reject(),o.promise;const u=!!i.isAnalyticsOnly,c=this._internals.sessionManager.getSessionId(),l=this._internals.state.viewId,d={success:i.success||(t=>{}),error:i.error||((t,e)=>{})};return this._internals.state.taskQueue.add(new s(t=>{this._internals.log("<task> track",e);const s=u?null:this._internals.metrics.startTimer("sdk_events_api_roundtrip_seconds",{}),f=u?null:this._internals.metrics.startTimer("sdk_events_overall_processing_seconds",{}),[_,h]=this._internals.enrichers.enrich([n,!0]);this._internals.metrics.track({name:h?"sdk_event_enrichment_success_count":"sdk_event_enrichment_fail_count",value:1,labels:{}});const p=Object.assign(Object.assign({},_),{client:this._internals.state.getClient()}),m=function(t,e){return t.isMemoryOnly?"memoryOnly":t.useBeacon?"deferred":t.isAnalyticsOnly?"never":e?"immediate":"onResponse"}(i,h),g={user_id:this._internals.state.userId,name:e,segments:this._internals.queryManager.userSegments,properties:p,session_id:c,view_id:l},v={name:e,properties:p,session_id:c,view_id:l,time:new Date},b=t=>{const e=this._internals.metrics.startTimer("sdk_events_querylanguage_seconds",{});return this._internals.queryManager.process([t]).then(()=>{this._internals.metrics.stopTimer("sdk_events_querylanguage_seconds",e),this._internals.metrics.stopTimer("sdk_events_overall_processing_seconds",f)})},y=t=>(this._internals.metrics.stopTimer("sdk_events_api_roundtrip_seconds",s),Object(a.c)(t)?O(t):w(t)),O=t=>{this._internals.log("Tracking failed with reason",t);const e={name:g.name,session_id:g.session_id,view_id:g.view_id,properties:g.properties,id:null,time:new Date};return Promise.resolve({event:e,error:t})},w=t=>{const e=Object(a.d)(t)?Object(a.a)(Object.assign(Object.assign({},t),{session_id:g.session_id,view_id:g.view_id})):Object(a.b)(t,g);return Promise.resolve({event:e,error:null})},k=t=>Promise.resolve(t.error?d.error(t.error.error.message):d.success(t.event)),j=t=>(t.error||this._internals.state.eventsCache.add(t.event,{persistOnDisk:!0}),Promise.resolve(t)),E=t=>(this._internals.eventHandler.newEvent(Object(a.e)(t.event),t.error),Promise.resolve(t.event));let M;switch(m){case"immediate":M=Object(r.e)(([t,e])=>Promise.all([b(t),this._internals.eventsBatch.add(e,d,m),Promise.resolve(t)]),([t,e,n])=>Promise.resolve(n));break;case"memoryOnly":M=([t,e])=>b(t).then(e=>t);break;case"onResponse":M=Object(r.e)(([t,e])=>this._internals.api.track(e,{includeResponseBody:!0},!1),t=>y(t),t=>Promise.all([k(t),j(t),b(t.event),E(t)]),([t,e,n,r])=>Promise.resolve(r));break;case"deferred":M=Object(r.e)(([t,e])=>Promise.all([this._internals.api.track(e,{includeResponseBody:!h},!0),Promise.resolve(t)]),([t,e])=>E({event:e,error:null}));break;case"never":M=([t,e])=>(this._internals.eventsBatch.add(e,d,m),Promise.resolve(t))}M([v,g]).then(e=>(o.resolve(e),this._internals.log("<done> track",e.name),t(),Promise.resolve(e))).catch(t=>{this._internals.metrics.stopTimer("sdk_events_api_roundtrip_seconds",s),d.error(t),this.network.error(t,this._internals.state.userId)})})),o.promise}trigger(t,e,n){const i=Object(r.b)();this._internals.log("<call> trigger",t),this._internals.triggerListeners=this._internals.triggerListeners||[];return this._internals.state.taskQueue.add(new s(e=>{this._internals.log("<task> trigger",t);const r=this._internals.messages.on("permutive:query:changed",(function(e){e.queryCode===t&&(n(e.result),i.resolve(e.result))}));this._internals.triggerListeners.push(r),this._internals.log("<done> trigger",t),e()})),i.promise}query(){return Promise.resolve({result:!1})}segment(t,e){const n=Object(r.b)();this._internals.log("<call> segment",t);return this._internals.state.taskQueue.add(new s(r=>{this._internals.log("<task> segment",t);const i=this._internals.queryManager.stateMap.value[t];i&&(e(i.result.result),n.resolve()),this._internals.log("<done> segment",t),r()})),n.promise}segments(t,e="all"){const n=Object(r.b)();this._internals.log("<call> segments");return this._internals.state.taskQueue.add(new s(r=>{this._internals.log("<task> segments ("+e+")");const i=i=>{t(i),n.resolve(i),this._internals.log("<done> segments ("+e+")"),r()};"dfp"===e?this._internals.messages.once("permutive:dfp:ready",()=>{i(this._internals.addons.dfp.liveSegments)}):i(this._internals.queryManager.userSegments)})),n.promise}reset(){return Promise.all([this._internals.api.reset(),this._internals.state.reset(),this._internals.stateSync.reset(),this._internals.queryManager.bootstrap([])]).then(([t])=>{this._internals.state.setUserId(t.id),this._internals.state.eventsCache.reset(),this._internals.messages.emit("permutive:reset")})}addon(t,e){if(-1===this.initialisedAddons.indexOf(t)){this.initialisedAddons.push(t);const r=Object.assign(Object.assign({},e),{_internals:this._internals,permutive:this,network:this.network,context:this.context});switch(t){case"web":Promise.resolve().then(n.bind(null,37)).then(t=>this._internals.addons.web=new t.WebAddon(r));break;case"publishers":0;break;case"overlays":Promise.resolve().then(n.bind(null,35)).then(t=>this._internals.addons.overlays=new t.OverlaysAddon(r));break;case"scriptrunner":Promise.resolve().then(n.bind(null,36)).then(t=>this._internals.addons.scriptrunner=new t.ScriptRunnerAddon(r));break;case"dfp":Promise.resolve().then(n.bind(null,34)).then(t=>this._internals.addons.dfp=new t.DFPAddon(r));break;case"smart":case"nativo":case"freewheel":case"facebook_pixel":case"facebook_pixel_v2":case"eyeota_pixel":case"rubicon":case"rubicon_ssp":case"aol":case"tracking_pixel":case"twitter_pixel":case"pinterest_pixel":case"local_storage":case"appnexus_adserver":case"prebid":case"clean_room":case"tradedesk":0;break;case"ddp":case"dbm":case"appnexus":case"pubmatic":case"lotame":0}}else"web"===t&&!0!==e.auto_init&&this._internals.addons.web.reset(e)}addonIfTCFConsent(t,e){const n=()=>{switch(t.key){case"tradedesk":this._internals.addons.tradedesk=new t.Addon(e);break;case"ddp":this._internals.addons.ddp=new t.Addon(e);break;case"appnexus":this._internals.addons.appnexus=new t.Addon(e);break;case"pubmatic":this._internals.addons.pubmatic=new t.Addon(e);break;case"lotame":this._internals.addons.lotame=new t.Addon(e)}},i=e=>e[l[t.key]]?n():Object(d.c)();return(t=>{const e=t.__tcfapi,n={type:"aborted"},i=["tcloaded","useractioncomplete"];return e?Object(r.a)(()=>c(e,"getTCData"),()=>c(e,"getTCData").then(t=>"loaded"===(null==t?void 0:t.cmpStatus)&&i.includes(null==t?void 0:t.eventStatus))).then(Object(u.b)(()=>n,t=>({type:"loaded",data:t}))):Promise.resolve({type:"missing"})})(window).then(t=>{switch(t.type){case"missing":return n();case"aborted":return Object(d.c)();case"loaded":return Object(o.a)((e=t.data).gdprApplies?Object(u.o)(e.vendor.consents):u.n,Object(u.b)(n,i))}var e})}ready(t,e="initialised"){const n=Object(r.b)(),i=()=>{t(),n.resolve()};switch(e){case"initialised":this._internals.isReady?i():this._internals.messages.on("permutive:ready",i);break;case"realtime":this._internals.isRealtime?i():this._internals.messages.once("permutive:ready",i)}return n.promise}}},function(t,e,n){"use strict";n.d(e,"a",(function(){return b}));var r=n(5),i=n(23),s=n.n(i),a=function(){return s()('/*! permutive-javascript-sdk v13.0.0-RC.33 (web) (built 2020-11-03 19:27:02 GMT+0000) */!function(n){var t={};function e(r){if(t[r])return t[r].exports;var u=t[r]={i:r,l:!1,exports:{}};return n[r].call(u.exports,u,u.exports,e),u.l=!0,u.exports}e.m=n,e.c=t,e.d=function(n,t,r){e.o(n,t)||Object.defineProperty(n,t,{enumerable:!0,get:r})},e.r=function(n){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(n,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(n,"__esModule",{value:!0})},e.t=function(n,t){if(1&t&&(n=e(n)),8&t)return n;if(4&t&&"object"==typeof n&&n&&n.__esModule)return n;var r=Object.create(null);if(e.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:n}),2&t&&"string"!=typeof n)for(var u in n)e.d(r,u,function(t){return n[t]}.bind(null,u));return r},e.n=function(n){var t=n&&n.__esModule?function(){return n.default}:function(){return n};return e.d(t,"a",t),t},e.o=function(n,t){return Object.prototype.hasOwnProperty.call(n,t)},e.p="",e(e.s=1)}([function(n,t,e){"use strict";n.exports=function(n){function t(n,t,e,r){function u(t){"function"!=typeof self.postMessage?n.ports[0].postMessage(t):self.postMessage(t)}e?("undefined"!=typeof console&&"error"in console&&console.error("Worker caught an error:",e),u([t,{message:e.message}])):u([t,null,r])}self.addEventListener("message",(function(e){var r=e.data;if(Array.isArray(r)&&2===r.length){var u=r[0],i=r[1];"function"!=typeof n?t(e,u,new Error("Please pass a function into register().")):function(n,e,r,u){var i,o=function(n,t){try{return{res:n(t)}}catch(n){return{err:n}}}(e,u);o.err?t(n,r,o.err):!(i=o.res)||"object"!=typeof i&&"function"!=typeof i||"function"!=typeof i.then?t(n,r,null,o.res):o.res.then((function(e){t(n,r,null,e)}),(function(e){t(n,r,e)}))}(e,n,u,i)}}))}},function(n,t,e){"use strict";function r(n){return n}e.r(t),e.d(t,"effects",(function(){return ce})),e.d(t,"bootstrap",(function(){return se})),e.d(t,"updateEnvironment",(function(){return le})),e.d(t,"process",(function(){return fe})),e.d(t,"processOne",(function(){return de})),e.d(t,"migrateDirect",(function(){return pe})),e.d(t,"migrateViaEventsCache",(function(){return me})),e.d(t,"setSegmentActivationWithStateMap",(function(){return ge}));function u(){for(var n=[],t=0;t<arguments.length;t++)n[t]=arguments[t];return n}function i(n,t,e,r,u,i,o,a,c,s){switch(arguments.length){case 1:return n;case 2:return t(n);case 3:return e(t(n));case 4:return r(e(t(n)));case 5:return u(r(e(t(n))));case 6:return i(u(r(e(t(n)))));case 7:return o(i(u(r(e(t(n))))));case 8:return a(o(i(u(r(e(t(n)))))));case 9:return c(a(o(i(u(r(e(t(n))))))));case 10:return s(c(a(o(i(u(r(e(t(n)))))))))}}var o=function(n){return"Left"===n._tag},a=function(n){return{_tag:"Left",left:n}},c=function(n){return{_tag:"Right",right:n}};function s(n,t){try{return c(n())}catch(n){return a(t(n))}}var l=function(n){return function(t){return o(t)?n(t.left):t.right}};var f=function(n,t){return o(n)?n:c(t(n.right))},d=function(n,t){return o(n)?n:o(t)?t:c(n.right(t.right))},p=function(n,t){return o(n)?n:t(n.right)},m=function(n,t,e){return o(n)?t:e(t,n.right)},g=function(n){return function(t,e){return o(t)?n.empty:e(t.right)}},v=function(n,t,e){return o(n)?t:e(n.right,t)},h=function(n){return function(t,e){return o(t)?n.of(a(t.left)):n.map(e(t.right),c)}},y=function(n,t,e){return o(n)?a(t(n.left)):c(e(n.right))},w=function(n,t){return o(n)?a(t(n.left)):n},k=function(n,t){return o(n)?t():n},b=function(n,t){return o(n)?n:c(t(n))},_=function(n,t){return function(n,t){for(var e=t(n);"Left"===e._tag;)e=t(e.left);return e.right}(t(n),(function(n){return o(n)?c(a(n.left)):o(n.right)?a(t(n.right.left)):c(c(n.right.right))}))},j=function(n){return function(t){return f(t,n)}},O=c,A=function(n){return function(t){return o(t)?n.of(a(t.left)):n.map(t.right,c)}},z=a,x="Either";var T={URI:x,map:f,of:O,ap:d,chain:p,reduce:m,foldMap:g,reduceRight:v,traverse:h,sequence:A,bimap:y,mapLeft:w,alt:k,extend:b,chainRec:_,throwError:z};var q,M=(q=function(n,t){return(q=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,t){n.__proto__=t}||function(n,t){for(var e in t)t.hasOwnProperty(e)&&(n[e]=t[e])})(n,t)},function(n,t){function e(){this.constructor=n}q(n,t),n.prototype=null===t?Object.create(t):(e.prototype=t.prototype,new e)}),N=function(){function n(n,t,e,r){this.name=n,this.is=t,this.validate=e,this.encode=r,this.decode=this.decode.bind(this)}return n.prototype.pipe=function(t,e){var r=this;return void 0===e&&(e="pipe("+this.name+", "+t.name+")"),new n(e,t.is,(function(n,e){var u=r.validate(n,e);return o(u)?u:t.validate(u.right,e)}),this.encode===S&&t.encode===S?S:function(n){return r.encode(t.encode(n))})},n.prototype.asDecoder=function(){return this},n.prototype.asEncoder=function(){return this},n.prototype.decode=function(n){return this.validate(n,[{key:"",type:this,actual:n}])},n}(),S=function(n){return n},I=a,E=function(n,t,e){return I([{value:n,context:t,message:e}])},L=c,P=(new(function(n){function t(){var t=n.call(this,"null",(function(n){return null===n}),(function(n,e){return t.is(n)?L(n):E(n,e)}),S)||this;return t._tag="NullType",t}return M(t,n),t}(N)),new(function(n){function t(){var t=n.call(this,"undefined",(function(n){return void 0===n}),(function(n,e){return t.is(n)?L(n):E(n,e)}),S)||this;return t._tag="UndefinedType",t}return M(t,n),t}(N))),C=(new(function(n){function t(){var t=n.call(this,"void",P.is,P.validate,S)||this;return t._tag="VoidType",t}return M(t,n),t}(N)),new(function(n){function t(){var t=n.call(this,"unknown",(function(n){return!0}),L,S)||this;return t._tag="UnknownType",t}return M(t,n),t}(N)),new(function(n){function t(){var t=n.call(this,"string",(function(n){return"string"==typeof n}),(function(n,e){return t.is(n)?L(n):E(n,e)}),S)||this;return t._tag="StringType",t}return M(t,n),t}(N)),new(function(n){function t(){var t=n.call(this,"number",(function(n){return"number"==typeof n}),(function(n,e){return t.is(n)?L(n):E(n,e)}),S)||this;return t._tag="NumberType",t}return M(t,n),t}(N))),G=(new(function(n){function t(){var t=n.call(this,"bigint",(function(n){return"bigint"==typeof n}),(function(n,e){return t.is(n)?L(n):E(n,e)}),S)||this;return t._tag="BigIntType",t}return M(t,n),t}(N)),new(function(n){function t(){var t=n.call(this,"boolean",(function(n){return"boolean"==typeof n}),(function(n,e){return t.is(n)?L(n):E(n,e)}),S)||this;return t._tag="BooleanType",t}return M(t,n),t}(N)),new(function(n){function t(){var t=n.call(this,"UnknownArray",Array.isArray,(function(n,e){return t.is(n)?L(n):E(n,e)}),S)||this;return t._tag="AnyArrayType",t}return M(t,n),t}(N)),new(function(n){function t(){var t=n.call(this,"UnknownRecord",(function(n){var t=Object.prototype.toString.call(n);return"[object Object]"===t||"[object Window]"===t}),(function(n,e){return t.is(n)?L(n):E(n,e)}),S)||this;return t._tag="AnyDictionaryType",t}return M(t,n),t}(N)),new(function(n){function t(){var t=n.call(this,"Function",(function(n){return"function"==typeof n}),(function(n,e){return t.is(n)?L(n):E(n,e)}),S)||this;return t._tag="FunctionType",t}return M(t,n),t}(N)),function(n){function t(t,e,r,u,i,o){var a=n.call(this,t,e,r,u)||this;return a.type=i,a.predicate=o,a._tag="RefinementType",a}return M(t,n),t}(N)),V=(R(C,(function(n){return Number.isInteger(n)}),"Int"),function(n){function t(t,e,r,u,i){var o=n.call(this,t,e,r,u)||this;return o.value=i,o._tag="LiteralType",o}M(t,n)}(N),function(n){function t(t,e,r,u,i){var o=n.call(this,t,e,r,u)||this;return o.keys=i,o._tag="KeyofType",o}M(t,n)}(N),Object.prototype.hasOwnProperty,function(n){function t(t,e,r,u,i){var o=n.call(this,t,e,r,u)||this;return o.runDefinition=i,o._tag="RecursiveType",o}return M(t,n),t}(N));Object.defineProperty(V.prototype,"type",{get:function(){return this.runDefinition()},enumerable:!0,configurable:!0});(function(n){function t(t,e,r,u,i){var o=n.call(this,t,e,r,u)||this;return o.type=i,o._tag="ArrayType",o}M(t,n)})(N),function(n){function t(t,e,r,u,i){var o=n.call(this,t,e,r,u)||this;return o.props=i,o._tag="InterfaceType",o}M(t,n)}(N),function(n){function t(t,e,r,u,i){var o=n.call(this,t,e,r,u)||this;return o.props=i,o._tag="PartialType",o}M(t,n)}(N),function(n){function t(t,e,r,u,i,o){var a=n.call(this,t,e,r,u)||this;return a.domain=i,a.codomain=o,a._tag="DictionaryType",a}M(t,n)}(N);var D=function(n){function t(t,e,r,u,i){var o=n.call(this,t,e,r,u)||this;return o.types=i,o._tag="UnionType",o}return M(t,n),t}(N);!function(n){function t(t,e,r,u,i){var o=n.call(this,t,e,r,u)||this;return o.types=i,o._tag="IntersectionType",o}M(t,n)}(N);!function(n){function t(t,e,r,u,i){var o=n.call(this,t,e,r,u)||this;return o.types=i,o._tag="TupleType",o}M(t,n)}(N);(function(n){function t(t,e,r,u,i){var o=n.call(this,t,e,r,u)||this;return o.type=i,o._tag="ReadonlyType",o}M(t,n)})(N),function(n){function t(t,e,r,u,i){var o=n.call(this,t,e,r,u)||this;return o.type=i,o._tag="ReadonlyArrayType",o}M(t,n)}(N),function(n){function t(t,e,r,u,i,o){var a=n.call(this,t,e,r,u,i)||this;return a.tag=o,a}M(t,n)}(D),function(n){function t(t,e,r,u,i){var o=n.call(this,t,e,r,u)||this;return o.type=i,o._tag="ExactType",o}M(t,n)}(N),new(function(n){function t(){var t=n.call(this,"never",(function(n){return!1}),(function(n,t){return E(n,t)}),(function(){throw new Error("cannot encode never")}))||this;return t._tag="NeverType",t}return M(t,n),t}(N)),new(function(n){function t(){var t=n.call(this,"any",(function(n){return!0}),L,S)||this;return t._tag="AnyType",t}return M(t,n),t}(N)),new(function(n){function t(){var t=n.call(this,"object",(function(n){return null!==n&&"object"==typeof n}),(function(n,e){return t.is(n)?L(n):E(n,e)}),S)||this;return t._tag="ObjectType",t}return M(t,n),t}(N));function R(n,t,e){var r;return void 0===e&&(e="("+n.name+" | "+(((r=t).displayName||r.name||"<function"+r.length+">")+")")),new G(e,(function(e){return n.is(e)&&t(e)}),(function(e,r){var u=n.validate(e,r);if(o(u))return u;var i=u.right;return t(i)?L(i):E(i,r)}),n.encode,n,t)}R(C,Number.isInteger,"Integer"),function(n){function t(t,e,r,u,i){var o=n.call(this,t,e,r,u)||this;return o.props=i,o._tag="StrictType",o}M(t,n)}(N);const F=()=>({kind:"null",value:null}),U=n=>({kind:"string",value:n}),$=n=>({kind:"number",value:n}),J=n=>({kind:"array",value:n}),Y=n=>({kind:"object",value:n}),W=n=>n,B=()=>({kind:"bottom"}),H=n=>({kind:"inner",a:n}),K=n=>({kind:"top",error:n}),Q=n=>({kind:"unbounded",group:n}),X=(n,t)=>({kind:"windowed",key:t,group:n}),Z=(n,t,e)=>({kind:"countLimit",n:e,limit:t,group:n}),nn=(n,t,e)=>({kind:"uniqueLimit",n:e,limit:t,group:n}),tn=n=>({kind:"numberGroup",group:n}),en=n=>({kind:"stringGroup",group:n}),rn=n=>({kind:"tuple",tuple:n}),un=n=>({state:n}),on=(n,t)=>({commands:n,payload:t});var an=function(n){return"Some"===n._tag},cn=function(n){return"None"===n._tag},sn={_tag:"None"},ln=function(n){return{_tag:"Some",value:n}};function fn(n){return function(t){return n(t)?ln(t):sn}}var dn=function(n){return function(t){return cn(t)?n():t.value}};var pn=function(n,t){return cn(n)?sn:ln(t(n.value))},mn=function(n){return function(t){return pn(t,n)}};function gn(n){return{equals:function(t,e){return t===e||(cn(t)?cn(e):!cn(e)&&n.equals(t.value,e.value))}}}function vn(n){return{equals:gn(n).equals,compare:function(t,e){return t===e?0:an(t)?an(e)?n.compare(t.value,e.value):1:-1}}}function hn(n,t){return n<t?-1:n>t?1:0}function yn(n,t){return n===t}var wn={equals:yn,compare:hn},kn={equals:yn,compare:hn};function bn(n){return function(t,e){return-1===n.compare(t,e)}}function _n(n){return function(t,e){return 1===n.compare(t,e)}}function jn(n){return function(t,e){return-1===n.compare(t,e)?e:t}}function On(n){var t=function(t,e){return t===e?0:n(t,e)};return{equals:function(n,e){return 0===t(n,e)},compare:t}}var An=function(n,t){return On((function(e,r){return n.compare(t(e),t(r))}))},zn=function(n){return function(t){return An(t,n)}};var xn=function(n,t){var e=n.length;if(0===e)return t;var r=t.length;if(0===r)return n;for(var u=Array(e+r),i=0;i<e;i++)u[i]=n[i];for(i=0;i<r;i++)u[i+e]=t[i];return u};function Tn(n){return{equals:function(t,e){return t===e||t.length===e.length&&t.every((function(t,r){return n.equals(t,e[r])}))}}}function qn(n){return 0===n.length}function Mn(n){return n.length>0}function Nn(n,t){if(void 0===t)return function(t){return Nn(n,t)};for(var e=t.length,r=Array(e+1),u=0;u<e;u++)r[u+1]=t[u];return r[0]=n,r}function Sn(n,t){for(var e=n.length,r=Array(e+1),u=0;u<e;u++)r[u]=n[u];return r[e]=t,r}var In=function(n,t){for(var e=n.length,r=0;r<e&&t(n[r]);r++);return r};function En(n){return qn(n)?n:n.slice().reverse()}var Ln=function(n){return function(t){return qn(t)?t:t.slice().sort(n.compare)}};function Pn(n,t,e){for(var r=[],u=Math.min(n.length,t.length),i=0;i<u;i++)r[i]=e(n[i],t[i]);return r}function Cn(n){return function(t,e){if(void 0===e){var r=Cn(n);return function(n){return r(t,n)}}for(var u,i=0,o=e.length;i<o;i++)if(u=e[i],n.equals(u,t))return!0;return!1}}var Gn=function(){return Hn},Vn=function(n,t){for(var e=0,r=n.length,u=new Array(r),i=0;i<r;i++){e+=(c=t(i,n[i])).length,u[i]=c}var o=Array(e),a=0;for(i=0;i<r;i++){for(var c,s=(c=u[i]).length,l=0;l<s;l++)o[l+a]=c[l];a+=s}return o},Dn=function(n,t){return Vn(n,(function(n,e){return t(e)}))},Rn=function(n,t){return Un(n,(function(n,e){return t(e)}))},Fn=function(n,t,e){for(var r=n.length,u=t,i=0;i<r;i++)u=e(i,u,n[i]);return u},Un=function(n,t){for(var e=[],r=0;r<n.length;r++){var u=t(r,n[r]);an(u)&&e.push(u.value)}return e},$n=function(n){var t=Jn(n);return function(n,e){return t(n,(function(n,t){return e(t)}))}},Jn=function(n){return function(t,e){return Fn(t,n.of(Gn()),(function(t,r,u){return n.ap(n.map(r,(function(n){return function(t){return Sn(n,t)}})),e(t,u))}))}},Yn=function(n){return function(t){return Dn(t,n)}},Wn=function(n){return Rn(n,r)},Bn=function(n){var t=$n(n);return function(n){return function(e){return t(e,n)}}};var Hn=[],Kn=function(n){return On((function(t,e){for(var r=t.length,u=e.length,i=Math.min(r,u),o=0;o<i;o++){var a=n.compare(t[o],e[o]);if(0!==a)return a}return kn.compare(r,u)}))},Qn=function(n){return function(t){return t.slice(0,n)}};function Xn(n){return function(n){return function(t){for(var e=In(t,n),r=Array(e),u=0;u<e;u++)r[u]=t[u];var i=t.length,o=Array(i-e);for(u=e;u<i;u++)o[u-e]=t[u];return{init:r,rest:o}}}(n)}var Zn=function(n){return function(t){return t.slice(n,t.length)}},nt=function(n){return function(t){for(var e=In(t,n),r=t.length,u=Array(r-e),i=e;i<r;i++)u[i-e]=t[i];return u}};var tt=En,et=Ln,rt=Pn;var ut=function n(t){var e=Cn(t);return function(r,u){if(void 0===u){var i=n(t);return function(n){return i(n,r)}}return xn(r,u.filter((function(n){return!e(n,r)})))}},it=Yn,ot=Wn,at=Bn,ct=i;function st(n){switch(n.kind){case"null":return ft.encode(n);case"string":return dt.encode(n);case"number":return pt.encode(n);case"array":return mt.encode(n);case"object":return gt.encode(n)}}function lt(n){return null===n?ft.decode(n):"number"==typeof n?pt.decode(n):"string"==typeof n?dt.decode(n):Array.isArray(n)?mt.decode(n):gt.decode(n)}const ft=new N("simpleNullCodec",n=>{const t=n;return"null"===t.kind&&null===t.value},(n,t)=>null===n?L({kind:"null",value:null}):E(n,t),n=>n.value),dt=new N("simpleStringCodec",n=>{const t=n;return"string"===t.kind&&"string"==typeof t.value},(n,t)=>"string"==typeof n?L(U(n)):E(n,t),n=>n.value),pt=new N("simpleNumberCodec",n=>{const t=n;return"number"===t.kind&&"number"==typeof t.value},(n,t)=>"number"==typeof n?L($(n)):E(n,t),n=>n.value),mt=new N("simpleArrayCodec",n=>{const t=n;return"array"===t.kind&&Array.isArray(t.value)},(n,t)=>{if(Array.isArray(n)){const t=at(T)(lt)(n);return j(J)(t)}return E(n,t)},n=>n.value.map(st)),gt=new N("simpleObjectCodec",n=>"object"===n.kind,(n,t)=>{if(n&&n.constructor===Object){const t=at(T)(([n,t])=>ct(lt(t),j(t=>u(n,t))))(Object.entries(n));return j(n=>Y(new Map([...n])))(t)}return E(n,t)},n=>{const t=[...n.value.entries()];return Object.assign({},...Array.from(t,([n,t])=>({[n]:st(t)})))});new N("simpleJsonCodec",n=>ft.is(n)||pt.is(n)||dt.is(n)||mt.is(n)||gt.is(n),lt,st);var vt=e(0),ht=e.n(vt);const yt=(n,t)=>{switch(n.kind){case"bottom":return{kind:"bottom"};case"inner":return H(t(n.a));case"top":return K(n.error)}},wt=n=>On((t,e)=>{if("bottom"===t.kind&&"bottom"===e.kind)return 0;if("bottom"===t.kind)return-1;if("bottom"===e.kind)return 1;if("top"===t.kind&&"top"===e.kind)return wn.compare(t.error,e.error);if("top"===t.kind)return 1;if("top"===e.kind)return-1;if("inner"===t.kind&&"inner"===e.kind)return n.compare(t.a,e.a);throw new Error("Non exhaustive match in extendedAlgebraOrd")});function kt(n){return Mn(n)?ln(n):sn}var bt=Nn,_t=function(n){return kt(function(n){var t=n.length;if(0===t)return Hn;for(var e=Array(t),r=0;r<t;r++)e[r]=n[r];return e}(n))},jt=Tn;function Ot(n,t){return ot(n.map(t))}function At(n,t,e,r){const u=(n,t)=>{if(0===n.length)return ot(t.map(n=>ln({1:n[1],2:e(sn,ln(n[2]))})));if(0===t.length)return ot(n.map(n=>ln({1:n[1],2:e(ln(n[2]),sn)})));if(n.length>0&&t.length>0&&bn(r)(n[0][1],t[0][1])){const[r,...i]=n,o=r[1],a=r[2];return bt({1:o,2:e(ln(a),sn)},u(i,t))}if(n.length>0&&t.length>0&&_n(r)(n[0][1],t[0][1])){const[r,...i]=t,o=r[1],a=r[2];return bt({1:o,2:e(sn,ln(a))},u(n,i))}if(n.length>0&&t.length>0){const[r,...i]=n,[o,...a]=t,c=r[1],s=r[2],l=o[2];return bt({1:c,2:e(ln(s),ln(l))},u(i,a))}throw new Error("Non exhaustive match in mapOption2")},i=zn(n=>n[1])(r),o=(n=>{const t=Ot(n,n=>an(n[2])?ln({1:n[1],2:n[2].value}):sn);return 0===t.length?sn:ln(t)})(u(et(i)([...n].map(n=>({1:n[0],2:n[1]}))),et(i)([...t].map(n=>({1:n[0],2:n[1]})))));return mn(n=>new Map(n.map(n=>[n[1],n[2]])))(o)}function zt(n,t,e,r){const u=zn(n=>n[0])(r),i=et(u)([...t]).reduceRight((n,t)=>{if(o(n)){const r=e(t[1],n.left);return an(r)?a(r.value):c(t[0])}return n},a(n));return"Left"===(s=i)._tag?sn:ln(s.right);var s}function xt(n,t){return new Map([...n].map(t))}function Tt(n,t){return new Map([...n].filter(t))}function qt(n){return{equals:function(t,e){return t===e||n(t,e)}}}var Mt={equals:function(n,t){return n===t}};var Nt=Mt,St=Mt;function It(n){return mn(Vt)(function(n){switch(n.state.kind){case"top":return ln(U(n.state.error));case"bottom":return sn;case"inner":return function(n){return function(n){switch(n.kind){case"numberGroup":case"stringGroup":return Et(n.group);case"tuple":return n.tuple.length>0}}(n.payload)?ln(J(function(n,t){const e=mn(n=>bt(n,t))(n);return dn(()=>t)(e)}(mn(n=>U(function(n){const t=n=>{switch(n){case"add":return"p";case"mul":return"m";case"max":return"v";case"min":return"n"}};return n.map(n=>1===n[2]?t(n[1]):t(n[1])+JSON.stringify(n[2])).join("")}(n)))(n.commands),function(n){const t=n=>{switch(n.kind){case"bottom":return{kind:"null",value:null};case"top":return U(n.error);case"inner":return $(n.a)}};switch(n.kind){case"tuple":return n.tuple.map(t);case"stringGroup":return e=n.group,Ot([Lt,Pt,n=>ct(n,Gt,Y,ln)],n=>n(e));case"numberGroup":return(n=>Ot([Lt,Ct,n=>ct(n,Gt,n=>xt(n,([n,t])=>[JSON.stringify(n),t]),Y,ln)],t=>t(n)))(n.group)}var e}(n.payload)))):sn}(n.state.a)}}(n))}function Et(n){switch(n.kind){case"unbounded":return n.group.size>0;case"windowed":return n.group.size>0||an(n.key);case"countLimit":case"uniqueLimit":return n.group.size>0||an(n.limit)}}function Lt(n){switch(n.kind){case"unbounded":return sn;case"windowed":return ln(U("w"));case"countLimit":return ln(U(1===n.n?"x":"x"+n.n));case"uniqueLimit":return ln(U(1===n.n?"u":"u"+n.n))}}function Pt(n){switch(n.kind){case"unbounded":return sn;case"windowed":return ln(U(an(n.key)?n.key.value:""));case"countLimit":case"uniqueLimit":return ln(U(an(n.limit)?n.limit.value:""))}}function Ct(n){switch(n.kind){case"unbounded":return sn;case"windowed":return an(n.key)?ln($(n.key.value)):ln({kind:"null",value:null});case"countLimit":case"uniqueLimit":return an(n.limit)?ln($(n.limit.value)):ln({kind:"null",value:null})}}function Gt(n){switch(n.kind){case"unbounded":case"windowed":case"countLimit":case"uniqueLimit":return n.group}}function Vt(n){switch(n.kind){case"array":return 0===n.value.length?{kind:"null",value:null}:1===n.value.length?Vt(n.value[0]):J(n.value.map(Vt));case"object":return ct(Tt(n.value,([n,t])=>"null"!==t.kind),n=>xt(n,n=>[n[0],Vt(n[1])]),Y);default:return n}}function Dt(n){const t=n=>{if(0===n.length)return{kind:"bottom"};const t=(n=>{if(4!==n.length)return sn;const[t,e,r,u]=n;if("string"===t.kind&&"string"===e.kind&&"object"===u.kind){const n=fn(n=>Rt(n[1].value)&&Ft(n[2].value))({1:t,2:e});return mn(n=>({prim:n[1].value,grp:n[2].value,cutoff:r,m:u.value}))(n)}return sn})(n);if(an(t)){const{prim:n,grp:e,cutoff:r,m:u}=t.value,i=Ut(r,u,$t(e));return"string"==typeof i?K(i):H(on(Jt(n),i))}const e=(n=>{if(3!==n.length)return sn;const[t,e,r]=n;if("string"===t.kind&&"object"===r.kind){const n=fn(n=>Ft(n.value))(t);return mn(n=>({grp:n.value,cutoff:e,m:r.value}))(n)}return sn})(n);if(an(e)){const{grp:n,cutoff:t,m:r}=e.value,u=Ut(t,r,$t(n));return"string"==typeof u?K(u):H(on(sn,u))}const r=(n=>{if(2!==n.length)return sn;const[t,e]=n;if("string"===t.kind&&"object"===e.kind){const n=fn(n=>Rt(n.value))(t);return mn(n=>({prim:n.value,m:e.value}))(n)}return sn})(n);if(an(r)){const{prim:n,m:t}=r.value;return H(on(Jt(n),en(Q(t))))}const u=(n=>{if(1!==n.length)return sn;const[t]=n;return"object"===t.kind?ln({m:t.value}):sn})(n);if(an(u)){const{m:n}=u.value;return H(on(sn,en(Q(n))))}const i=(n=>{if(n.length<1)return sn;const[t,...e]=n;if("string"===t.kind){const n=fn(n=>Rt(n.value))(t);return mn(n=>({prim:n.value,rest:e}))(n)}return sn})(n);if(an(i)){const{prim:n,rest:t}=i.value;return H(on(Jt(n),Yt(t)))}return H(on(sn,Yt(n)))},e=n=>{switch(n.kind){case"array":return it(e)(n.value);default:return[n]}};switch(n.kind){case"null":return un({kind:"bottom"});default:return un(t(e(n)))}}function Rt(n){const t=n.split("");switch(!0){case 0===t.length:return!1;default:{const[n,...e]=t;return-1!=="pmvn".indexOf(n)&&e.every(n=>-1!=="pmvn0123456789".indexOf(n))}}}function Ft(n){const t=n.split("");switch(!0){case 0===t.length:return!1;case"w"===t[0]&&void 0===t[1]:return!0;default:{const[n,...e]=t;return-1!=="ux".indexOf(n)&&-1===e.map(n=>!isNaN(parseInt(n))).indexOf(!1)}}}function Ut(n,t,e){switch(n.kind){case"string":return en(e({1:ln(n.value),2:t}));case"number":case"null":return tn(e({1:"null"===n.kind?sn:ln(n.value),2:Tt(xt(t,([n,t])=>[Number(n),t]),n=>!isNaN(n[0]))}));default:return"{bad cutoff}"}}function $t(n){const t=n=>t=>nn(t[2],t[1],n),e=n=>t=>Z(t[2],t[1],n),r=n.split("");switch(!0){case"w"===r[0]&&void 0===r[1]:return n=>X(n[2],n[1]);case"u"===r[0]&&void 0===r[1]:return t(1);case"u"===r[0]&&void 0!==r[1]:return t(parseInt(r.slice(1).join("")));case"x"===r[0]&&void 0===r[1]:return e(1);case"x"===r[0]&&void 0!==r[1]:return e(parseInt(r.slice(1).join("")));default:throw new Error("This should never happen if you use isGroupCommand")}}function Jt(n){return mn(W)(_t(function n(t,e){const r=e(t);return dn(()=>[])(mn(t=>[t[1]].concat(n(t[2],e)))(r))}(n,n=>{const t=n.split("");if(0===t.length)return sn;const[e,...r]=t,u=(n=>{switch(n){case"p":return ln("add");case"m":return ln("mul");case"v":return ln("max");case"n":return ln("min");default:return sn}})(e);return mn(n=>{const{init:t,rest:e}=Xn(n=>{return"number"==typeof(t=parseInt(n))&&isFinite(t)&&Math.floor(t)===t;var t})(r);return{1:{1:n,2:0===t.length?1:parseInt(t.join(""))},2:e.join("")}})(u)})))}function Yt(n){return rn(n.map(Wt))}function Wt(n){switch(n.kind){case"number":return H(n.value);case"string":return K(n.value);case"null":return{kind:"bottom"};case"object":return K("{object}");case"array":return K("{array}")}}const Bt={strategy:(n,t,e)=>r=>{if(cn(e))return t;if("delta"===n&&cn(t))return sn;if(cn(t))return e;if(an(t)&&an(e))return r(t.value,e.value);throw new Error("Non exhaustive match in combineCommand.strategy")},operation:(n,t,e,r,u,i)=>{const o=Kn(wt(i));if("append"===n&&"add"===t)return rt(e,r,te(u.plus));if("append"===n&&"mul"===t)return rt(e,r,te(u.times));if("append"===n&&"max"===t)return jn(o)(e,r);if("join"===n&&"add"===t)return rt(e,r,te(jn(i)));if("join"===n&&"mul"===t)return rt(e,r,te(jn(i)));if("join"===n&&"max"===t)return jn(o)(e,r);if("min"===t)return Bt.operation(n,"max",e,r,u,function(n){return On((t,e)=>function(n){switch(n){case-1:return 1;case 1:return-1;default:return 0}}(n.compare(t,e)))}(i));if("delta"===n&&"max"===t)return _n(o)(e,r)?e:r.map(B);if("delta"===n)return rt(e,r,(n,t)=>_n(wt(i))(n,t)?n:{kind:"bottom"});throw new Error("Non exhaustive match in combineCommand.operation")}},Ht={plus:(n,t)=>n+t,times:(n,t)=>n*t};function Kt(n,t,e,r){if("unbounded"===n.kind&&"unbounded"===t.kind){const u=n.group,i=t.group;return dn(B)(mn(n=>H(Q(n)))(At(u,i,e,r)))}if("windowed"===n.kind&&"windowed"===t.kind){const u=n.key,i=n.group,o=t.key,a=t.group,c=jn(vn(r))(u,o);return dn(B)(mn(n=>H(X(n,c)))(At(i,a,e,r)))}if("countLimit"===n.kind&&"countLimit"===t.kind){const u=n.n,i=t.n;if(u===i){const i=n.limit,o=n.group,a=t.limit,c=t.group,s=jn(vn(r))(i,a);return dn(B)(mn(n=>H(Z(n,s,u)))(At(o,c,e,r)))}return K("Non matching counts")}if("uniqueLimit"===n.kind&&"uniqueLimit"===t.kind){const u=n.n,i=t.n;if(u===i){const i=n.limit,o=n.group,a=t.limit,c=t.group,s=jn(vn(r))(i,a);return dn(B)(mn(n=>H(nn(n,s,u)))(At(o,c,e,r)))}return K("Non matching counts")}return K("Non matching group types")}function Qt(n,t,e){return dn(F)(function n(t,e){const r=e=>(r,u)=>Bt.strategy(t,r,u)(n(t,e)),u=(n,e,u)=>{if("stringGroup"===e.kind&&"stringGroup"===u.kind){const t=Kt(e.group,u.group,r(n),wn);return yt(t,n=>en(Zt(n,wn)))}if("numberGroup"===e.kind&&"numberGroup"===u.kind){const t=Kt(e.group,u.group,r(n),kn);return yt(t,n=>tn(Zt(n,kn)))}if("tuple"===e.kind&&"tuple"===u.kind){const r=an(n)?n.value:[];return H(rn(function(n,t,e,r,u,i){const o=(n,t)=>({1:Qn(n)(t).concat([...Array(Math.max(0,n-t.length))].map(B)),2:Zn(n)(t)}),a=(t,e,r)=>{if(0===t.length)return Bt.operation(n,"max",e,r,u,i);if(0===e.length)return r;if(0===r.length)return e;if(t.length>0){const[c,...s]=t,l=o(c[2],e),f=l[1],d=l[2],p=o(c[2],r),m=p[1],g=p[2];return Bt.operation(n,c[1],f,m,u,i).concat(a(s,d,g))}throw new Error("Non exhaustive match in recurse")};return tt(nt(n=>"bottom"===n.kind)(tt(a(t,e,r))))}(t,r,e.tuple,u.tuple,Ht,kn)))}throw new Error(`Non matching payload. Got ${e.kind} and ${u.kind}`)},i=(n,t)=>{var r;if(gn(jt((r={1:Nt,2:St},qt((function(n,t){for(var e in r)if(!r[e].equals(n[e],t[e]))return!1;return!0}))))).equals(n.commands,t.commands)){const r=cn(n.commands)?e:n.commands,i=u(r,n.payload,t.payload);return yt(i,t=>on(n.commands,t))}throw new Error(`Non matching primitive strings. Got ${JSON.stringify(n)} and ${JSON.stringify(t)}`)};return(n,t)=>It(un(ne(i,Dt(n).state,Dt(t).state)))}(n,sn)(t,e))}function Xt(n,t,e){const r=mn(t=>Tt(n,([n,r])=>{return(u=e,function(n,t){return-1!==u.compare(n,t)})(n,t);var u}))(t);return dn(()=>n)(r)}function Zt(n,t){switch(n.kind){case"unbounded":return n;case"windowed":return cn(n.key)?n:X(Xt(n.group,n.key,t),n.key);case"countLimit":{const e=n.limit,r=n.n,u=n.group,i=zt(r,u,(n,t)=>t<=1?sn:ln(t-1),t),o=jn(vn(t))(e,i);return Z(Xt(u,o,t),o,r)}case"uniqueLimit":{const e=n.limit,r=n.n,u=n.group,i=(n,t)=>{switch(n.kind){case"object":{const e=[...n.value.keys(),...t.keys()],u=new Set(e);return u.size>=r?sn:ln(u)}default:return sn}},o=zt(new Set,u,i,t),a=jn(vn(t))(e,o);return nn(Xt(u,a,t),a,r)}}}function ne(n,t,e){if("inner"===t.kind&&"inner"===e.kind)return n(t.a,e.a);if("bottom"===t.kind)return e;if("bottom"===e.kind)return t;if("top"===t.kind&&"top"===e.kind)return K(jn(wn)(t.error,e.error));if("top"===t.kind)return t;if("top"===e.kind)return e;throw new Error("Non exhaustive match in extend")}function te(n){return(t,e)=>ne((t,e)=>H(n(t,e)),t,e)}function ee(n,t){return Qt("append",n,t)}function re(n,t){const e=Object.keys(n),r=e.length,u={};for(let i=0;i<r;i++){const r=e[i],o=t(r,n[r]);an(o)&&(u[r]=o.value)}return u}var ue=function(n,t){var e={};for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&t.indexOf(r)<0&&(e[r]=n[r]);if(null!=n&&"function"==typeof Object.getOwnPropertySymbols){var u=0;for(r=Object.getOwnPropertySymbols(n);u<r.length;u++)t.indexOf(r[u])<0&&Object.prototype.propertyIsEnumerable.call(n,r[u])&&(e[r[u]]=n[r[u]])}return e};const[ie,oe]=u({47118:(ae=(()=>{function n(n){switch(n.length){case 0:return null;case 1:return n[0];default:return n}}function t(n,t,e=i){let r=t.reduce((function(n,t){return n&&null!=n[t]?n[t]:null}),n);return null===r?null:e(r)}function e(n,t){var e=t.slice();return e.unshift(n),e}let r=(n,r,u=i)=>t(n,e("properties",r),u);function u(n){const t=Object.keys(n);for(var e=t.length,r=new Array(e);e--;)r[e]=[t[e],n[t[e]]];return r}let i=n=>n,o=n=>!0,a=(n,t)=>e=>n(e)&&t(e),c=(n,t)=>e=>n(e)||t(e),s=n=>t=>!n(t),l=(n,t)=>e=>e>=n&&e<=t,f=n=>new Date(n).getTime(),d=n=>t(n,["time"],f),p=(n,e)=>t(e,n,f),m=(n,e,r,u,i,o)=>a=>{const c=t(a,n,n=>n.filter(u).map(n=>t(n,e)).reduce(i,o));return r(null===c?o:c)},g=n=>t=>"string"==typeof n&&"string"==typeof t&&t.toLowerCase().indexOf(n.toLowerCase())>-1,v=n=>t=>null!=t&&"object"==typeof t&&t.indexOf(n)>=0;function h(n,e,r,u,i){const o=t(n.getSegments(),[e,r])||!1;return i&&(u||o)&&n.setSegmentActivation(e,r,i),o}function y(n,e,r){return t(n.getSegments(),[e,r])||!1}let w=(n,e,r=18e5)=>u=>({a:{m:(n,t)=>[t[0],u.a.m(null!=n[0]&&n[0][0]===t[0][0]?n[1]:u.a.z,t[1])],z:[[],u.a.z]},p:(r,i)=>[[n(r)],t(i,e)===n(r)?u.p(r,i):u.a.z],r:(t,e)=>u.r(t,e[0]!=[]&&e[0][0]===n(t)?e[1]:u.a.z),d:u.d.sq||{l:(i,o)=>{let a=t(i,e),c=n(o);if(a!==c)return null;let s=u.d.l(i,o);if(!(Array.isArray(s)&&s.length>1))return null;let[l,...f]=s,p=+(d(i)||o.getCurrentTime()),m=Math.floor(p/r),g={};return g[m]={},g[m][c]=1===f.length?f[0]:f,[l,"u",null,g]},i:(t,e)=>{if(!Array.isArray(t)||"object"!=typeof t[3])return[[],u.a.z];let r=n(e),i=t[3];return[[r],Object.keys(i).map(n=>i[n][r]).filter(n=>n).map(n=>u.d.i([t[0]].concat(n))).reduce(u.a.m,u.a.z)]}}}),k=w(n=>n.getCurrentSession(),["session_id"],18e5),b=w(n=>n.getCurrentView(),["view_id"],3e5);function _(n,e,r,u=1){return{a:{m:(n,t)=>n.concat(t).slice(-r),z:[]},p:(r,u)=>t(u,["name"])===e?[n.p(r,u)]:[],r:(t,e)=>n.r(t,e.reduce((t,e)=>n.a.m(t,e),n.a.z)),d:n.d.ftn||{l:(e,i)=>{const o=n.d.l(e,i),a=t(e,["time"],f)*u;return o&&[o[0],"x"+r,null,{[a]:2==o.length?o[1]:o.slice(1)}]},i:(t,e)=>t?Object.keys(t[3]||{}).sort().reverse().map(n=>Array.isArray(n)?[t[0],...t[3][n]]:[t[0],t[3][n]]).map(t=>n.d.i(t,e)):[]}}}let j=(n,t)=>null===n?null==t?null:{b:t}:null==t?{a:n}:{a:n,b:t},O=(n,t)=>n&&t?n(t):null,A=(n,t,e)=>e&&e.result&&Array.isArray(e.result)?j(O(n.d&&n.d.m,{result:e.result[0]}),O(t.d&&t.d.m,{result:e.result[1]})):null;return{q:function(n){const t=(t,e)=>({result:n.r(t,e)});return{initial:t=>({result:n.a.z}),update:(t,e,r)=>({result:n.a.m(e.result,n.p(t,r))}),result:(n,e)=>t(n,e.result),lift:(t,e)=>n.d.l(t,e),interpret:(e,r)=>t(r,n.d.i(e,r)),migrate:t=>t&&n.d.m?n.d.m(t):null,m:n.a.m,z:n.a.z,p:n.p,r:n.r,i:n.d.i}},a:n=>n.reduce(a),acq:function(n,t){return{p:(e,r)=>[n.p(e,r),t.p(e,r)],r:(e,r)=>n.r(e,r[0])&&t.r(e,r[1]),a:{z:[n.a.z,t.a.z],m:(e,r)=>[n.a.m(e[0],r[0]),t.a.m(e[1],r[1])]},d:{l:(e,r)=>j(n.d.l(e,r),t.d.l(e,r)),i:(e,r)=>e?[n.d.i(e.a||null,r),t.d.i(e.b||null,r)]:[n.a.z,t.a.z],m:e=>A(n,t,e)}}},af_i:(n,e,r=o)=>u=>t(u,n,n=>n.filter(r).map(e).reduce((n,t)=>n&&t,!0))&&!0,af_l:(n,e,r=o)=>u=>{const i=t(u,n,n=>n.filter(r).length);return e(null===i?0:i)},af_m:(n,e,r,u=o)=>i=>{const o=t(i,n,n=>n.filter(u));return null===o||0===o.length?r(0):r(o.map(n=>t(n,e)).reduce((n,t)=>n+t,0)/o.length)},af_n:(n,t,e,r=o)=>m(n,t,e,r,(n,t)=>Math.min(n,t),Number.POSITIVE_INFINITY),af_p:(n,t,e,r=o)=>m(n,t,e,r,(n,t)=>n*t,1),af_s:(n,t,e,r=o)=>m(n,t,e,r,(n,t)=>n+t,0),af_u:(n,e,r=o)=>u=>t(u,n,n=>n.filter(r).map(e).reduce((n,t)=>n||t,!1))||!1,af_x:(n,t,e,r=o)=>m(n,t,e,r,(n,t)=>Math.max(n,t),Number.NEGATIVE_INFINITY),as:(n,r,u)=>i=>u.reduce((u,o)=>u&&n(o)(t(i,e("properties",r))),!0),c:v,c_:(n,e)=>r=>v(e)(t(r,n)),ctu:function(n,e,r,u){return{a:u?{m:(n,t)=>n.filter(n=>-1===t.indexOf(n)).concat(t).slice(-u),z:[]}:{m:(n,t)=>n.filter(n=>-1===t.indexOf(n)).concat(t),z:[]},p:(u,i)=>t(i,["name"])===n&&e(i)?t(i,r):[],r:(n,t)=>t,d:{l:()=>null,i:()=>[]}}},ctv:function(n,e,r,u){function i(n,t){const e=n=>({k:n.k,c:1+n.c}),r={arr:[],add:{k:t,c:1}};return t?(n=>n.arr.concat(n.add))(n.reduce((n,t)=>n.add.k===t.k?{arr:n.arr,add:e(t)}:{arr:n.arr.concat(t),add:n.add},r)):n}return{a:u?{m:(n,t)=>i(n,t).slice(-u),z:[]}:{m:(n,t)=>i(n,t),z:[]},p:(u,i)=>t(i,["name"])===n&&e(i)?t(i,r):null,r:(n,t)=>t.reduce((n,t)=>Object.assign(Object.assign({},n),{[t.k]:t.c}),{}),d:{l:n=>null,i:n=>[]}}},ctw:function(n,e,r,u){return{a:u?{m:(n,t)=>n.concat(t).slice(-u),z:[]}:{m:(n,t)=>n.concat(t),z:[]},p:(u,i)=>t(i,["name"])===n&&e(i)?t(i,r):[],r:(n,t)=>t,d:{l:()=>null,i:()=>[]}}},cw:function(n,e,r=i){return{a:{m:(n,t)=>n+t,z:0},p:(r,u)=>t(u,["name"])===n&&e(u)?1:0,r:(n,t)=>r(t),d:{l:r=>t(r,["name"])===n&&e(r)?["p",1]:null,i:n=>n?Array.isArray(n)?n.slice(-1)[0]:n:0,m:n=>n&&n.result?["p",n.result]:null}}},e:n=>t=>t===n,e_:(n,e)=>r=>t(r,n)===e,fm:function(n,t){return{p:t.p,r:(e,r)=>n(t.r(e,r)),a:t.a,d:t.d}},ftn:function(n,e,r){return{a:{m:(n,t)=>n.concat(t.slice(0,r-n.length)),z:[]},p:(r,u)=>t(u,["name"])===e?[n.p(r,u)]:[],r:(t,e)=>n.r(t,e.reduce((t,e)=>n.a.m(t,e),n.a.z)),d:_(n,e,r,-1).d}},fw:function(n,e,r,u=i){return{a:{m:(n,t)=>null===n?t:n,z:null},p:(u,i)=>t(i,["name"])===n&&e(i)?t(i,r):null,r:(n,t)=>t,d:{l:r=>t(r,["name"])===n&&e(r)?["p",1]:null,i:n=>n?Array.isArray(n)?n.slice(-1)[0]:n:0,m:n=>n&&n.result?["p",n.result]:null}}},g:n=>t=>t>n,g_:(n,e)=>r=>t(r,n)>e,gb:function(n,r,u){return{a:{m:(e,u)=>Object.keys(e).concat(Object.keys(u)).filter((n,t,e)=>e.indexOf(n)===t).sort((n,r)=>Math.max(t(e,[r,1]),t(u,[r,1]))-Math.max(t(e,[n,1]),t(u,[n,1]))).slice(0,r).reduce((r,i)=>{const o=n.a.m(t(e,[i,0])||n.a.z,t(u,[i,0])||n.a.z);return r[i]=[o,Math.max(t(e,[i,1]),t(u,[i,1]))],r},{}),z:{}},p:(r,i)=>{const o=t(i,e("properties",u)),a=n.p(r,i);return null==o||null==(c=a)||"object"==typeof c&&0===Object.keys(c).length||c===n.a.z?{}:{[o]:[a,t(i,["time"],f)]};var c},r:(t,e)=>{const r={};return Object.keys(e).forEach(u=>r[u]=n.r(t,e[u][0])),r},d:{l:()=>null,i:()=>({})}}},ge:n=>t=>t>=n,ge_:(n,e)=>r=>t(r,n)>=e,i_:i,ifp:function(n){let t=(t,e)=>y(t,"1p",n);return{a:{m:(n,t)=>t,z:!1},p:t,r:(n,t)=>t,d:{l:(n,e)=>["v2",+f(d(n)||e.getCurrentTime()),+t(e)],i:n=>Array.isArray(n)&&(!!+n[2]||!1)}}},isp:function(n,t,e,r){return{a:{m:(n,t)=>t,z:!1},p:(e,r)=>y(e,n,t),r:(u,i)=>h(u,n,t,e,r),d:{l:(n,t)=>null,i:n=>Array.isArray(n)&&(!!+n[2]||!1)}}},itp:function(n,t,e,r){return{a:{m:(n,t)=>t,z:!1},p:(e,r)=>y(e,n,t),r:(u,i)=>h(u,n,t,e,r),d:{l:(n,t)=>null,i:n=>Array.isArray(n)&&(!!+n[2]||!1)}}},k:t,l:n=>t=>t<n,l_:(n,e)=>r=>t(r,n)<e,le:n=>t=>t<=n,le_:(n,e)=>r=>t(r,n)<=e,lm:function(n,t){let e=(t,e)=>function(n,t,e){const r=n||{},i=t[e]||{};var o=(i["1p"]||{}).const||0;const a=u(i);for(var c in a){const n=u(a[c][1]);for(var s in n)!0===(r[a[c][0]]||{})[n[s][0]]&&(o+=n[s][1])}return l=o,1/(1+Math.pow(Math.E,-l));var l}(t.getSegments(),t.getLookalikeModels(),n);return{a:{m:(n,t)=>t,z:[]},p:(n,t)=>[e(n)],r:(n,e)=>!!e[0]&&t(e[0]),d:{l:(n,t)=>["v2",+f(d(n)||t.getCurrentTime()),+e(t)],i:n=>Array.isArray(n)?[+n[2]]||!1:[]}}},ltn:_,mnw:function(n,e,r,u=i){var o=Number.POSITIVE_INFINITY;return{a:{m:(n,t)=>n<t?n:t,z:o},p:(u,i)=>t(i,["name"])===n&&e(i)?t(i,r):o,r:(n,t)=>u(t),d:{l:u=>t(u,["name"])===n&&e(u)?["n",t(u,r)]:null,i:n=>n?Array.isArray(n)?n.slice(-1)[0]:n:o}}},mxw:function(n,e,r,u=i){const o=Number.NEGATIVE_INFINITY;return{a:{m:(n,t)=>n>t?n:t,z:o},p:(u,i)=>t(i,["name"])===n&&e(i)?t(i,r):o,r:(n,t)=>u(t),d:{l:u=>t(u,["name"])===n&&e(u)?["v",t(u,r)]:null,i:n=>n?Array.isArray(n)?n.slice(-1)[0]:n:o}}},n0:s(i),n:n=>t=>t!==n,nt:s,n_:(n,e)=>r=>t(r,n)!==e,o:n=>n.reduce(c),ocq:function(n,t){return{p:(e,r)=>[n.p(e,r),t.p(e,r)],r:(e,r)=>n.r(e,r[0])||t.r(e,r[1]),a:{z:[n.a.z,t.a.z],m:(e,r)=>[n.a.m(e[0],r[0]),t.a.m(e[1],r[1])]},d:{l:(e,r)=>j(n.d.l(e,r),t.d.l(e,r)),i:(e,r)=>e?[n.d.i(e.a||null,r),t.d.i(e.b||null,r)]:[n.a.z,t.a.z],m:e=>A(n,t,e)}}},oe:u,os:(n,r,u)=>i=>u.reduce((u,o)=>u||n(o)(t(i,e("properties",r))),!1),pb:(n,t,e)=>u=>l(t,e)(r(u,n)),pc:(n,r)=>u=>{const i=t(u,e("properties",n));return null!=i&&"object"==typeof i&&i.indexOf(r)>=0},pe:(n,t)=>e=>r(e,n)===t,pg:(n,t)=>e=>r(e,n)>t,pge:(n,t)=>e=>r(e,n)>=t,pl:(n,t)=>e=>r(e,n)<t,ple:(n,t)=>e=>r(e,n)<=t,pn:(n,t)=>e=>r(e,n)!==t,ps:(n,t)=>e=>g(t)(r(e,n)),pw:function(n,e,r,u=i){return{a:{m:(n,t)=>n*t,z:1},p:(u,i)=>t(i,["name"])===n&&e(i)?t(i,r):1,r:(n,t)=>u(t),d:{l:u=>{return t(u,["name"])===n&&e(u)?(i=t(u,r))>=1?["m2p",i]:i>0?["m2p",null,1/i]:0==i?["m2p",0]:i>-1?["m2p",null,1/i,1]:["m2p",i,null,1]:null;var i},i:n=>{return n?Array.isArray(n)?0===(t=n.slice(1))[0]?0:Math.pow(-1,t[2]||0)*(t[0]||1)/(t[1]||1):n:1;var t}}}},s:g,s_:(n,e)=>r=>g(e)(t(r,n)),scq:function(n,t,e=i){return{p:(e,r)=>[n.p(e,r),t.p(e,r)],r:(r,u)=>e(n.r(r,u[0])+t.r(r,u[1])),a:{z:[n.a.z,t.a.z],m:(e,r)=>[n.a.m(e[0],r[0]),t.a.m(e[1],r[1])]},d:{l:(e,r)=>j(n.d.l(e,r),t.d.l(e,r)),i:(e,r)=>e?[n.d.i(e.a||null,r),t.d.i(e.b||null,r)]:[n.a.z,t.a.z],m:e=>A(n,t,e)}}},sq:k,sw:function(n,e,r,u=i){return{a:{m:(n,t)=>n+t,z:0},p:(u,i)=>t(i,["name"])===n&&e(i)?t(i,r):0,r:(n,t)=>u(t),d:{l:u=>{return(r=>t(r,["name"])===n&&e(r))(u)?(i=t(u,r))<0?["p2",null,-i]:["p2",i]:null;var i},i:n=>{return n?Array.isArray(n)?((t=n.slice(1))[0]||0)-(t[1]||0):n:0;var t}}}},t:o,tb:(n,t)=>e=>l(n,t)(d(e)),te:n=>t=>d(t)===n,te_:(n,t)=>e=>p(n,e)===t,tg:n=>t=>d(t)>n,tg_:(n,t)=>e=>p(n,e)>t,tge:n=>t=>d(t)>=n,tge_:(n,t)=>e=>p(n,e)>=t,ti:f,tl:n=>t=>d(t)<n,tl_:(n,t)=>e=>p(n,e)<t,tle:n=>t=>d(t)<n,tle_:(n,t)=>e=>p(n,e)<t,tn:n=>t=>d(t)!==n,tn_:(n,t)=>e=>p(n,e)!==t,tw:function(e,r,u){const i=u||100,o=Math.ceil(r/i),a=n=>Math.floor(n/o),c=(n,t,e)=>[a(n-r),{[a(t)]:e}],s=(n,t)=>{const r=Math.max(n[0],t[0]),u=Object.keys(n[1]).filter(n=>n>=r).concat(Object.keys(t[1]).filter(n=>n>=r)).filter((n,t,e)=>e.indexOf(n)===t).reduce((r,u)=>{const i=e.a.m(n[1][u]||e.a.z,t[1][u]||e.a.z);return i!==e.a.z&&(r[u]=i),r},{});return[r,u]},l=[Number.NEGATIVE_INFINITY,{}],d=n=>{const t=t=>t.map(([t,e,r])=>c(n.t,r,t)).reduce(s,l);return s(t(n.in),t(n.out))},p=t=>{if(void 0!==t.result)return p(t.result);if(void 0!==t.w)return p(d(t));const[r,u]=t;let i=null,o={};for(let t in u){let r=e.d.m({result:u[t]});r&&Array.isArray(r)&&(i=r[0],o[t]=n(r.slice(1)))}return i&&[i,"w",t[0],o]};return{a:{m:(n,t)=>{const e=n.w?d(n):n;return s(e,t)},z:l},p:(n,r)=>c(n.getCurrentTime(),t(r,["time"],f),e.p(n,r)),r:(n,t)=>{const r=(t.w?d(t):t)[1];return e.r(n,Object.keys(r).reduce((n,t)=>e.a.m(n,r[t]),e.a.z))},d:e.d.tw||{l:(n,r)=>{let u=e.d.l(n,r);return u&&[u[0],"w",...c(r.getCurrentTime(),t(n,["time"],f),u.slice(1))]},i:(n,t)=>{let r=Array.isArray(n)?n:[];return[r[2]||null,Object.keys(r[3]||{}).map(n=>({[n]:e.d.i(r[3][n],t)})).reduce((n,t)=>(Object.keys(t).forEach(e=>n[e]=t[e]),n),{})]},m:e.d.m&&p}}},vgw:function(n,e,r,u=i){const o={v:0,k:0};return{a:{m:(n,t)=>{var e=n.k+t.k;return{v:e?n.v+t.k*(t.v-n.v)/e:0,k:e}},z:o},p:(u,i)=>t(i,["name"])===n&&e(i)?{v:t(i,r),k:1}:o,r:(n,t)=>u(t.v),d:{l:u=>{return t(u,["name"])===n&&e(u)?0==(i=t(u,r))?["p3",1]:i<0?["p3",1,null,-i]:["p3",1,i]:null;var i},i:n=>{return n?Array.isArray(n)?{v:(((t=n.slice(1))[1]||0)-(t[2]||0))/(t[0]||1),k:t[0]||0}:void 0:o;var t}}}},vq:b}})()).q(ae.tw(ae.cw("Pageview",ae.t,ae.ge(1)),2592e6)),47517:ae.q(ae.tw(ae.cw("Pageview",ae.ps(["client","url"],"https://money.usnews.com/"),ae.ge(3)),2592e5)),47518:ae.q(ae.tw(ae.cw("Pageview",ae.ps(["client","url"],"https://money.usnews.com/"),ae.ge(3)),2592e6)),47624:ae.q(ae.cw("Pageview",ae.ps(["client","url"],"elections"),ae.ge(1))),47626:ae.q(ae.cw("Pageview",ae.pe(["client","url"],"https://www.usnews.com/education"),ae.ge(1))),47661:ae.q(ae.itp("liveramp_Acxiom","1824",!1,"47661")),47858:ae.q(ae.ocq(ae.cw("Pageview",ae.o([ae.os(ae.s,["client","url"],["Cars","Trucks","Auto","cars.usnews.com"])]),ae.ge(1)),ae.cw("Pageview",ae.o([ae.os(ae.s,["client","domain"],["cars-trucks","cars","trucks","auto","cars.usnews.com"])]),ae.ge(1)))),47859:ae.q(ae.cw("Pageview",ae.pe(["client","url"],"https://health.usnews.com/best-hospitals"),ae.ge(1))),47860:ae.q(ae.cw("Pageview",ae.o([ae.os(ae.s,["client","title"],["Stock","Stocks"])]),ae.ge(1))),47861:ae.q(ae.cw("Pageview",ae.o([ae.os(ae.s,["client","title"],["Cars","Auto","Trucks","SUV","SUVs","Vans","Hybrids"])]),ae.ge(2))),54663:ae.q(ae.cw("Pageview",ae.ps(["client","url"],"financial-advisors"),ae.ge(1))),54811:ae.q(ae.cw("Pageview",ae.o([ae.os(ae.s,["client","url"],["https://money.usnews.com/financial-advisors/updates/advisor.jsp","https://money.usnews.com/investing/financial-advisors/articles/advisor-weekly","https://money.usnews.com/financial-advisors/articles/behavioral-finance-techniques-advisors-are-using","https://money.usnews.com/financial-advisors/articles/how-financial-advisors-can-build-their-client-base-and-keep-them-engaged","https://money.usnews.com/financial-advisors/articles/advisors-see-planning-for-lgbtq-community-a-growing-niche","https://money.usnews.com/financial-advisors/articles/how-to-become-a-financial-advisor-at-40-as-a-second-career","https://money.usnews.com/financial-advisors/slideshows/financial-advisor-marketing-tips","https://money.usnews.com/financial-advisors/articles/liz-ann-sonders-stock-market-outlook-for-q4-and-2021","https://money.usnews.com/financial-advisors/articles/best-financial-certifications","https://money.usnews.com/financial-advisors/articles/how-to-be-a-successful-financial-advisor-for-your-target-clients","https://money.usnews.com/investing/guide-for-financial-advisors?int=top_nav_Practice_Management_Advice","https://money.usnews.com/investing/financial-advisors/schwab-impact","https://money.usnews.com/financial-advisors/articles/the-future-of-the-financial-advice-industry","https://money.usnews.com/financial-advisors/articles/schwab-independent-advisor-outlook-study-the-future-of-the-ria-industry","https://money.usnews.com/financial-advisors/articles/building-the-next-generation-of-ria-professionals"])]),ae.ge(1))),55532:ae.q(ae.cw("Pageview",ae.ps(["client","url"],"cars.usnews.com"),ae.ge(1))),55605:ae.q(ae.cw("Pageview",ae.o([ae.os(ae.s,["client","url"],["best-colleges/paying-for-college","blogs/student-loan-ranger/articles"])]),ae.ge(1)))}||{},[].map(String)||[]);var ae;let ce={getCurrentTime:()=>new Date,getCurrentSession:()=>"",getCurrentView:()=>"",getSegments:()=>({}),getLookalikeModels:()=>({}),setSegmentActivation:()=>{}};ht()((function(n){switch(n.type){case"bootstrap":return se(n.stateMap,...n.payload);case"updateEnvironment":return le(n.stateMap,...n.payload);case"process":return fe(n.stateMap,...n.payload);case"migrateDirect":return pe(...n.payload);case"migrateViaCache":return me(...n.payload)}}));const se=(n,t,e,r,u)=>{ce={getCurrentTime:()=>new Date,getCurrentSession:()=>r.sessionId,getCurrentView:()=>r.viewId,getSegments:()=>r.segments,getLookalikeModels:()=>r.lookalikeModels,setSegmentActivation:(n,t)=>{}};const i=re(t,(t,e)=>{var r;return(null===(r=n[t])||void 0===r?void 0:r.checksum)===e?sn:ln({checksum:e,state:null,result:ie[t].interpret(null,ce),activations:{}})}),o=fe(i,e,u);return{stateMap:Object.assign(Object.assign({},n),o.stateMap),errors:o.errors}},le=(n,t,e,r=!0)=>{const u=e.segments?ce.getSegments():{};return ce=Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},ce),e.viewId?{getCurrentView:()=>e.viewId}:{}),e.sessionId?{getCurrentSession:()=>e.sessionId}:{}),e.lookalikeModels?{getLookalikeModels:()=>e.lookalikeModels}:{}),e.segments?{getSegments:()=>Object.assign(Object.assign({},u),e.segments),setSegmentActivation:ge(n)}:{}),r?de(n,t,{}):{stateMap:n,errors:[]}},fe=(n,t,e)=>{let r={stateMap:n,errors:[]};const u=e.length;for(let n=0;n<u;n++){const u=e[n],i=de(r.stateMap,t,u);r={stateMap:i.stateMap,errors:r.errors.concat(i.errors)}}return r},de=(n,t,e)=>{const r=F,u=(n=>n.reduce((n,t)=>Object.assign(Object.assign({},n),{[t]:!0}),{}))((n=>Object.entries(n).filter(([n,t])=>{var e;return!0===(null===(e=t.result)||void 0===e?void 0:e.result)}).map(([n,t])=>parseInt(n,10)))(n)),i=le(n,t,{segments:{"1p":u}},!1),o=i.stateMap,a=(n,u)=>{const{is_segment:i,id:o}=u,a=ue(u,["is_segment","id"]),c=ie[n],s=c.lift(e,ce),f=ct(lt(a.state),l(r)),d=ct(lt(s),l(r),n=>ee(f,n)),p=ee(d,t[n]?ct(lt(t[n]),l(r)):r());return Object.assign(Object.assign({},a),{state:st(d),result:c.interpret(st(p),ce)})},c=i.errors,s={},f=Object.entries(o),d=f.length;for(let n=0;n<d;n++){const t=f[n][0],e=f[n][1];let r=e;try{r=a(t,e)}catch(n){c.push(`Failed to interpret query ${t}. Got ${n}`)}s[t]=r}return{stateMap:s,errors:c}},pe=(n,t)=>({stateMap:re(t,(t,e)=>{const r=ie[t],u=s(()=>r.migrate(e.state),n=>String(n)),i=ct(u,l(n=>null));return i&&(null==n?void 0:n[t])===e.checksum?ln(Object.assign(Object.assign({},e),{state:i})):sn}),errors:[]}),me=(n,t,e)=>{const r=(u=n=>oe.includes(n),re(n,(n,t)=>u(n)?ln(t):sn));var u;return se({},r,{},t,e)},ge=n=>(t,e,r)=>{var i;return ct(null===(i=n[r])||void 0===i?void 0:i.activations,n=>u(t in n,n),([n,r])=>r[t]=n?ut(Nt)(r[t],[e]):[e])}}]);',"Worker",void 0,void 0)},o=n(3),u=n(24),c=n.n(u),l=n(7),d=n(11),f=n(14),_=n(2),h=n(16),p=n(6),m=n(13),g=n(0),v=n(4);class b{constructor(t,e){this._internals=t,this.permutive=e,this.CACHED_SEGMENTS_STORAGE_KEY="_psegs",this.queryMetadata={47118:"b46262e3e8",47517:"b4dcd490a7",47518:"25b7e31bb5",47624:"fecbff6708",47626:"48b4dced7a",47661:"85944b51ae",47858:"4e98b7025f",47859:"5a763ff689",47860:"55bb3eb5f8",47861:"0dda08f9d9",54663:"6519e9cafb",54811:"242e9e8a79",55532:"aab67717dc",55605:"81d6ecbf84"},this.isWorkerReady=!1,this.extStateMap={},this.userSegments=[],this.userSegmentsMap={},this.segmentTransitionEdgeOnly="boolean"==typeof{workspaces:[{activations:[],add_alchemy_entities:!1,add_alchemy_taxonomy:!1}],auto_init:!1,add_alchemy_entities:!1,add_alchemy_taxonomy:!1,activationConfigs:[]}.segment_transition_edge_only&&{workspaces:[{activations:[],add_alchemy_entities:!1,add_alchemy_taxonomy:!1}],auto_init:!1,add_alchemy_entities:!1,add_alchemy_taxonomy:!1,activationConfigs:[]}.segment_transition_edge_only,this.segmentEntryQueryCodes=new Set,this.segmentExitQueryCodes=new Set;const n=this._internals.getExternalData(this.CACHED_SEGMENTS_STORAGE_KEY);this.userSegments=(JSON.parse(n)||[]).filter(t=>Object(m.c)(t,this.queryMetadata)),this.userSegmentsMap=Object(m.e)(this.userSegments);const i=this._internals.state.getPermutiveData("internal_query_states")||{},s=this._internals.state.getPermutiveData("external_query_states")||{},o=Object(r.d)(i,t=>{var e;return(null===(e=i[t])||void 0===e?void 0:e.checksum)===this.queryMetadata[t]});this.extStateMap=Object(r.d)(s,t=>Object(m.c)(t,this.queryMetadata)),this._internals.state.setPermutiveData("external_query_states",this.extStateMap),this.stateMap={value:o,promise:Promise.resolve(o)},this.queryWorker=new c.a(new a)}bootstrap(t){return this.migrateIfRequired(t).then(([t,e,n])=>this.postMessage({type:"bootstrap",payload:[this.queryMetadata,this.extStateMap,{segments:Object.assign({"1p":this.userSegmentsMap},e),sessionId:this._internals.sessionManager.getSessionId(),viewId:this._internals.state.viewId,lookalikeModels:n},t]}))}updateEnvironment(t){return this.postMessage({type:"updateEnvironment",payload:[this.extStateMap,t]})}process(t){return this.postMessage({type:"process",payload:[this.extStateMap,t]})}updateExternalState(t){const e=Object(r.j)(t,(t,e)=>{const n=this.queryMetadata[t];return e[n]?Object(g.c)(Object(f.a)(e[n])):g.n}),n=Object(r.j)(this.extStateMap,(t,e)=>Object(g.c)(Object(f.a)(e))),i=Object(r.j)(Object.assign(Object.assign({},n),e),(t,e)=>n[t]?Object(g.o)(Object(f.b)(Object(h.b)(e,n[t]))):Object(g.o)(Object(f.b)(e)));this._internals.state.setPermutiveData("external_query_states",i),this.extStateMap=i}postMessage(t){return this.stateMap.promise=this.stateMap.promise.then(e=>this.queryWorker.postMessage(Object.assign(Object.assign({},t),{stateMap:e}))).then(({stateMap:t,errors:e})=>this.onStateChange(t,e)).catch(t=>(this._internals.network.error("Error during query execution. Got "+t,this._internals.state.userId),this.stateMap.value))}onStateChange(t,e){return Object(p.a)(e.length>0?this._internals.network.error("QL error(s). Got "+e.join("; "),this._internals.state.userId):{},e=>this.stateMap.value=t,t=>this.isWorkerReady?this.onStateChangeReady(t):t)}onStateChangeReady(t){const e=Object(m.d)(t),n=[...Object(l.c)(d.c)(e,this.userSegments).map(e=>[e,!0,t[e].id]),...Object(l.c)(d.c)(this.userSegments,e).map(e=>[e,!1,t[e].id])];return this.userSegments=e,this.userSegmentsMap=Object(m.e)(e),this._internals.log("Writing new segment and query state cache",t),this._internals.setExternalData(this.CACHED_SEGMENTS_STORAGE_KEY,JSON.stringify(this.userSegments)),this._internals.state.setPermutiveData("internal_query_states",t),n.forEach(([t,e,n])=>{this.trackTransition(e,n,t),this._internals.messages.emit("permutive:query:changed",{queryCode:t,result:{result:e}})}),Object(p.a)(n.length>0,t=>t?this._internals.messages.emit("permutive:segments:updated"):{},e=>t)}migrateIfRequired(t){const e=this._internals.state.getPermutiveData("query_states"),n=()=>{const n=this._internals.metrics.startTimer("sdk_direct_state_migration_seconds",{});return this.queryWorker.postMessage({type:"migrateDirect",payload:[this.queryMetadata,Object(r.d)(e,t=>Object(m.c)(t,this.queryMetadata))]}).then(r=>this.onStateMigrateSuccess(e,t,r.stateMap,n)).catch(e=>this.onStateMigrateError(t,e))},i=()=>this._internals.api.migrateOutOfSDKEvents(this._internals.state.userId,t.map(t=>t.id).filter(t=>t)).catch(t=>this._internals.network.error("Error migrating out-of-SDK events. Got "+String(t),this._internals.state.userId));return e?(()=>{const t=this._internals.metrics.startTimer("sdk_overall_state_migration_seconds",{});return Promise.all([this._internals.thirdParty.segments(),this._internals.models.getModels(),n(),i()]).then(([e,n,r,i])=>(this._internals.metrics.stopTimer("sdk_overall_state_migration_seconds",t),Object(v.g)(r,e,n)))})():Promise.resolve([t,{},{}])}onStateMigrateSuccess(t,e,n,i){this._internals.metrics.stopTimer("sdk_direct_state_migration_seconds",i),this._internals.log("Beginning migration. Migrated query state is",n),this._internals.metrics.track({name:"sdk_success_migration_count",value:1,labels:{}});const s=Object(m.a)(e,100);return(n=>{const i=this._internals.metrics.startTimer("sdk_cache_replay_migration_seconds",{});return this.queryWorker.postMessage({type:"migrateViaCache",payload:[this.queryMetadata,{segments:{"1p":this.userSegmentsMap},sessionId:this._internals.sessionManager.getSessionId(),viewId:this._internals.state.viewId,lookalikeModels:{}},s]}).then(s=>{this._internals.metrics.stopTimer("sdk_cache_replay_migration_seconds",i);const a=s.stateMap;this._internals.log("Recreated state via events cache. Got",a);const u=t=>Object(p.a)(Object(r.j)(t,(t,e)=>Object(g.d)(e.state)),f.a,Object(o.j)(t=>(this._internals.network.error("Failed to decode state. Got "+t,this._internals.state.userId),Object(_.l)(new Map)))),c=u(a),l=u(n),d=Object(p.a)(Object(o.t)(()=>Object(h.b)(l,c),t=>"Failed to join migrated state and state recreated via the events cache. Got "+t),Object(o.j)(t=>Object(p.a)(this._internals.network.error(t,this._internals.state.userId),()=>l)),t=>Object(f.b)(t)),v=Object.entries(t).filter(([t,e])=>Object(m.c)(t,this.queryMetadata)).map(([t,e])=>[t,Object.assign(Object.assign({},e),{state:null})]),b=Object(r.m)(...v);this.stateMap.value=b,this.stateMap.promise=Promise.resolve(this.stateMap.value),this._internals.log("Sending full picture of legacy state to state/legacy/ ",d),this._internals.log("Purging events cache. Current cache is ",e);const y=Object(r.j)(this.queryMetadata,(t,e)=>(null==d?void 0:d[t])?Object(g.o)({[e]:d[t]}):g.n);return Promise.all([this._internals.api.state(y,0,!1,!1,!0),this._internals.state.eventsCache.reset()]).then(n=>{const r=this.filterCacheAndFlush(e);this._internals.log("Purged cache. New cache is ",r),this._internals.state.setPermutiveData("query_states",null);const i=d?Object(o.t)(()=>this.updateExternalState(y),t=>String(t)):Object(o.r)(null);return Object(o.m)(i)?Object(p.a)(i.left,e=>this._internals.network.error(`\n                    Failed to store migrated state.\n                    Old state was ${JSON.stringify(t)}.\n                    New state was ${JSON.stringify(d)}.\n                    Error was ${e}\n                  `,this._internals.state.userId),t=>this._internals.log("Migration failed. Check network tab"),t=>r):Object(p.a)(this._internals.log("Migration completed successfully"),t=>[])})})})(n).catch(t=>this.onStateMigrateError(e,t))}onStateMigrateError(t,e){return this._internals.log("Migration failed. Check network tab"),this._internals.network.error("Exception during migration process. Got "+e,this._internals.state.userId),this._internals.metrics.track({name:"sdk_failed_migration_count",value:1,labels:{}}),this._internals.state.eventsCache.reset().then(e=>Object(p.a)(this._internals.state.setPermutiveData("query_states",null),e=>this.filterCacheAndFlush(t)))}filterCacheAndFlush(t){const e=Object(m.b)(t,"web",window.location.hostname),n=e.length;return e.forEach((t,e)=>this._internals.state.eventsCache.add(t,{persistOnDisk:e===n-1})),e}trackTransition(t,e,n){const r=Object.assign({segment_id:e,segment_number:n},{});t?this.segmentEntryQueryCodes.add(n):this.segmentExitQueryCodes.add(n),this.permutive.track(t?"SegmentEntry":"SegmentExit",r,{isMemoryOnly:this.segmentTransitionEdgeOnly})}reset(){this._internals.removeExternalData(this.CACHED_SEGMENTS_STORAGE_KEY),this._internals.state.setPermutiveData("internal_query_states",{}),this._internals.state.setPermutiveData("external_query_states",{}),this.userSegments=[],this.userSegmentsMap={},this.stateMap={value:{},promise:Promise.resolve({})},this.extStateMap={}}setAsReady(){this.isWorkerReady=!0,this.onStateChangeReady(this.stateMap.value),this._internals.messages.emit("permutive:queries:initialised")}getStateSizeInBytes(){return 2*JSON.stringify(this.stateMap.value).length}}},function(t,e,n){"use strict";n.d(e,"a",(function(){return u}));var r=n(5);class i{constructor(t,e){this.userId=t,this.aliases=e,this.resource="userTPD",this.query=()=>{const t=this.aliases.map(({id:t,tag:e,priority:n})=>`{id: "${t}", tag: "${e}", priority: ${n}}`).join(",");return`\n      userTPD: user(user_id: "${this.userId}") {\n        identity(aliases: [${t}]) {\n          tpd {\n            name\n            segments\n          }\n        }\n      }\n    `}}}var s=n(11),a=function(t,e){var n={};for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&e.indexOf(r)<0&&(n[r]=t[r]);if(null!=t&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(t);i<r.length;i++)e.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(t,r[i])&&(n[r[i]]=t[r[i]])}return n};const o={permutive:"1",eyeota:"2",skimlinks:"4",comscore:"5",eyeota_bombora:"6",eyeota_aimmatic:"7",eyeota_alc:"8",eyeota_amberdata:"9",eyeota_caci:"10",eyeota_corelogic:"11",eyeota_dlg:"12",eyeota_dataxpand:"13",eyeota_dunbradstreet:"14",eyeota_experian:"15",eyeota_gbgtransactis:"16",eyeota_gfk:"17",eyeota_rdaresearch:"18",eyeota_kantarmedia:"19",eyeota_mastercard:"20",eyeota_meritdirect:"21",eyeota_netsprint:"22",eyeota_nri:"23",eyeota_onaudience:"24",eyeota_pacificdatapartners:"25",eyeota_plungedigital:"26",eyeota_roymorgan:"27",eyeota_schober:"28",eyeota_sharethis:"30",eyeota_skimlinks:"31",eyeota_specialists:"32",eyeota_statsocial:"33",eyeota_stirista:"34",eyeota_yougov:"36"};class u{constructor(t,e,n){this._internals=t,this.permutive=e,this.network=n,this._internals.log("Enabling tpd reporting"),this._internals.messages.on("permutive:segments:updated",()=>{this.reportUsage()});const r=this._internals.state.getPermutiveData("third-party-data");this.userSegments=this.isValidState(r)?r:{},this.lastCheckedSession=this._internals.state.getPermutiveData("third-party-data-session-id")||""}segments(){if(this.segmentsPromise)return this.segmentsPromise;const t=this._internals.sessionManager.getSessionId();if(this.lastCheckedSession===t)return Promise.resolve(this.userSegments);const e=Object(r.b)();this.lastCheckedSession=t;const n=this._internals.metrics.startTimer("sdk_get_third_party_data_task_duration_seconds",{}),a=Object.assign(Object.assign({},this._internals.identities.getIdentities(!0)),this._internals.identities.aliases);if(Object.keys(a).length>0){const t=new i(this._internals.state.userId||Object(r.o)(),this._internals.identities.aliasMapToPrioritizedList(a));this._internals.graphql.register(t).then(t=>{const n=this.graphQLTPDResponseToSegmentMap(t);this.updateCache(n),e.resolve(n)}).catch(t=>{this.network.error("Third Party Data segments retrieval failed with reason: "+t,this._internals.state.userId),e.resolve({})})}else e.resolve({});const o=this._internals.promises.getPromisesByCategory("tpd"),u=Promise.all(o.map(t=>t.promise)).then(t=>e.promise).then(t=>this.userSegments);return u.then(e=>{this._internals.state.setPermutiveData("third-party-data-session-id",t),this._internals.metrics.stopTimer("sdk_get_third_party_data_task_duration_seconds",n);const i=this._internals.state.getPermutiveData("third-party-data");i&&Object(r.c)(Object(r.c)(s.b)).equals(i,e)||(this._internals.state.setPermutiveData("third-party-data",this.userSegments),Object.entries(e||{}).forEach(([t,e])=>{i&&Object(r.c)(s.b).equals(i[t],e)||this.fireSegments(t,Object.keys(e))}))}),this.segmentsPromise=u,this.segmentsPromise}addSegments(t,e){this.updateCache({[t]:this.listToSegmentMap(e)})}getActivationMetadata(){const t=this.tpdUsage(this._internals.queryManager.stateMap.value),e={};for(const n in t)if(t.hasOwnProperty(n)){const r=[],i=Object.assign({},t[n]);Object.keys(i).forEach(t=>{i[t].forEach(e=>{r.push([n,o[t],e].join("-"))})}),e[n]=r}return e}updateCache(t){this.userSegments=Object(r.k)(this.userSegments,t)}fireSegments(t,e){this.permutive.track("ThirdPartySegments",{data_provider:t,segments:e},{isAnalyticsOnly:!0})}reportUsage(){const t=this.tpdUsage(this._internals.queryManager.stateMap.value),e=Object(r.f)(JSON.stringify(t));if(this._internals.state.getPermutiveData("third-party-data-usage")!==e&&Object.keys(t).length>0){this._internals.state.setPermutiveData("third-party-data-usage",e);const n={user_id:this._internals.state.userId,time:new Date,tpd_segments:t};this._internals.api.tpdUsage(n)}}graphQLTPDResponseToSegmentMap(t){return t.identity.tpd.reduce((t,e)=>Object.assign(Object.assign({},t),{[e.name]:this.listToSegmentMap(e.segments)}),{})}listToSegmentMap(t){return t.reduce((t,e)=>(t[e]=!0,t),{})}isValidState(t){return void 0===(null==t?void 0:t.expiry_time)}tpdUsage(t){const e={},n=Object.keys(t),r=n.length;for(let i=0;i<r;i++){const r=n[i],s=t[r],{activations:o}=s;a(s,["activations"]);Object.keys(o).length>0&&(e[r]=o)}return e}}},function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,"canRun",(function(){return canRun})),__webpack_require__.d(__webpack_exports__,"getTag",(function(){return getTag})),__webpack_require__.d(__webpack_exports__,"makeConfig",(function(){return makeConfig})),__webpack_require__.d(__webpack_exports__,"hasConsent",(function(){return hasConsent}));var _http_PermutiveNetwork__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(20),_core_state_PermutiveState__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(28),_utils_PermutiveUtils__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__(5),_core_identity_PermutiveIdentities__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__(15),_core_internals_PermutiveInternals__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__(29),_core_metrics_PermutiveMetrics__WEBPACK_IMPORTED_MODULE_5__=__webpack_require__(17),_PermutiveMethods__WEBPACK_IMPORTED_MODULE_6__=__webpack_require__(30),_http_graphql_GraphQLIdentify__WEBPACK_IMPORTED_MODULE_7__=__webpack_require__(21),_Config__WEBPACK_IMPORTED_MODULE_8__=__webpack_require__(22),_core_queries_QueryManager__WEBPACK_IMPORTED_MODULE_9__=__webpack_require__(31),fp_ts_es6_Option__WEBPACK_IMPORTED_MODULE_10__=__webpack_require__(0),fp_ts_es6_Either__WEBPACK_IMPORTED_MODULE_11__=__webpack_require__(3),fp_ts_es6_Apply__WEBPACK_IMPORTED_MODULE_12__=__webpack_require__(27),fp_ts_es6_pipeable__WEBPACK_IMPORTED_MODULE_13__=__webpack_require__(6),fp_ts_es6_Array__WEBPACK_IMPORTED_MODULE_14__=__webpack_require__(7),fp_ts_es6_Eq__WEBPACK_IMPORTED_MODULE_15__=__webpack_require__(11),fp_ts_es6_TaskEither__WEBPACK_IMPORTED_MODULE_16__=__webpack_require__(9),fp_ts_es6_Task__WEBPACK_IMPORTED_MODULE_17__=__webpack_require__(10),fp_ts_es6_function__WEBPACK_IMPORTED_MODULE_18__=__webpack_require__(4),_core_third_party_PermutiveThirdParty__WEBPACK_IMPORTED_MODULE_19__=__webpack_require__(32),_core_state_PermutiveStateSync__WEBPACK_IMPORTED_MODULE_20__=__webpack_require__(25),_http_graphql_GraphQLOutOfSDKEvents__WEBPACK_IMPORTED_MODULE_21__=__webpack_require__(26);const sdkInitTimestamp=window.performance.now(),canRun=t=>{const e="function"==typeof t.Map?Object(fp_ts_es6_Either__WEBPACK_IMPORTED_MODULE_11__.r)(new t.Map([["a",1]])):Object(fp_ts_es6_Either__WEBPACK_IMPORTED_MODULE_11__.o)("Maps not supported"),n="function"==typeof t.Set?Object(fp_ts_es6_Either__WEBPACK_IMPORTED_MODULE_11__.r)(new t.Set([1,2])):Object(fp_ts_es6_Either__WEBPACK_IMPORTED_MODULE_11__.o)("Sets not supported"),r=Object(fp_ts_es6_Either__WEBPACK_IMPORTED_MODULE_11__.d)(t=>1===t.size?Object(fp_ts_es6_Either__WEBPACK_IMPORTED_MODULE_11__.r)(null):Object(fp_ts_es6_Either__WEBPACK_IMPORTED_MODULE_11__.o)("Iterable Maps not supported"))(e),i=Object(fp_ts_es6_Either__WEBPACK_IMPORTED_MODULE_11__.d)(t=>2===t.size?Object(fp_ts_es6_Either__WEBPACK_IMPORTED_MODULE_11__.r)(null):Object(fp_ts_es6_Either__WEBPACK_IMPORTED_MODULE_11__.o)("Iterable Sets not supported"))(n),s=t.Worker&&t.Blob?Object(fp_ts_es6_Either__WEBPACK_IMPORTED_MODULE_11__.r)(null):Object(fp_ts_es6_Either__WEBPACK_IMPORTED_MODULE_11__.o)("WebWorkers not supported"),a=["QuotaExceededError","QUOTA_EXCEEDED_ERR","NS_ERROR_DOM_QUOTA_REACHED"],o=Object(fp_ts_es6_Either__WEBPACK_IMPORTED_MODULE_11__.t)(()=>{t.localStorage.setItem("_permutive_ls_test","_permutive_ls_test"),t.localStorage.removeItem("_permutive_ls_test")},e=>t.localStorage&&0===t.localStorage.remainingSpace||a.some(t=>-1!==String(e).indexOf(t))?"localStorage quota exceeded":"localStorage not supported");return Object(fp_ts_es6_pipeable__WEBPACK_IMPORTED_MODULE_13__.a)(Object(fp_ts_es6_Apply__WEBPACK_IMPORTED_MODULE_12__.a)(fp_ts_es6_Either__WEBPACK_IMPORTED_MODULE_11__.e)(r,i,o,s),e=>Object(fp_ts_es6_TaskEither__WEBPACK_IMPORTED_MODULE_16__.f)(e=>t)(Object(fp_ts_es6_TaskEither__WEBPACK_IMPORTED_MODULE_16__.b)(e)))},getTag=t=>Object(fp_ts_es6_pipeable__WEBPACK_IMPORTED_MODULE_13__.a)(Object(fp_ts_es6_Either__WEBPACK_IMPORTED_MODULE_11__.g)("Can't find permutive tag on the page")(t.permutive),fp_ts_es6_TaskEither__WEBPACK_IMPORTED_MODULE_16__.b),makeConfig=t=>Object(fp_ts_es6_TaskEither__WEBPACK_IMPORTED_MODULE_16__.g)(Object.assign(Object.assign({},t),{config:Object(_Config__WEBPACK_IMPORTED_MODULE_8__.a)(t.config)})),makeNetwork=t=>Object(fp_ts_es6_TaskEither__WEBPACK_IMPORTED_MODULE_16__.g)([t,new _http_PermutiveNetwork__WEBPACK_IMPORTED_MODULE_0__.a(t.config)]),validateConsentThenCache=t=>"object"==typeof t&&Object(fp_ts_es6_pipeable__WEBPACK_IMPORTED_MODULE_13__.a)(window.localStorage.setItem("permutive-consent",JSON.stringify(t)),e=>{var n;return t.opt_in&&(null===(n=t.token)||void 0===n?void 0:n.length)>0}),consentThenInit=t=>e=>Object(fp_ts_es6_pipeable__WEBPACK_IMPORTED_MODULE_13__.a)(validateConsentThenCache(e),e=>e?init(t)():null),hasConsent=t=>{const[e,n]=t;window.permutive.consent=consentThenInit(t);const r=Object(fp_ts_es6_Array__WEBPACK_IMPORTED_MODULE_14__.f)(fp_ts_es6_Eq__WEBPACK_IMPORTED_MODULE_15__.d)("6c3e19e3-d05e-45d1-8f79-fcd6cb2f3a21",["fe68d1f7-c9f4-45b3-8905-7cda73d3fd74"]),i=Object(fp_ts_es6_TaskEither__WEBPACK_IMPORTED_MODULE_16__.d)(t=>Object(fp_ts_es6_TaskEither__WEBPACK_IMPORTED_MODULE_16__.d)(t=>Object(fp_ts_es6_TaskEither__WEBPACK_IMPORTED_MODULE_16__.d)(t=>Object(fp_ts_es6_Task__WEBPACK_IMPORTED_MODULE_17__.h)(!1))(r?Object(fp_ts_es6_TaskEither__WEBPACK_IMPORTED_MODULE_16__.h)(()=>n.req({url:n.getEndpointUrl("/geoip"),method:"GET"},!1).then(t=>"Israel"===Object(_utils_PermutiveUtils__WEBPACK_IMPORTED_MODULE_2__.i)(t,"geo_info","country")&&validateConsentThenCache({opt_in:!0,token:"whitelisted-geo"})),t=>n.error("Failed to retrieve geo location information required for consent. Got "+t)):Object(fp_ts_es6_TaskEither__WEBPACK_IMPORTED_MODULE_16__.g)(!e.config.consentRequired)))(Object(fp_ts_es6_TaskEither__WEBPACK_IMPORTED_MODULE_16__.c)(fp_ts_es6_function__WEBPACK_IMPORTED_MODULE_18__.c)((()=>{const t=JSON.parse(window.localStorage.getItem("permutive-consent"));return t?Object(fp_ts_es6_Option__WEBPACK_IMPORTED_MODULE_10__.o)(validateConsentThenCache(t)):fp_ts_es6_Option__WEBPACK_IMPORTED_MODULE_10__.n})())))(Object(fp_ts_es6_TaskEither__WEBPACK_IMPORTED_MODULE_16__.c)(fp_ts_es6_function__WEBPACK_IMPORTED_MODULE_18__.c)((()=>{const t=Object(fp_ts_es6_Array__WEBPACK_IMPORTED_MODULE_14__.g)((function(t){return"consent"===t.functionName}))(e.q);return Object(fp_ts_es6_Option__WEBPACK_IMPORTED_MODULE_10__.m)(t=>validateConsentThenCache(t.arguments[0]))(t)})()));return Object(fp_ts_es6_Task__WEBPACK_IMPORTED_MODULE_17__.g)(t=>t?Object(fp_ts_es6_Either__WEBPACK_IMPORTED_MODULE_11__.r)(Object(fp_ts_es6_function__WEBPACK_IMPORTED_MODULE_18__.g)(e,n)):Object(fp_ts_es6_Either__WEBPACK_IMPORTED_MODULE_11__.o)("No consent to run on the page"))(i)},init=tagAndNetwork=>Object(fp_ts_es6_TaskEither__WEBPACK_IMPORTED_MODULE_16__.h)(()=>{window.permutive.consent=validateConsentThenCache;const[tag,network]=tagAndNetwork,context=Object(_utils_PermutiveUtils__WEBPACK_IMPORTED_MODULE_2__.k)(tag.context||{},{path:window.location.pathname,url:window.location.href,referrer:document.referrer}),_internals=new _core_internals_PermutiveInternals__WEBPACK_IMPORTED_MODULE_4__.a(tag.config,network),permutiveMethods=new _PermutiveMethods__WEBPACK_IMPORTED_MODULE_6__.a(_internals,network,context);_internals.state=new _core_state_PermutiveState__WEBPACK_IMPORTED_MODULE_1__.a(_internals,permutiveMethods,context),_internals.stateSync=new _core_state_PermutiveStateSync__WEBPACK_IMPORTED_MODULE_20__.a(_internals),_internals.queryManager=new _core_queries_QueryManager__WEBPACK_IMPORTED_MODULE_9__.a(_internals,permutiveMethods),_internals.thirdParty=new _core_third_party_PermutiveThirdParty__WEBPACK_IMPORTED_MODULE_19__.a(_internals,permutiveMethods,network),_internals.identities=new _core_identity_PermutiveIdentities__WEBPACK_IMPORTED_MODULE_3__.a(_internals,permutiveMethods,network);const isMetricsUser=_internals.state.getPermutiveData("metricsEnabled");_internals.metrics=!0===isMetricsUser?new _core_metrics_PermutiveMetrics__WEBPACK_IMPORTED_MODULE_5__.a(sdkInitTimestamp,_internals,permutiveMethods):!1===isMetricsUser?new _core_metrics_PermutiveMetrics__WEBPACK_IMPORTED_MODULE_5__.b:Object(fp_ts_es6_pipeable__WEBPACK_IMPORTED_MODULE_13__.a)(Math.random()<=_internals.config.metricsSamplingPercentage/100,t=>[_internals.state.setPermutiveData("metricsEnabled",t),t],([t,e])=>e?new _core_metrics_PermutiveMetrics__WEBPACK_IMPORTED_MODULE_5__.a(sdkInitTimestamp,_internals,permutiveMethods):new _core_metrics_PermutiveMetrics__WEBPACK_IMPORTED_MODULE_5__.b);const permutiveShell=Object(_utils_PermutiveUtils__WEBPACK_IMPORTED_MODULE_2__.k)(tag,{consent:window.permutive.consent},{q:window.permutive.q},{context:context},{addons:_internals.addons});[].forEach(s=>{try{eval(s)}catch(t){network.error(Object.assign(Object.assign({},t),{message:"Error running custom script "+s}),_internals.state.userId)}}),_internals.addBlocker("permutive:queries:initialised"),_internals.messages.on("permutive:blockers:empty",()=>{const t=Object(_utils_PermutiveUtils__WEBPACK_IMPORTED_MODULE_2__.k)(permutiveShell,{identify:permutiveMethods.identify.bind(permutiveMethods),on:permutiveMethods.on.bind(permutiveMethods),once:permutiveMethods.once.bind(permutiveMethods),track:permutiveMethods.track.bind(permutiveMethods),trigger:permutiveMethods.trigger.bind(permutiveMethods),query:permutiveMethods.query.bind(permutiveMethods),segment:permutiveMethods.segment.bind(permutiveMethods),segments:permutiveMethods.segments.bind(permutiveMethods),reset:permutiveMethods.reset.bind(permutiveMethods),ready:permutiveMethods.ready.bind(permutiveMethods),addon:permutiveMethods.addon.bind(permutiveMethods)});window.permutive=Object.assign(Object.assign({},t),{q:[]}),_internals.setAsReady();const e=["identify","trigger","addon","track"];permutiveShell.q.filter(t=>"consent"!==t.functionName).sort((t,n)=>{const r=e.indexOf(t.functionName),i=e.indexOf(n.functionName);return-1===r?-1===i?0:1:-1===i?-1:r-i}).forEach(e=>{e.functionName in t?t[e.functionName].apply(permutiveMethods,e.arguments):network.error(`Function "permutive.${e.functionName}" does not exist.`,_internals.state.userId)})});const loadAddon=t=>t.load(permutiveShell.q,permutiveMethods,_internals,network),addons=[Promise.resolve().then(__webpack_require__.bind(null,34)),Promise.resolve().then(__webpack_require__.bind(null,35)),Promise.resolve().then(__webpack_require__.bind(null,36)),Promise.resolve().then(__webpack_require__.bind(null,37))];addons.forEach(t=>t.then(loadAddon));const registerEnricher=t=>t.register(_internals,permutiveShell.context,permutiveShell.config),enrichers=[Promise.resolve().then(__webpack_require__.bind(null,38))];enrichers.forEach(t=>t.then(registerEnricher));const registerModule=t=>t.register(_internals,permutiveShell.context,permutiveShell.config),stdSegmentModules=[];stdSegmentModules.forEach(t=>t.then(registerModule));const aliasesMap=_internals.identities.aliases,graphQLIdentify=()=>{const t=Object(_utils_PermutiveUtils__WEBPACK_IMPORTED_MODULE_2__.b)(),e=()=>permutiveShell.q.findIndex(t=>"identify"===t.functionName);let n=e();for(;n>-1;){const t=permutiveShell.q.splice(n,1)[0];_internals.identities.getAliasesFromIdentifyArg(t.arguments[0]).forEach(t=>_internals.identities.setAlias(t.id,t.tag)),n=e()}const r=_internals.state.userId,i=new _http_graphql_GraphQLIdentify__WEBPACK_IMPORTED_MODULE_7__.a(r,_internals.identities.aliasMapToPrioritizedList(aliasesMap));return _internals.graphql.register(i).then(e=>(e=>{const n=_internals.identities.aliases,i=e.user_id;i!==r?(_internals.log("Got different user id from API: "+i),_internals.state.reset().then(t=>Object(fp_ts_es6_pipeable__WEBPACK_IMPORTED_MODULE_13__.a)(_internals.state.setUserId(i),t=>Object.entries(n).forEach(([t,e])=>_internals.identities.setAlias(e,t)),t=>_internals.state.eventsCache.reset())).then(e=>t.resolve({identityChanged:!0,userId:i}))):t.resolve({identityChanged:!1})})({user_id:e.identity.identify.id})).catch(e=>{network.error(`Couldn't set identity for user ${r}. Got ${e}`,r),t.resolve({identityChanged:!1})}),_internals.log("Starting identification... Current aliases are:",aliasesMap),t.promise.then(t=>{_internals.messages.emit("permutive:user:ready"),_internals.log("<done> init identity ",t)}),t.promise},onIdentityChanged=()=>(_internals.log("Identity has changed"),_internals.stateSync.resetSync()),onIdentityRemained=t=>(_internals.log("Identity hasn't changed, got these unseen out-of-SDK events",t),_internals.state.eventsCache.loadFromDisk().then(e=>{_internals.log("Loaded local event cache",e);const n=_internals.state.eventsCache.processUnseenEvents(t);return _internals.queryManager.bootstrap(e).then(()=>_internals.queryManager.process(n))})),resetOrDoNothing=()=>Object(_core_identity_PermutiveIdentities__WEBPACK_IMPORTED_MODULE_3__.b)("6c3e19e3-d05e-45d1-8f79-fcd6cb2f3a21",_internals.identities.aliasMapToPrioritizedList(aliasesMap).map(t=>t.id),window.location.hostname,_internals.state.userId)?permutiveMethods.reset():Promise.resolve();return resetOrDoNothing().then(()=>_internals.identities.prepareThirdPartyIdentities()).then(t=>{_internals.thirdParty.segments();const e=graphQLIdentify(),n=_internals.graphql.register(new _http_graphql_GraphQLOutOfSDKEvents__WEBPACK_IMPORTED_MODULE_21__.a(_internals.state.userId));return _internals.graphql.run(),Promise.all([e,n]).catch(t=>[{identityChanged:!1},{out_of_sdk_events:[]}]).then(([t,e])=>t.identityChanged?onIdentityChanged():onIdentityRemained(e.out_of_sdk_events))}).then(()=>(permutiveShell.context.user_id=_internals.state.userId,Promise.all([_internals.thirdParty.segments(),_internals.models.getModels()]).then(([t,e])=>(_internals.log("Loaded TPD segments and lookalike models",t,e),_internals.queryManager.updateEnvironment({segments:Object(_utils_PermutiveUtils__WEBPACK_IMPORTED_MODULE_2__.k)({"1p":_internals.queryManager.userSegmentsMap},t),lookalikeModels:e}))))).then(()=>{_internals.queryManager.setAsReady(),_internals.messages.emit("permutive:api:ready"),_internals.metrics.track({name:"sdk_local_storage_byte_total",value:_internals.state.getStateSizeInBytes(),labels:{}}),_internals.metrics.track({name:"sdk_query_states_byte_total",value:_internals.queryManager.getStateSizeInBytes(),labels:{}})})},t=>"Exception during initialisation. Got "+t),initialisationSequence=Object(fp_ts_es6_pipeable__WEBPACK_IMPORTED_MODULE_13__.a)(Object(fp_ts_es6_TaskEither__WEBPACK_IMPORTED_MODULE_16__.g)(window),Object(fp_ts_es6_TaskEither__WEBPACK_IMPORTED_MODULE_16__.a)(canRun),Object(fp_ts_es6_TaskEither__WEBPACK_IMPORTED_MODULE_16__.a)(getTag),Object(fp_ts_es6_TaskEither__WEBPACK_IMPORTED_MODULE_16__.a)(makeConfig),Object(fp_ts_es6_TaskEither__WEBPACK_IMPORTED_MODULE_16__.a)(makeNetwork),Object(fp_ts_es6_TaskEither__WEBPACK_IMPORTED_MODULE_16__.a)(hasConsent),Object(fp_ts_es6_TaskEither__WEBPACK_IMPORTED_MODULE_16__.a)(init));initialisationSequence().then(Object(fp_ts_es6_Either__WEBPACK_IMPORTED_MODULE_11__.f)(t=>console.warn("Permutive was not initialized. "+t),fp_ts_es6_function__WEBPACK_IMPORTED_MODULE_18__.c))},function(t,e,n){"use strict";n.r(e),n.d(e,"load",(function(){return o})),n.d(e,"DFPAddon",(function(){return u}));var r=n(5),i=n(7),s=n(11);const a={},o=(t,e,n)=>{t.push({functionName:"addon",arguments:["dfp",{}]}),window.googletag=window.googletag||{},window.googletag.cmd=window.googletag.cmd||[],window.googletag.cmd.push((function(){e.ready(n.makeSafe(()=>{let t=0;googletag.pubads&&googletag.pubads().getSlots&&googletag.pubads().getSlots().length>0&&googletag.pubads().getSlots().forEach((function(e){e.getResponseInformation()&&t++}));const e=0===t?"sdk_targeting_realtime_success_count":"sdk_targeting_realtime_fail_count";n.metrics.track({name:e,value:1,labels:{target:"dfp"}})}),"realtime");const t=function(){const t=n.getExternalData("_pdfps");return t?JSON.parse(t):[]}();googletag.cmd.push((function(){googletag.pubads().setTargeting("permutive",t.map(String))}));const i=function(t){const e={ad_unit_path:t.getAdUnitPath(),slot_element_id:t.getSlotElementId()};return e},s=function(t){try{let n=!1;window.addEventListener("blur",(function(){if(n){const n=a[t];n&&e.track("SlotClicked",n)}})),document.getElementById(t).addEventListener("mouseover",(function(){n=!0})),document.getElementById(t).addEventListener("mouseout",(function(){n=!1}))}catch(t){}};googletag.pubads&&googletag.pubads().getSlots&&googletag.pubads().getSlots().forEach((function(t){const e=t.getResponseInformation();if(e){const n=t.getSlotElementId(),o={advertiser_id:Object(r.l)(e.advertiserId),campaign_id:Object(r.l)(e.campaignId),line_item_id:Object(r.l)(e.lineItemId),creative_id:Object(r.l)(e.creativeId),is_empty:!1,service_name:"publisher_ads",slot:i(t)};a[n]=o,s(n)}})),googletag.cmd.push((function(){googletag.pubads().addEventListener("slotRenderEnded",(function(t){const e=t,n=e.slot.getSlotElementId(),o={advertiser_id:Object(r.l)(e.advertiserId),campaign_id:Object(r.l)(e.campaignId),line_item_id:Object(r.l)(e.lineItemId),creative_id:Object(r.l)(e.creativeId),is_empty:e.isEmpty,service_name:e.serviceName,slot:i(t.slot)};if(e.size){const[t,n,...r]=e.size;"number"==typeof t&&"number"==typeof n&&(o.width=t,o.height=n)}a[n]=o,s(n)})),googletag.pubads().addEventListener("impressionViewable",(function(t){const n=t.slot.getResponseInformation();n&&e.track("SlotViewable",{advertiser_id:Object(r.l)(n.advertiserId),campaign_id:Object(r.l)(n.campaignId),line_item_id:Object(r.l)(n.lineItemId),creative_id:Object(r.l)(n.creativeId),service_name:t.serviceName,slot:i(t.slot)})}))})),window.addEventListener("message",(function(t){try{const n=JSON.parse(t.data);if(n.permutive_type&&"google_ad_click"===n.permutive_type){const t=n.data.ad_unit_path,i=Object(r.l)(n.data.creative_id);let s=void 0;Object.keys(a).forEach(e=>{void 0!==a[e].slot&&a[e].slot.ad_unit_path===t&&a[e].creative_id===i&&(s=a[e])}),s=s||{line_item_id:Object(r.l)(n.data.line_item_id),advertiser_id:Object(r.l)(n.data.advertiser_id),campaign_id:Object(r.l)(n.data.order_id),creative_id:Object(r.l)(i),is_empty:!1},e.track("SlotClicked",s)}}catch(t){}}),!1)}))};class u{constructor(t){this.trackedTargetingLimitMetric=!1,this._internals=t._internals;const e=this._internals.getExternalData("_pdfps"),n=this._internals.getExternalData("_pcrdbs");this.liveSegments=e?JSON.parse(e):[],this.cleanRoomSegments=n?JSON.parse(n):[],this.eligibleSegments={};const r=this._internals.state.activationManager.getSpecializedActivations("dfp");for(let t=0;t<r.dfp.length;t++){const e=r.dfp[t];this.eligibleSegments[e]=e}for(const t in r.dfp_legacy)if(r.dfp_legacy.hasOwnProperty(t)){const e=r.dfp_legacy[t];this.eligibleSegments[t]=e}const i=this._internals.queryManager.userSegments;this.updateSegments(this.filterSegments(i)),this._internals.messages.emit("permutive:dfp:ready"),this._internals.messages.on("permutive:segments:updated",this._internals.makeSafe(()=>{const t=this._internals.queryManager.userSegments;this.updateIfNecessary(t)})),this._internals.messages.on("permutive:cleanroom:db:updated",t=>{this.cleanRoomSegments=t,this.updateWithCurrent()}),this._internals.messages.on("permutive:reset",this._internals.makeSafe(()=>{this._internals.removeExternalData("_pdfps"),this._internals.deleteCookie("_pdfps"),this.liveSegments=[]}))}updateIfNecessary(t){const e=this.filterSegments(t);this._internals.arraysEqual(e,this.liveSegments)||this.updateSegments(e)}updateWithCurrent(){this.updateSegments(this.liveSegments)}updateSegments(t){const e=Object(i.f)(s.d)("6c3e19e3-d05e-45d1-8f79-fcd6cb2f3a21",["5d79bce7-5d2b-427e-a6c4-b89b6c7bf048","99db7a95-b06a-4ea9-857c-f73ba0a25c19","f5b3be27-f789-4ef1-8867-37c67da5b361","3aba5292-ba75-422b-8715-bd21146f7836","bd1cec50-00d1-4ce9-9572-785857419a1e"])?this.processActivations(this._internals.thirdParty.getActivationMetadata()):[];let n=t.concat(e).concat(this.cleanRoomSegments);encodeURIComponent(JSON.stringify(n)).length>1500&&(n=t,this.trackedTargetingLimitMetric||(this._internals.metrics.track({name:"sdk_targeting_size_limit_exceeded_count",value:1,labels:{target:"dfp"}}),this.trackedTargetingLimitMetric=!0)),window.googletag=window.googletag||{},window.googletag.cmd=window.googletag.cmd||[],window.googletag.cmd.push(()=>googletag.pubads().setTargeting("permutive",n.map(String).concat(["rts"])));const r=JSON.stringify(n.map(String));this._internals.setExternalData("_pdfps",r),"boolean"==typeof{workspaces:[{activations:[],networks:[{name:"Default",network_code:"4020"}],track_slot_clicked:!0,track_slot_rendered:!1,track_slot_viewable:!0,track_targeting_keys:!1}],auto_init:!0,networks:[{name:"Default",network_code:"4020"}],track_slot_clicked:!0,track_slot_rendered:!1,track_slot_viewable:!0,track_targeting_keys:!1,activationConfigs:[]}.sync_segments_cookie&&{workspaces:[{activations:[],networks:[{name:"Default",network_code:"4020"}],track_slot_clicked:!0,track_slot_rendered:!1,track_slot_viewable:!0,track_targeting_keys:!1}],auto_init:!0,networks:[{name:"Default",network_code:"4020"}],track_slot_clicked:!0,track_slot_rendered:!1,track_slot_viewable:!0,track_targeting_keys:!1,activationConfigs:[]}.sync_segments_cookie&&this._internals.api.segmentSync("_pdfps",r),this.liveSegments=t}filterSegments(t){return t.filter(t=>t in this.eligibleSegments).map(t=>this.eligibleSegments[t])}processActivations(t){const e=[];for(const n in t)if(t.hasOwnProperty(n)&&n in this.eligibleSegments)for(let r=0;r<t[n].length;r++)e.push(t[n][r]);return e}}},function(t,e,n){"use strict";n.r(e),n.d(e,"load",(function(){return r})),n.d(e,"OverlaysAddon",(function(){return i}));const r=(t,e,n)=>{t.unshift({functionName:"addon",arguments:["overlays",{}]})};class i{constructor(t){const e=this;this.permutive=t.permutive,this._internals=t._internals,this.activations=this._internals.state.activationManager.getActivations("overlays"),this.loadedImageCounts={};for(let t=0;t<this.activations.length;t++){const n=this.activations[t],r=n.config,i=this.buildOverlayCss(r,t);document.head.insertAdjacentHTML("beforeend",i);const s=this.buildOverlayBody(r,t);document.body.insertAdjacentHTML("beforeend",s);const a="permutive-overlay-"+t,o=document.getElementById(a),u=o.getElementsByClassName("close")[0],c=o.getElementsByClassName("content")[0],l=()=>{o.style.visibility="hidden",o.style.opacity="0"},d=t=>{c.contains(t.target)||(l(),o.removeEventListener("click",d))};u.addEventListener("click",l),o.addEventListener("click",d),[].slice.call(o.getElementsByTagName("a")).slice(1).forEach(t=>{t.addEventListener("click",(function(){n.trackConversion({useBeacon:!0})}))});const f=o.getElementsByTagName("form")[0];f&&f.addEventListener("submit",(function(t){t.preventDefault(),n.trackConversion({success:function(){f.submit()}})}));const _=function(t,n){e.showOverlay(t),n.trackImpression()};n.activateEveryTime()?this.permutive.segment(n.segmentCode,this._internals.makeSafe(t=>{t?_(a,n):this.permutive.trigger(n.segmentCode,"result",(function(t){t.result&&_(a,n)}))})):n.activateOnEntry()?this.permutive.trigger(n.segmentCode,"result",this._internals.makeSafe((function(t){t.result&&_(a,n)}))):n.activateOnExit()&&this.permutive.trigger(n.segmentCode,"result",this._internals.makeSafe((function(t){t.result||_(a,n)})))}}buildOverlayCss(t,e){return'<style type="text/css">.${overlay_class}{position:fixed;top:0;bottom:0;left:0;right:0;width:100%;height:100%;background:rgba(0,0,0,0.${opacity_percentage});transition:opacity ${opacity_transition_ms}ms;visibility:hidden;opacity:0;z-index:1000000;}.${modal_class}{position:fixed;padding:10px;background:#fff;border-radius:5px;z-index:1000001}.${modal_class} .content{overflow:auto;z-index:1000002;}.${modal_class} .close{position:absolute;top:20px;right:30px;transition:all 200ms;font-size:30px;font-weight:bold;text-decoration:none;color:#333;z-index:1000003}.${modal_class} .close:hover{color:orange;}</style>'.replace(/\${overlay_class}/g,"permutive-overlay-"+e).replace(/\${modal_class}/g,"permutive-modal-"+e).replace("${opacity_percentage}",t.opacity_percentage.toString()).replace("${opacity_transition_ms}",t.opacity_transition_ms.toString())}buildOverlayBody(t,e){let n="";return!function(t){return void 0!==t.html}(t)?function(t){return void 0!==t.image_url&&void 0!==t.image_link}(t)&&(n='<a href="'+t.image_link+'"><img src="'+t.image_url+'"/></a>'):n=t.html,'<div id="${overlay_class}" class="${overlay_class}"><div id="${modal_class}" class="${modal_class}"><a class="close" href="javascript:;">&times;</a><div class="content">${content}</div></div></div>'.replace(/\${overlay_class}/g,"permutive-overlay-"+e).replace(/\${modal_class}/g,"permutive-modal-"+e).replace("${content}",n).replace(/<img /g,"<img onload='window.permutive.addons.overlays.loadedImage(\"permutive-overlay-"+e+"\")' ")}showOverlay(t){const e=document.getElementById(""+t),n=()=>{const t=e.getElementsByTagName("div")[0],n=t.getBoundingClientRect().height,r=t.getBoundingClientRect().width;t.style.left=window.innerWidth/2-r/2+"px",t.style.top=window.innerHeight/2-n/2+"px",e.style.visibility="visible",e.style.opacity="1"},r=e.getElementsByTagName("img");if(r.length>0){let e=0;const i=()=>{e<10&&(!(t in this.loadedImageCounts)||this.loadedImageCounts[t]<r.length)?(e+=1,setTimeout(i,500)):n()};i()}else n()}loadedImage(t){t in this.loadedImageCounts?this.loadedImageCounts[t]=this.loadedImageCounts[t]+1:this.loadedImageCounts[t]=1}}},function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,"load",(function(){return load})),__webpack_require__.d(__webpack_exports__,"ScriptRunnerAddon",(function(){return ScriptRunnerAddon}));const load=(t,e,n)=>{t.unshift({functionName:"addon",arguments:["scriptrunner",{}]})};class ScriptRunnerAddon{constructor(options){this.permutive=options.permutive,this._internals=options._internals,this.network=options.network,this.activations=this._internals.state.activationManager.getActivations("scriptrunner");for(let i=0;i<this.activations.length;i++){const activation=this.activations[i],run=activation=>{const script=activation.config.script.replace(/impression\(\)/g,"activation.trackImpression();").replace(/conversion\(\)/g,"activation.trackConversion();");try{eval(script)}catch(t){t.message="Error running custom script: "+t.message,this.network.error(t,this._internals.state.userId)}};activation.activateEveryTime()?this.permutive.segment(activation.segmentCode,t=>{t?run(activation):this.permutive.trigger(activation.segmentCode,"result",(function(t){t.result&&run(activation)}))}):activation.activateOnEntry()?this.permutive.trigger(activation.segmentCode,"result",(function(t){t.result&&run(activation)})):activation.activateOnExit()&&this.permutive.trigger(activation.segmentCode,"result",(function(t){t.result||run(activation)}))}}}},function(t,e,n){"use strict";n.r(e),n.d(e,"load",(function(){return o})),n.d(e,"WebAddon",(function(){return u}));var r=n(5),i=n(0);const s=["mousemove","click","scroll"],a=["email","tel","submit","reset","button","file","password","radio","checkbox"],o=(t,e,n)=>{0};class u{constructor(t){this.dirtyState=!1,this.initialised=!1,this.totalCompletion=0,this.totalEngagedTime=0,this.engagementEdgeOnly="boolean"==typeof{workspaces:[{activations:[],add_alchemy_entities:!1,add_alchemy_taxonomy:!1}],auto_init:!1,add_alchemy_entities:!1,add_alchemy_taxonomy:!1,activationConfigs:[]}.engagement_edge_only&&{workspaces:[{activations:[],add_alchemy_entities:!1,add_alchemy_taxonomy:!1}],auto_init:!1,add_alchemy_entities:!1,add_alchemy_taxonomy:!1,activationConfigs:[]}.engagement_edge_only,this.segmentTransitionEdgeOnly="boolean"==typeof{workspaces:[{activations:[],add_alchemy_entities:!1,add_alchemy_taxonomy:!1}],auto_init:!1,add_alchemy_entities:!1,add_alchemy_taxonomy:!1,activationConfigs:[]}.segment_transition_edge_only&&{workspaces:[{activations:[],add_alchemy_entities:!1,add_alchemy_taxonomy:!1}],auto_init:!1,add_alchemy_entities:!1,add_alchemy_taxonomy:!1,activationConfigs:[]}.segment_transition_edge_only,this.trackPageviewEngagement="boolean"!=typeof{workspaces:[{activations:[],add_alchemy_entities:!1,add_alchemy_taxonomy:!1}],auto_init:!1,add_alchemy_entities:!1,add_alchemy_taxonomy:!1,activationConfigs:[]}.track_pageview_engagement||{workspaces:[{activations:[],add_alchemy_entities:!1,add_alchemy_taxonomy:!1}],auto_init:!1,add_alchemy_entities:!1,add_alchemy_taxonomy:!1,activationConfigs:[]}.track_pageview_engagement,this.trackPageviewComplete="boolean"!=typeof{workspaces:[{activations:[],add_alchemy_entities:!1,add_alchemy_taxonomy:!1}],auto_init:!1,add_alchemy_entities:!1,add_alchemy_taxonomy:!1,activationConfigs:[]}.track_pageview_complete||{workspaces:[{activations:[],add_alchemy_entities:!1,add_alchemy_taxonomy:!1}],auto_init:!1,add_alchemy_entities:!1,add_alchemy_taxonomy:!1,activationConfigs:[]}.track_pageview_complete,this.trackFormSubmission="boolean"!=typeof{workspaces:[{activations:[],add_alchemy_entities:!1,add_alchemy_taxonomy:!1}],auto_init:!1,add_alchemy_entities:!1,add_alchemy_taxonomy:!1,activationConfigs:[]}.track_form_submission||{workspaces:[{activations:[],add_alchemy_entities:!1,add_alchemy_taxonomy:!1}],auto_init:!1,add_alchemy_entities:!1,add_alchemy_taxonomy:!1,activationConfigs:[]}.track_form_submission,this.trackLinkClick="boolean"!=typeof{workspaces:[{activations:[],add_alchemy_entities:!1,add_alchemy_taxonomy:!1}],auto_init:!1,add_alchemy_entities:!1,add_alchemy_taxonomy:!1,activationConfigs:[]}.track_link_click||{workspaces:[{activations:[],add_alchemy_entities:!1,add_alchemy_taxonomy:!1}],auto_init:!1,add_alchemy_entities:!1,add_alchemy_taxonomy:!1,activationConfigs:[]}.track_link_click,this.pageviewCompleteTimeoutDuration=6e5,this.hasPageviewCompleteFired=!1,this.permutive=t.permutive,this._internals=t._internals,this.context=t.context,this.eventInterval=t.eventInterval||5,this.page=t.page||{},this.sendPageviewEvent(),(t.dirtyEvents||s).map(t=>{window.addEventListener(t,()=>{this.dirtyState=!0,this.trackPageviewComplete&&this.resetTimeout()})}),"loading"!==document.readyState?this.attachListeners():window.addEventListener("DOMContentLoaded",this.attachListeners,!1),this.trackPageviewEngagement&&(this.timerHandle=this.registerEngagementInterval(this.eventInterval)),this.trackPageviewComplete&&(this.setPageviewCompleteTimeout(this.pageviewCompleteTimeoutDuration),Object(r.n)(()=>this.hasPageviewCompleteFired?null:this.sendPageviewCompleteEvent(this.totalEngagedTime,this.totalCompletion),navigator.userAgent)),this.initialised=!0}sendPageviewEvent(){const t=Object.assign(Object.assign(Object.assign(Object.assign({isp_info:"$ip_isp_info",geo_info:"$ip_geo_info"},{}),{}),this.enrichmentProperties(this.context.isArticle)),this.page?this.page:{}),e={success:()=>{this.initialised||this._internals.metrics.trackTimeSinceInit("sdk_first_event_tracked_task_duration_seconds",{})}};this.permutive.track("Pageview",t,e).then(t=>{this._internals.messages.emit("permutive:event:pageview",t)})}sendLinkClickEvent(t,e){if(window.location.href&&t.href){const n=0===t.href.indexOf("data:")?"NOT_URL":t.href;this.permutive.track("LinkClick",{dest_url:n},{useBeacon:e})}}sendFormSubmissionEvent(t){const e=t.currentTarget,n={form:Object.assign(Object.assign(Object.assign({method:e.method||"GET",properties:this.serializeForm(e)},"string"==typeof e.id?{id:e.id}:{}),e.name&&"string"==typeof e.name?{name:e.name}:{}),e.action&&"string"==typeof e.action?{action:e.action}:{})};this.permutive.track("FormSubmission",n)}sendEngagementEvent(t){const{engaged_time:e,total_engaged_time:n,completion:r,total_completion:i}=this.updateState(t),s=Object.assign(Object.assign({isp_info:"$ip_isp_info",geo_info:"$ip_geo_info",engaged_time:e,total_engaged_time:n},this.page),{completion:r,total_completion:i});this.permutive.track("PageviewEngagement",s,{isMemoryOnly:this.engagementEdgeOnly})}sendPageviewCompleteEvent(t,e,n=!0){const r=Object.assign(Object.assign(Object.assign({isp_info:"$ip_isp_info",geo_info:"$ip_geo_info"},this.enrichmentProperties(this.context.isArticle)),this.page),{aggregations:Object.assign({PageviewEngagement:Object.assign({engaged_time:t},{completion:e})},this.segmentTransitionEdgeOnly?{SegmentEntry:Array.from(this._internals.queryManager.segmentEntryQueryCodes),SegmentExit:Array.from(this._internals.queryManager.segmentExitQueryCodes)}:{})});this.permutive.track("PageviewComplete",r,{useBeacon:n}),this.hasPageviewCompleteFired=!0}reset(t){this._internals.state.viewId=Object(r.o)(),this.page=t.page||null,this.trackPageviewComplete&&(this.sendPageviewCompleteEvent(this.totalEngagedTime,this.totalCompletion,!1),this.hasPageviewCompleteFired=!1),this.totalCompletion=0,this.totalEngagedTime=0,this.sendPageviewEvent(),this.trackPageviewEngagement&&(clearInterval(this.timerHandle),this.timerHandle=this.registerEngagementInterval(this.eventInterval))}serializeForm(t){return[].slice.call(t.getElementsByTagName("input"),0).filter(t=>!(!t.type||!t.id||t.disabled||t.checked||"fieldset"===t.nodeName.toLowerCase()||-1!==a.indexOf(t.type.toLowerCase()))).map(t=>({name:t.name||t.id,value:t.value})).filter(t=>t.value.length<120)}enrichmentProperties(t){return Object.assign(Object.assign(Object.assign({},{}),{}),{})}registerEngagementInterval(t){return setInterval(()=>{this.dirtyState&&this.sendEngagementEvent(t)},1e3*t)}attachListeners(){const t=t=>"a"===t.tagName.toLowerCase(),e=n=>t(n)?Object(i.o)(n):n.parentElement?t(n.parentElement)?Object(i.o)(n.parentElement):e(n.parentElement):i.n;this.trackFormSubmission&&[].slice.call(document.getElementsByTagName("form"),0).forEach(t=>{t.addEventListener("submit",this._internals.makeSafe(this.sendFormSubmissionEvent.bind(this)))}),this.trackLinkClick&&document.body.addEventListener("click",t=>{if(t.target instanceof Element){const n=e(t.target);return Object(i.b)(()=>{},e=>this.sendLinkClickEvent(e,((t,e)=>!("_blank"===e.target||t.metaKey||t.ctrlKey||t.shiftKey||2===t.which||3===t.which))(t,e)))(n)}})}updateState(t){const e=Math.max(this.totalCompletion,this.getCurrentCompletion()),n=e-this.totalCompletion;return this.totalEngagedTime+=t,this.totalCompletion=e,this.dirtyState=!1,{engaged_time:t,total_engaged_time:this.totalEngagedTime,completion:n,total_completion:this.totalCompletion}}getCurrentCompletion(){const t=document.documentElement.scrollHeight,e=window.pageYOffset+window.innerHeight;return e<=0?0:e>=t?1:e/t}setPageviewCompleteTimeout(t){return window.setTimeout(()=>this.sendPageviewCompleteEvent(this.totalEngagedTime,this.totalCompletion,!1),t)}resetTimeout(){clearTimeout(this.pageviewCompleteTimeoutHandle),this.pageviewCompleteTimeoutHandle=this.setPageviewCompleteTimeout(this.pageviewCompleteTimeoutDuration)}}},function(t,e,n){"use strict";n.r(e),n.d(e,"GraphQLGeoIP",(function(){return a})),n.d(e,"register",(function(){return o}));var r=n(5),i=n(19);class s extends i.b{constructor(t){super(),this.replacementMap={$ip_geo_info:t.geo,$ip_isp_info:t.isp,$ip_address:t.ip,$ip_address_hash:t.ip_hash}}}class a{constructor(t){this.resource="geoip",this.query=()=>`geoip { ${[this.config.includeGeo?"geo { continent country city province postal_code }":"",this.config.includeISP?"isp { isp organization autonomous_system_number autonomous_system_organization }":"",this.config.includeIP?"ip":"",this.config.includeIPHash?"ip_hash":""].join(" ")} }`,this.config=t}}const o=(t,e)=>{const n=t=>{t.isp&&(e.isp=t.isp.isp,e.organization=t.isp.organization,e.autonomous_system_number=t.isp.autonomous_system_number,e.autonomous_system_organization=t.isp.autonomous_system_organization),t.geo&&(e.continent=t.geo.continent,e.country=t.geo.country,e.city=t.geo.city,e.province=t.geo.province,e.postal_code=t.geo.postal_code)},i=t.state.getPermutiveData("enricher:geoip");if(i&&i.session_id===t.sessionManager.getSessionId())n(i.data),t.enrichers.register(new s(i.data));else{const e={includeGeo:Object(r.i)({geoip:{}},"geoip","include_geo")||!0,includeISP:Object(r.i)({geoip:{}},"geoip","include_isp")||!0,includeIPHash:Object(r.i)({geoip:{}},"geoip","include_ip_hash")||!0,includeIP:Object(r.i)({geoip:{}},"geoip","include_ip")||!1};t.graphql.register(new a(e)).then(e=>{n(e),t.state.setPermutiveData("enricher:geoip",{session_id:t.sessionManager.getSessionId(),data:e}),t.enrichers.register(new s(e))}).catch(e=>t.network.error("Error while registering the geoip enricher: got "+e))}}},function(t,e,n){"use strict";n.r(e),n.d(e,"AppNexusIdentityProvider",(function(){return a})),n.d(e,"make",(function(){return o}));var r=n(0),i=n(6),s=n(5);class a{constructor(t,e){this._internals=t,this.network=e,this.tag="appnexus",this.ttlInSeconds=86400,this.usedForThirdPartyData=!0,this.url="https://ib.adnxs.com/getuidj",this.invalidAliases=["0","-1"]}getId(){return Object(s.g)(navigator.userAgent)?Promise.resolve({type:"skipped"}):this.network.ajax({url:this.url,xhrFields:{withCredentials:!0},timeout:3e3}).then(t=>({type:"attempted",result:Object(i.a)(Object(r.e)(t=>t.uid&&this.isValidAlias(t.uid))(t),Object(r.m)(t=>t.uid))}),t=>Object(i.a)(this.network.error(`Failed to retrieve third-party identity for ${this.tag}. Got ${t}`,this._internals.state.userId),t=>({type:"attempted",result:r.n})))}isValidAlias(t){return-1===this.invalidAliases.indexOf(t)}}const o=(t,e)=>Promise.resolve(Object(r.o)(new a(t,e)))}]);